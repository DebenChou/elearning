/* Zepto 1.1.6 - zepto event ajax form ie detect touch - zeptojs.com/license */
var Zepto=function(){function D(t){return null==t?String(t):S[j.call(t)]||"object"}function k(t){return"function"==D(t)}function L(t){return null!=t&&t==t.window}function R(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function Z(t){return"object"==D(t)}function $(t){return Z(t)&&!L(t)&&Object.getPrototypeOf(t)==Object.prototype}function _(t){return"number"==typeof t.length}function F(t){return a.call(t,function(t){return null!=t})}function I(t){return t.length>0?n.fn.concat.apply([],t):t}function z(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function B(t){return t in f?f[t]:f[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function q(t,e){return"number"!=typeof e||l[z(t)]?e:e+"px"}function H(t){var e,n;return c[t]||(e=u.createElement(t),u.body.appendChild(e),n=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),c[t]=n),c[t]}function U(t){return"children"in t?s.call(t.children):n.map(t.childNodes,function(t){return 1==t.nodeType?t:void 0})}function V(t,e){var n,i=t?t.length:0;for(n=0;i>n;n++)this[n]=t[n];this.length=i,this.selector=e||""}function X(n,i,r){for(e in i)r&&($(i[e])||A(i[e]))?($(i[e])&&!$(n[e])&&(n[e]={}),A(i[e])&&!A(n[e])&&(n[e]=[]),X(n[e],i[e],r)):i[e]!==t&&(n[e]=i[e])}function W(t,e){return null==e?n(t):n(t).filter(e)}function Y(t,e,n,i){return k(e)?e.call(t,n,i):e}function J(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function G(e,n){var i=e.className||"",r=i&&i.baseVal!==t;return n===t?r?i.baseVal:i:void(r?i.baseVal=n:e.className=n)}function K(t){try{return t?"true"==t||("false"==t?!1:"null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?n.parseJSON(t):t):t}catch(e){return t}}function Q(t,e){e(t);for(var n=0,i=t.childNodes.length;i>n;n++)Q(t.childNodes[n],e)}var t,e,n,i,P,O,r=[],o=r.concat,a=r.filter,s=r.slice,u=window.document,c={},f={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},h=/^\s*<(\w+|!)[^>]*>/,p=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,d=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,m=/^(?:body|html)$/i,g=/([A-Z])/g,v=["val","css","html","text","data","width","height","offset"],y=["after","prepend","before","append"],b=u.createElement("table"),w=u.createElement("tr"),x={tr:u.createElement("tbody"),tbody:b,thead:b,tfoot:b,td:w,th:w,"*":u.createElement("div")},T=/complete|loaded|interactive/,E=/^[\w-]*$/,S={},j=S.toString,C={},N=u.createElement("div"),M={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},A=Array.isArray||function(t){return t instanceof Array};return C.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var n=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(n)return n.call(t,e);var i,r=t.parentNode,o=!r;return o&&(r=N).appendChild(t),i=~C.qsa(r,e).indexOf(t),o&&N.removeChild(t),i},P=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},O=function(t){return a.call(t,function(e,n){return t.indexOf(e)==n})},C.fragment=function(e,i,r){var o,a,c;return p.test(e)&&(o=n(u.createElement(RegExp.$1))),o||(e.replace&&(e=e.replace(d,"<$1></$2>")),i===t&&(i=h.test(e)&&RegExp.$1),i in x||(i="*"),c=x[i],c.innerHTML=""+e,o=n.each(s.call(c.childNodes),function(){c.removeChild(this)})),$(r)&&(a=n(o),n.each(r,function(t,e){v.indexOf(t)>-1?a[t](e):a.attr(t,e)})),o},C.Z=function(t,e){return new V(t,e)},C.isZ=function(t){return t instanceof C.Z},C.init=function(e,i){var r;if(!e)return C.Z();if("string"==typeof e)if(e=e.trim(),"<"==e[0]&&h.test(e))r=C.fragment(e,RegExp.$1,i),e=null;else{if(i!==t)return n(i).find(e);r=C.qsa(u,e)}else{if(k(e))return n(u).ready(e);if(C.isZ(e))return e;if(A(e))r=F(e);else if(Z(e))r=[e],e=null;else if(h.test(e))r=C.fragment(e.trim(),RegExp.$1,i),e=null;else{if(i!==t)return n(i).find(e);r=C.qsa(u,e)}}return C.Z(r,e)},n=function(t,e){return C.init(t,e)},n.extend=function(t){var e,n=s.call(arguments,1);return"boolean"==typeof t&&(e=t,t=n.shift()),n.forEach(function(n){X(t,n,e)}),t},C.qsa=function(t,e){var n,i="\u0023"==e[0],r=!i&&"."==e[0],o=i||r?e.slice(1):e,a=E.test(o);return t.getElementById&&a&&i?(n=t.getElementById(o))?[n]:[]:1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType?[]:s.call(a&&!i&&t.getElementsByClassName?r?t.getElementsByClassName(o):t.getElementsByTagName(e):t.querySelectorAll(e))},n.contains=u.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},n.type=D,n.isFunction=k,n.isWindow=L,n.isArray=A,n.isPlainObject=$,n.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},n.inArray=function(t,e,n){return r.indexOf.call(e,t,n)},n.camelCase=P,n.trim=function(t){return null==t?"":String.prototype.trim.call(t)},n.uuid=0,n.support={},n.expr={},n.noop=function(){},n.map=function(t,e){var n,r,o,i=[];if(_(t))for(r=0;r<t.length;r++)n=e(t[r],r),null!=n&&i.push(n);else for(o in t)n=e(t[o],o),null!=n&&i.push(n);return I(i)},n.each=function(t,e){var n,i;if(_(t)){for(n=0;n<t.length;n++)if(e.call(t[n],n,t[n])===!1)return t}else for(i in t)if(e.call(t[i],i,t[i])===!1)return t;return t},n.grep=function(t,e){return a.call(t,e)},window.JSON&&(n.parseJSON=JSON.parse),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){S["[object "+e+"]"]=e.toLowerCase()}),n.fn={constructor:C.Z,length:0,forEach:r.forEach,reduce:r.reduce,push:r.push,sort:r.sort,splice:r.splice,indexOf:r.indexOf,concat:function(){var t,e,n=[];for(t=0;t<arguments.length;t++)e=arguments[t],n[t]=C.isZ(e)?e.toArray():e;return o.apply(C.isZ(this)?this.toArray():this,n)},map:function(t){return n(n.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(t){return T.test(u.readyState)&&u.body?t(n):u.addEventListener("DOMContentLoaded",function(){t(n)},!1),this},get:function(e){return e===t?s.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return r.every.call(this,function(e,n){return t.call(e,n,e)!==!1}),this},filter:function(t){return k(t)?this.not(this.not(t)):n(a.call(this,function(e){return C.matches(e,t)}))},add:function(t,e){return n(O(this.concat(n(t,e))))},is:function(t){return this.length>0&&C.matches(this[0],t)},not:function(e){var i=[];if(k(e)&&e.call!==t)this.each(function(t){e.call(this,t)||i.push(this)});else{var r="string"==typeof e?this.filter(e):_(e)&&k(e.item)?s.call(e):n(e);this.forEach(function(t){r.indexOf(t)<0&&i.push(t)})}return n(i)},has:function(t){return this.filter(function(){return Z(t)?n.contains(this,t):n(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!Z(t)?t:n(t)},last:function(){var t=this[this.length-1];return t&&!Z(t)?t:n(t)},find:function(t){var e,i=this;return e=t?"object"==typeof t?n(t).filter(function(){var t=this;return r.some.call(i,function(e){return n.contains(e,t)})}):1==this.length?n(C.qsa(this[0],t)):this.map(function(){return C.qsa(this,t)}):n()},closest:function(t,e){var i=this[0],r=!1;for("object"==typeof t&&(r=n(t));i&&!(r?r.indexOf(i)>=0:C.matches(i,t));)i=i!==e&&!R(i)&&i.parentNode;return n(i)},parents:function(t){for(var e=[],i=this;i.length>0;)i=n.map(i,function(t){return(t=t.parentNode)&&!R(t)&&e.indexOf(t)<0?(e.push(t),t):void 0});return W(e,t)},parent:function(t){return W(O(this.pluck("parentNode")),t)},children:function(t){return W(this.map(function(){return U(this)}),t)},contents:function(){return this.map(function(){return this.contentDocument||s.call(this.childNodes)})},siblings:function(t){return W(this.map(function(t,e){return a.call(U(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return n.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=H(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var e=k(t);if(this[0]&&!e)var i=n(t).get(0),r=i.parentNode||this.length>1;return this.each(function(o){n(this).wrapAll(e?t.call(this,o):r?i.cloneNode(!0):i)})},wrapAll:function(t){if(this[0]){n(this[0]).before(t=n(t));for(var e;(e=t.children()).length;)t=e.first();n(t).append(this)}return this},wrapInner:function(t){var e=k(t);return this.each(function(i){var r=n(this),o=r.contents(),a=e?t.call(this,i):t;o.length?o.wrapAll(a):r.append(a)})},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var i=n(this);(e===t?"none"==i.css("display"):e)?i.show():i.hide()})},prev:function(t){return n(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return n(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;n(this).empty().append(Y(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var n=Y(this,t,e,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this.pluck("textContent").join(""):null},attr:function(n,i){var r;return"string"!=typeof n||1 in arguments?this.each(function(t){if(1===this.nodeType)if(Z(n))for(e in n)J(this,e,n[e]);else J(this,n,Y(this,i,t,this.getAttribute(n)))}):this.length&&1===this[0].nodeType?!(r=this[0].getAttribute(n))&&n in this[0]?this[0][n]:r:t},removeAttr:function(t){return this.each(function(){1===this.nodeType&&t.split(" ").forEach(function(t){J(this,t)},this)})},prop:function(t,e){return t=M[t]||t,1 in arguments?this.each(function(n){this[t]=Y(this,e,n,this[t])}):this[0]&&this[0][t]},data:function(e,n){var i="data-"+e.replace(g,"-$1").toLowerCase(),r=1 in arguments?this.attr(i,n):this.attr(i);return null!==r?K(r):t},val:function(t){return 0 in arguments?this.each(function(e){this.value=Y(this,t,e,this.value)}):this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(t){if(t)return this.each(function(e){var i=n(this),r=Y(this,t,e,i.offset()),o=i.offsetParent().offset(),a={top:r.top-o.top,left:r.left-o.left};"static"==i.css("position")&&(a.position="relative"),i.css(a)});if(!this.length)return null;if(!n.contains(u.documentElement,this[0]))return{top:0,left:0};var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(t,i){if(arguments.length<2){var r,o=this[0];if(!o)return;if(r=getComputedStyle(o,""),"string"==typeof t)return o.style[P(t)]||r.getPropertyValue(t);if(A(t)){var a={};return n.each(t,function(t,e){a[e]=o.style[P(e)]||r.getPropertyValue(e)}),a}}var s="";if("string"==D(t))i||0===i?s=z(t)+":"+q(t,i):this.each(function(){this.style.removeProperty(z(t))});else for(e in t)t[e]||0===t[e]?s+=z(e)+":"+q(e,t[e])+";":this.each(function(){this.style.removeProperty(z(e))});return this.each(function(){this.style.cssText+=";"+s})},index:function(t){return t?this.indexOf(n(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return t?r.some.call(this,function(t){return this.test(G(t))},B(t)):!1},addClass:function(t){return t?this.each(function(e){if("className"in this){i=[];var r=G(this),o=Y(this,t,e,r);o.split(/\s+/g).forEach(function(t){n(this).hasClass(t)||i.push(t)},this),i.length&&G(this,r+(r?" ":"")+i.join(" "))}}):this},removeClass:function(e){return this.each(function(n){if("className"in this){if(e===t)return G(this,"");i=G(this),Y(this,e,n,i).split(/\s+/g).forEach(function(t){i=i.replace(B(t)," ")}),G(this,i.trim())}})},toggleClass:function(e,i){return e?this.each(function(r){var o=n(this),a=Y(this,e,r,G(this));a.split(/\s+/g).forEach(function(e){(i===t?!o.hasClass(e):i)?o.addClass(e):o.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var n="scrollTop"in this[0];return e===t?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var n="scrollLeft"in this[0];return e===t?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),i=this.offset(),r=m.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(n(t).css("margin-top"))||0,i.left-=parseFloat(n(t).css("margin-left"))||0,r.top+=parseFloat(n(e[0]).css("border-top-width"))||0,r.left+=parseFloat(n(e[0]).css("border-left-width"))||0,{top:i.top-r.top,left:i.left-r.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||u.body;t&&!m.test(t.nodeName)&&"static"==n(t).css("position");)t=t.offsetParent;return t})}},n.fn.detach=n.fn.remove,["width","height"].forEach(function(e){var i=e.replace(/./,function(t){return t[0].toUpperCase()});n.fn[e]=function(r){var o,a=this[0];return r===t?L(a)?a["inner"+i]:R(a)?a.documentElement["scroll"+i]:(o=this.offset())&&o[e]:this.each(function(t){a=n(this),a.css(e,Y(this,r,t,a[e]()))})}}),y.forEach(function(t,e){var i=e%2;n.fn[t]=function(){var t,o,r=n.map(arguments,function(e){return t=D(e),"object"==t||"array"==t||null==e?e:C.fragment(e)}),a=this.length>1;return r.length<1?this:this.each(function(t,s){o=i?s:s.parentNode,s=0==e?s.nextSibling:1==e?s.firstChild:2==e?s:null;var c=n.contains(u.documentElement,o);r.forEach(function(t){if(a)t=t.cloneNode(!0);else if(!o)return n(t).remove();o.insertBefore(t,s),c&&Q(t,function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},n.fn[i?t+"To":"insert"+(e?"Before":"After")]=function(e){return n(e)[t](this),this}}),C.Z.prototype=V.prototype=n.fn,C.uniq=O,C.deserializeValue=K,n.zepto=C,n}();window.Zepto=Zepto,(void 0===window.$)&&(window.$=Zepto),function(t){function l(t){return t._zid||(t._zid=e++)}function h(t,e,n,i){if(e=p(e),e.ns)var r=d(e.ns);return(a[l(t)]||[]).filter(function(t){return t&&(!e.e||t.e==e.e)&&(!e.ns||r.test(t.ns))&&(!n||l(t.fn)===l(n))&&(!i||t.sel==i)})}function p(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function d(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function m(t,e){return t.del&&!u&&t.e in c||!!e}function g(t){return f[t]||u&&c[t]||t}function v(e,i,r,o,s,u,c){var h=l(e),d=a[h]||(a[h]=[]);i.split(/\s/).forEach(function(i){if("ready"==i)return t(document).ready(r);var a=p(i);a.fn=r,a.sel=s,a.e in f&&(r=function(e){var n=e.relatedTarget;return!n||n!==this&&!t.contains(this,n)?a.fn.apply(this,arguments):void 0}),a.del=u;var l=u||r;a.proxy=function(t){if(t=E(t),!t.isImmediatePropagationStopped()){t.data=o;var i=l.apply(e,t._args==n?[t]:[t].concat(t._args));return i===!1&&(t.preventDefault(),t.stopPropagation()),i}},a.i=d.length,d.push(a),"addEventListener"in e&&e.addEventListener(g(a.e),a.proxy,m(a,c))})}function y(t,e,n,i,r){var o=l(t);(e||"").split(/\s/).forEach(function(e){h(t,e,n,i).forEach(function(e){delete a[o][e.i],"removeEventListener"in t&&t.removeEventListener(g(e.e),e.proxy,m(e,r))})})}function E(e,i){return(i||!e.isDefaultPrevented)&&(i||(i=e),t.each(T,function(t,n){var r=i[t];e[t]=function(){return this[n]=b,r&&r.apply(i,arguments)},e[n]=w}),(i.defaultPrevented!==n?i.defaultPrevented:"returnValue"in i?i.returnValue===!1:i.getPreventDefault&&i.getPreventDefault())&&(e.isDefaultPrevented=b)),e}function S(t){var e,i={originalEvent:t};for(e in t)x.test(e)||t[e]===n||(i[e]=t[e]);return E(i,t)}var n,e=1,i=Array.prototype.slice,r=t.isFunction,o=function(t){return"string"==typeof t},a={},s={},u="onfocusin"in window,c={focus:"focusin",blur:"focusout"},f={mouseenter:"mouseover",mouseleave:"mouseout"};s.click=s.mousedown=s.mouseup=s.mousemove="MouseEvents",t.event={add:v,remove:y},t.proxy=function(e,n){var a=2 in arguments&&i.call(arguments,2);if(r(e)){var s=function(){return e.apply(n,a?a.concat(i.call(arguments)):arguments)};return s._zid=l(e),s}if(o(n))return a?(a.unshift(e[n],e),t.proxy.apply(null,a)):t.proxy(e[n],e);throw new TypeError("expected function")},t.fn.bind=function(t,e,n){return this.on(t,e,n)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.one=function(t,e,n,i){return this.on(t,e,n,i,1)};var b=function(){return!0},w=function(){return!1},x=/^([A-Z]|returnValue$|layer[XY]$)/,T={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};t.fn.delegate=function(t,e,n){return this.on(e,t,n)},t.fn.undelegate=function(t,e,n){return this.off(e,t,n)},t.fn.live=function(e,n){return t(document.body).delegate(this.selector,e,n),this},t.fn.die=function(e,n){return t(document.body).undelegate(this.selector,e,n),this},t.fn.on=function(e,a,s,u,c){var f,l,h=this;return e&&!o(e)?(t.each(e,function(t,e){h.on(t,a,s,e,c)}),h):(o(a)||r(u)||u===!1||(u=s,s=a,a=n),(u===n||s===!1)&&(u=s,s=n),u===!1&&(u=w),h.each(function(n,r){c&&(f=function(t){return y(r,t.type,u),u.apply(this,arguments)}),a&&(l=function(e){var n,o=t(e.target).closest(a,r).get(0);return o&&o!==r?(n=t.extend(S(e),{currentTarget:o,liveFired:r}),(f||u).apply(o,[n].concat(i.call(arguments,1)))):void 0}),v(r,e,u,s,a,l||f)}))},t.fn.off=function(e,i,a){var s=this;return e&&!o(e)?(t.each(e,function(t,e){s.off(t,i,e)}),s):(o(i)||r(a)||a===!1||(a=i,i=n),a===!1&&(a=w),s.each(function(){y(this,e,a,i)}))},t.fn.trigger=function(e,n){return e=o(e)||t.isPlainObject(e)?t.Event(e):E(e),e._args=n,this.each(function(){e.type in c&&"function"==typeof this[e.type]?this[e.type]():"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,n)})},t.fn.triggerHandler=function(e,n){var i,r;return this.each(function(a,s){i=S(o(e)?t.Event(e):e),i._args=n,i.target=s,t.each(h(s,e.type||e),function(t,e){return r=e.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),r},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}}),t.Event=function(t,e){o(t)||(e=t,t=e.type);var n=document.createEvent(s[t]||"Events"),i=!0;if(e)for(var r in e)"bubbles"==r?i=!!e[r]:n[r]=e[r];return n.initEvent(t,i,!0),E(n)}}(Zepto),function(t){function h(e,n,i){var r=t.Event(n);return t(e).trigger(r,i),!r.isDefaultPrevented()}function p(t,e,i,r){return t.global?h(e||n,i,r):void 0}function d(e){e.global&&0===t.active++&&p(e,null,"ajaxStart")}function m(e){e.global&&!--t.active&&p(e,null,"ajaxStop")}function g(t,e){var n=e.context;return e.beforeSend.call(n,t,e)===!1||p(e,n,"ajaxBeforeSend",[t,e])===!1?!1:void p(e,n,"ajaxSend",[t,e])}function v(t,e,n,i){var r=n.context,o="success";n.success.call(r,t,o,e),i&&i.resolveWith(r,[t,o,e]),p(n,r,"ajaxSuccess",[e,n,t]),b(o,e,n)}function y(t,e,n,i,r){var o=i.context;i.error.call(o,n,e,t),r&&r.rejectWith(o,[n,e,t]),p(i,o,"ajaxError",[n,i,t||e]),b(e,n,i)}function b(t,e,n){var i=n.context;n.complete.call(i,e,t),p(n,i,"ajaxComplete",[e,n]),m(n)}function w(){}function x(t){return t&&(t=t.split(";",2)[0]),t&&(t==c?"html":t==u?"json":a.test(t)?"script":s.test(t)&&"xml")||"text"}function T(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function E(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=T(e.url,e.data),e.data=void 0)}function S(e,n,i,r){return t.isFunction(n)&&(r=i,i=n,n=void 0),t.isFunction(i)||(r=i,i=void 0),{url:e,data:n,success:i,dataType:r}}function C(e,n,i,r){var o,a=t.isArray(n),s=t.isPlainObject(n);t.each(n,function(n,u){o=t.type(u),r&&(n=i?r:r+"["+(s||"object"==o||"array"==o?n:"")+"]"),!r&&a?e.add(u.name,u.value):"array"==o||!i&&"object"==o?C(e,u,i,n):e.add(n,u)})}var i,r,e=0,n=window.document,o=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,a=/^(?:text|application)\/javascript/i,s=/^(?:text|application)\/xml/i,u="application/json",c="text/html",f=/^\s*$/,l=n.createElement("a");l.href=window.location.href,t.active=0,t.ajaxJSONP=function(i,r){if(!("type"in i))return t.ajax(i);var c,h,o=i.jsonpCallback,a=(t.isFunction(o)?o():o)||"jsonp"+ ++e,s=n.createElement("script"),u=window[a],f=function(e){t(s).triggerHandler("error",e||"abort")},l={abort:f};return r&&r.promise(l),t(s).on("load error",function(e,n){clearTimeout(h),t(s).off().remove(),"error"!=e.type&&c?v(c[0],l,i,r):y(null,n||"error",l,i,r),window[a]=u,c&&t.isFunction(u)&&u(c[0]),u=c=void 0}),g(l,i)===!1?(f("abort"),l):(window[a]=function(){c=arguments},s.src=i.url.replace(/\?(.+)=\?/,"?$1="+a),n.head.appendChild(s),i.timeout>0&&(h=setTimeout(function(){f("timeout")},i.timeout)),l)},t.ajaxSettings={type:"GET",beforeSend:w,success:w,error:w,complete:w,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:u,xml:"application/xml, text/xml",html:c,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},t.ajax=function(e){var s,u,o=t.extend({},e||{}),a=t.Deferred&&t.Deferred();for(i in t.ajaxSettings)void 0===o[i]&&(o[i]=t.ajaxSettings[i]);d(o),o.crossDomain||(s=n.createElement("a"),s.href=o.url,s.href=s.href,o.crossDomain=l.protocol+"//"+l.host!=s.protocol+"//"+s.host),o.url||(o.url=window.location.toString()),(u=o.url.indexOf("\u0023"))>-1&&(o.url=o.url.slice(0,u)),E(o);var c=o.dataType,h=/\?.+=\?/.test(o.url);if(h&&(c="jsonp"),o.cache!==!1&&(e&&e.cache===!0||"script"!=c&&"jsonp"!=c)||(o.url=T(o.url,"_="+Date.now())),"jsonp"==c)return h||(o.url=T(o.url,o.jsonp?o.jsonp+"=?":o.jsonp===!1?"":"callback=?")),t.ajaxJSONP(o,a);var P,p=o.accepts[c],m={},b=function(t,e){m[t.toLowerCase()]=[t,e]},S=/^([\w-]+:)\/\//.test(o.url)?RegExp.$1:window.location.protocol,j=o.xhr(),C=j.setRequestHeader;if(a&&a.promise(j),o.crossDomain||b("X-Requested-With","XMLHttpRequest"),b("Accept",p||"*/*"),(p=o.mimeType||p)&&(p.indexOf(",")>-1&&(p=p.split(",",2)[0]),j.overrideMimeType&&j.overrideMimeType(p)),(o.contentType||o.contentType!==!1&&o.data&&"GET"!=o.type.toUpperCase())&&b("Content-Type",o.contentType||"application/x-www-form-urlencoded"),o.headers)for(r in o.headers)b(r,o.headers[r]);if(j.setRequestHeader=b,j.onreadystatechange=function(){if(4==j.readyState){j.onreadystatechange=w,clearTimeout(P);var e,n=!1;if(j.status>=200&&j.status<300||304==j.status||0==j.status&&"file:"==S){if(c=c||x(o.mimeType||j.getResponseHeader("content-type")),"arraybuffer"==j.responseType||"blob"==j.responseType)e=j.response;else{e=j.responseText;try{"script"==c?(1,eval)(e):"xml"==c?e=j.responseXML:"json"==c&&(e=f.test(e)?null:t.parseJSON(e))}catch(i){n=i}if(n)return y(n,"parsererror",j,o,a)}v(e,j,o,a)}else y(j.statusText||null,j.status?"error":"abort",j,o,a)}},g(j,o)===!1)return j.abort(),y(null,"abort",j,o,a),j;if(o.xhrFields)for(r in o.xhrFields)j[r]=o.xhrFields[r];var O="async"in o?o.async:!0;j.open(o.type,o.url,O,o.username,o.password);for(r in m)C.apply(j,m[r]);return o.timeout>0&&(P=setTimeout(function(){j.onreadystatechange=w,j.abort(),y(null,"timeout",j,o,a)},o.timeout)),j.send(o.data?o.data:null),j},t.get=function(){return t.ajax(S.apply(null,arguments))},t.post=function(){var e=S.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=S.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,n,i){if(!this.length)return this;var s,r=this,a=e.split(/\s/),u=S(e,n,i),c=u.success;return a.length>1&&(u.url=a[0],s=a[1]),u.success=function(e){r.html(s?t("<div>").html(e.replace(o,"")).find(s):e),c&&c.apply(r,arguments)},t.ajax(u),this};var j=encodeURIComponent;t.param=function(e,n){var i=[];return i.add=function(e,n){t.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(j(e)+"="+j(n))},C(i,e,n),i.join("&").replace(/%20/g,"+")}}(Zepto),function(t){t.fn.serializeArray=function(){var e,n,i=[],r=function(t){return t.forEach?t.forEach(r):void i.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(i,o){n=o.type,e=o.name,e&&"fieldset"!=o.nodeName.toLowerCase()&&!o.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||o.checked)&&r(t(o).val())}),i},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var n=t.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(){try{getComputedStyle(void 0)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t){try{return e(t)}catch(n){return null}}}}(),function(t){function e(t,e){var n=this.os={},i=this.browser={},r=t.match(/Web[kK]it[\/]{0,1}([\d.]+)/),o=t.match(/(Android);?[\s\/]+([\d.]+)?/),a=!!t.match(/\(Macintosh\; Intel /),s=t.match(/(iPad).*OS\s([\d_]+)/),u=t.match(/(iPod)(.*OS\s([\d_]+))?/),c=!s&&t.match(/(iPhone\sOS)\s([\d_]+)/),f=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),l=/Win\d{2}|Windows/.test(e),h=t.match(/Windows Phone ([\d.]+)/),p=f&&t.match(/TouchPad/),d=t.match(/Kindle\/([\d.]+)/),m=t.match(/Silk\/([\d._]+)/),g=t.match(/(BlackBerry).*Version\/([\d.]+)/),v=t.match(/(BB10).*Version\/([\d.]+)/),y=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),b=t.match(/PlayBook/),w=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),x=t.match(/Firefox\/([\d.]+)/),T=t.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),E=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),S=!w&&t.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),j=S||t.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);(i.webkit=!!r)&&(i.version=r[1]),o&&(n.android=!0,n.version=o[2]),c&&!u&&(n.ios=n.iphone=!0,n.version=c[2].replace(/_/g,".")),s&&(n.ios=n.ipad=!0,n.version=s[2].replace(/_/g,".")),u&&(n.ios=n.ipod=!0,n.version=u[3]?u[3].replace(/_/g,"."):null),h&&(n.wp=!0,n.version=h[1]),f&&(n.webos=!0,n.version=f[2]),p&&(n.touchpad=!0),g&&(n.blackberry=!0,n.version=g[2]),v&&(n.bb10=!0,n.version=v[2]),y&&(n.rimtabletos=!0,n.version=y[2]),b&&(i.playbook=!0),d&&(n.kindle=!0,n.version=d[1]),m&&(i.silk=!0,i.version=m[1]),!m&&n.android&&t.match(/Kindle Fire/)&&(i.silk=!0),w&&(i.chrome=!0,i.version=w[1]),x&&(i.firefox=!0,i.version=x[1]),T&&(n.firefoxos=!0,n.version=T[1]),E&&(i.ie=!0,i.version=E[1]),j&&(a||n.ios||l)&&(i.safari=!0,n.ios||(i.version=j[1])),S&&(i.webview=!0),n.tablet=!!(s||b||o&&!t.match(/Mobile/)||x&&t.match(/Tablet/)||E&&!t.match(/Phone/)&&t.match(/Touch/)),n.phone=!(n.tablet||n.ipod||!(o||c||f||g||v||w&&t.match(/Android/)||w&&t.match(/CriOS\/([\d.]+)/)||x&&t.match(/Mobile/)||E&&t.match(/Touch/)))}e.call(t,navigator.userAgent,navigator.platform),t.__detect=e}(Zepto),function(t){function u(t,e,n,i){return Math.abs(t-e)>=Math.abs(n-i)?t-e>0?"Left":"Right":n-i>0?"Up":"Down"}function c(){o=null,e.last&&(e.el.trigger("longTap"),e={})}function f(){o&&clearTimeout(o),o=null}function l(){n&&clearTimeout(n),i&&clearTimeout(i),r&&clearTimeout(r),o&&clearTimeout(o),n=i=r=o=null,e={}}function h(t){return("touch"==t.pointerType||t.pointerType==t.MSPOINTER_TYPE_TOUCH)&&t.isPrimary}function p(t,e){return t.type=="pointer"+e||t.type.toLowerCase()=="mspointer"+e}var n,i,r,o,s,e={},a=750;t(document).ready(function(){var d,m,y,b,g=0,v=0;"MSGesture"in window&&(s=new MSGesture,s.target=document.body),t(document).bind("MSGestureEnd",function(t){var n=t.velocityX>1?"Right":t.velocityX<-1?"Left":t.velocityY>1?"Down":t.velocityY<-1?"Up":null;n&&(e.el.trigger("swipe"),e.el.trigger("swipe"+n))}).on("touchstart MSPointerDown pointerdown",function(i){(!(b=p(i,"down"))||h(i))&&(y=b?i:i.touches[0],i.touches&&1===i.touches.length&&e.x2&&(e.x2=void 0,e.y2=void 0),d=Date.now(),m=d-(e.last||d),e.el=t("tagName"in y.target?y.target:y.target.parentNode),n&&clearTimeout(n),e.x1=y.pageX,e.y1=y.pageY,m>0&&250>=m&&(e.isDoubleTap=!0),e.last=d,o=setTimeout(c,a),s&&b&&s.addPointer(i.pointerId))}).on("touchmove MSPointerMove pointermove",function(t){(!(b=p(t,"move"))||h(t))&&(y=b?t:t.touches[0],f(),e.x2=y.pageX,e.y2=y.pageY,g+=Math.abs(e.x1-e.x2),v+=Math.abs(e.y1-e.y2))}).on("touchend MSPointerUp pointerup",function(o){(!(b=p(o,"up"))||h(o))&&(f(),e.x2&&Math.abs(e.x1-e.x2)>30||e.y2&&Math.abs(e.y1-e.y2)>30?r=setTimeout(function(){e.el.trigger("swipe"),e.el.trigger("swipe"+u(e.x1,e.x2,e.y1,e.y2)),e={}},0):"last"in e&&(30>g&&30>v?i=setTimeout(function(){var i=t.Event("tap");i.cancelTouch=l,e.el.trigger(i),e.isDoubleTap?(e.el&&e.el.trigger("doubleTap"),e={}):n=setTimeout(function(){n=null,e.el&&e.el.trigger("singleTap"),e={}},250)},0):e={}),g=v=0)}).on("touchcancel MSPointerCancel pointercancel",l),t(window).on("scroll",l)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(e){t.fn[e]=function(t){return this.on(e,t)}})}(Zepto);;
/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;e.openTag="{{",e.closeTag="}}";var z=function(a,b){var c=b.split(":"),d=c.shift(),e=c.join(":")||"";return e&&(e=", "+e),"$helpers."+d+"("+a+e+")"};e.parser=function(a){a=a.replace(/^\s/,"");var b=a.split(" "),c=b.shift(),e=b.join(" ");switch(c){case"if":a="if("+e+"){";break;case"else":b="if"===b.shift()?" if("+b.join(" ")+")":"",a="}else"+b+"{";break;case"/if":a="}";break;case"each":var f=b[0]||"$data",g=b[1]||"as",h=b[2]||"$value",i=b[3]||"$index",j=h+","+i;"as"!==g&&(f="[]"),a="$each("+f+",function("+j+"){";break;case"/each":a="});";break;case"echo":a="print("+e+");";break;case"print":case"include":a=c+"("+b.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(e)){var k=!0;0===a.indexOf("#")&&(a=a.substr(1),k=!1);for(var l=0,m=a.split("|"),n=m.length,o=m[l++];n>l;l++)o=z(o,m[l]);a=(k?"=":"=#")+o}else a=d.helpers[c]?"=#"+c+"("+b.join(",")+");":"="+a}return a},"function"==typeof define?define(function(){return d}):"undefined"!=typeof exports?module.exports=d:this.template=d}();;
(function(){function d(o,k){var p;k=k||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=k.touchBoundary||10;this.layer=o;this.tapDelay=k.tapDelay||200;this.tapTimeout=k.tapTimeout||700;if(d.notNeeded(o)){return}function q(l,i){return function(){return l.apply(i,arguments)}}var j=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"];var n=this;for(var m=0,h=j.length;m<h;m++){n[j[m]]=q(n[j[m]],n)}if(b){o.addEventListener("mouseover",this.onMouse,true);o.addEventListener("mousedown",this.onMouse,true);o.addEventListener("mouseup",this.onMouse,true)}o.addEventListener("click",this.onClick,true);o.addEventListener("touchstart",this.onTouchStart,false);o.addEventListener("touchmove",this.onTouchMove,false);o.addEventListener("touchend",this.onTouchEnd,false);o.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){o.removeEventListener=function(l,s,i){var r=Node.prototype.removeEventListener;if(l==="click"){r.call(o,l,s.hijacked||s,i)}else{r.call(o,l,s,i)}};o.addEventListener=function(r,s,l){var i=Node.prototype.addEventListener;if(r==="click"){i.call(o,r,s.hijacked||(s.hijacked=function(t){if(!t.propagationStopped){s(t)}}),l)}else{i.call(o,r,s,l)}}}if(typeof o.onclick==="function"){p=o.onclick;o.addEventListener("click",function(i){p(i)},false);o.onclick=null}}var c=navigator.userAgent.indexOf("Windows Phone")>=0;var b=navigator.userAgent.indexOf("Android")>0&&!c;var g=/iP(ad|hone|od)/.test(navigator.userAgent)&&!c;var e=g&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);var f=g&&(/OS [6-7]_\d/).test(navigator.userAgent);var a=navigator.userAgent.indexOf("BB10")>0;d.prototype.needsClick=function(h){switch(h.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(h.disabled){return true}break;case"input":if((g&&h.type==="file")||h.disabled){return true}break;case"label":case"iframe":case"video":return true}return(/\bneedsclick\b/).test(h.className)};d.prototype.needsFocus=function(h){switch(h.nodeName.toLowerCase()){case"textarea":return true;case"select":return !b;case"input":switch(h.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return !h.disabled&&!h.readOnly;default:return(/\bneedsfocus\b/).test(h.className)}};d.prototype.sendClick=function(i,j){var h,k;if(document.activeElement&&document.activeElement!==i){document.activeElement.blur()}k=j.changedTouches[0];h=document.createEvent("MouseEvents");h.initMouseEvent(this.determineEventType(i),true,true,window,1,k.screenX,k.screenY,k.clientX,k.clientY,false,false,false,false,0,null);h.forwardedTouchEvent=true;i.dispatchEvent(h)};d.prototype.determineEventType=function(h){if(b&&h.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};d.prototype.focus=function(h){var i;if(g&&h.setSelectionRange&&h.type.indexOf("date")!==0&&h.type!=="time"&&h.type!=="month"){i=h.value.length;h.setSelectionRange(i,i)}else{h.focus()}};d.prototype.updateScrollParent=function(i){var j,h;j=i.fastClickScrollParent;if(!j||!j.contains(i)){h=i;do{if(h.scrollHeight>h.offsetHeight){j=h;i.fastClickScrollParent=h;break}h=h.parentElement}while(h)}if(j){j.fastClickLastScrollTop=j.scrollTop}};d.prototype.getTargetElementFromEventTarget=function(h){if(h.nodeType===Node.TEXT_NODE){return h.parentNode}return h};d.prototype.onTouchStart=function(j){var h,k,i;if(j.targetTouches.length>1){return true}h=this.getTargetElementFromEventTarget(j.target);k=j.targetTouches[0];if(g){i=window.getSelection();if(i.rangeCount&&!i.isCollapsed){return true}if(!e){if(k.identifier&&k.identifier===this.lastTouchIdentifier){j.preventDefault();return false}this.lastTouchIdentifier=k.identifier;this.updateScrollParent(h)}}this.trackingClick=true;this.trackingClickStart=j.timeStamp;this.targetElement=h;this.touchStartX=k.pageX;this.touchStartY=k.pageY;if((j.timeStamp-this.lastClickTime)<this.tapDelay){j.preventDefault()}return true};d.prototype.touchHasMoved=function(h){var j=h.changedTouches[0],i=this.touchBoundary;if(Math.abs(j.pageX-this.touchStartX)>i||Math.abs(j.pageY-this.touchStartY)>i){return true}return false};d.prototype.onTouchMove=function(h){if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(h.target)||this.touchHasMoved(h)){this.trackingClick=false;this.targetElement=null}return true};d.prototype.findControl=function(h){if(h.control!==undefined){return h.control}if(h.htmlFor){return document.getElementById(h.htmlFor)}return h.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};d.prototype.onTouchEnd=function(j){var l,k,i,n,m,h=this.targetElement;if(!this.trackingClick){return true}if((j.timeStamp-this.lastClickTime)<this.tapDelay){this.cancelNextClick=true;return true}if((j.timeStamp-this.trackingClickStart)>this.tapTimeout){return true}this.cancelNextClick=false;this.lastClickTime=j.timeStamp;
    k=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(f){m=j.changedTouches[0];h=document.elementFromPoint(m.pageX-window.pageXOffset,m.pageY-window.pageYOffset)||h;h.fastClickScrollParent=this.targetElement.fastClickScrollParent}i=h.tagName.toLowerCase();if(i==="label"){l=this.findControl(h);if(l){this.focus(h);if(b){return false}h=l}}else{if(this.needsFocus(h)){if((j.timeStamp-k)>100||(g&&window.top!==window&&i==="input")){this.targetElement=null;return false}this.focus(h);this.sendClick(h,j);if(!g||i!=="select"){this.targetElement=null;j.preventDefault()}return false}}if(g&&!e){n=h.fastClickScrollParent;if(n&&n.fastClickLastScrollTop!==n.scrollTop){return true}}if(!this.needsClick(h)){j.preventDefault();this.sendClick(h,j)}return false};d.prototype.onTouchCancel=function(){this.trackingClick=false;this.targetElement=null};d.prototype.onMouse=function(h){if(!this.targetElement){return true}if(h.forwardedTouchEvent){return true}if(!h.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(h.stopImmediatePropagation){h.stopImmediatePropagation()}else{h.propagationStopped=true}h.stopPropagation();h.preventDefault();return false}return true};d.prototype.onClick=function(h){var i;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(h.target.type==="submit"&&h.detail===0){return true}i=this.onMouse(h);if(!i){this.targetElement=null}return i};d.prototype.destroy=function(){var h=this.layer;if(b){h.removeEventListener("mouseover",this.onMouse,true);h.removeEventListener("mousedown",this.onMouse,true);h.removeEventListener("mouseup",this.onMouse,true)}h.removeEventListener("click",this.onClick,true);h.removeEventListener("touchstart",this.onTouchStart,false);h.removeEventListener("touchmove",this.onTouchMove,false);h.removeEventListener("touchend",this.onTouchEnd,false);h.removeEventListener("touchcancel",this.onTouchCancel,false)};d.notNeeded=function(i){var h;var l;var k;var j;if(typeof window.ontouchstart==="undefined"){return true}l=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(l){if(b){h=document.querySelector("meta[name=viewport]");if(h){if(h.content.indexOf("user-scalable=no")!==-1){return true}if(l>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(a){k=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(k[1]>=10&&k[2]>=3){h=document.querySelector("meta[name=viewport]");if(h){if(h.content.indexOf("user-scalable=no")!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(i.style.msTouchAction==="none"||i.style.touchAction==="manipulation"){return true}j=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(j>=27){h=document.querySelector("meta[name=viewport]");if(h&&(h.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth)){return true}}if(i.style.touchAction==="none"||i.style.touchAction==="manipulation"){return true}return false};d.attach=function(i,h){return new d(i,h)};if(typeof define==="function"&&typeof define.amd==="object"&&define.amd){define(function(){return d})}else{if(typeof module!=="undefined"&&module.exports){module.exports=d.attach;module.exports.FastClick=d}else{window.FastClick=d}}}());;
/**
 * Easy Kit - Ver 1.2.5
 *
 * --------------------------------
 * Created by krimeshu on 2015/9/9.
 * Last modified on 2016/4/15.
 */

!function(){var f=window.U={};f.fn={$:function(d,a){return a=a&&this.$(a)||document,f.lang.isString(d)&&""!=d?a.querySelector(d):d},$a:function(d,a){return a=a&&this.$(a)||document,f.lang.isString(d)&&""!=d?a.querySelectorAll(d):d},getParam:function(d,a){var c=a||window.location.href;return d&&c?(c=c.match(new RegExp("(\\?|#|&)"+d+"=([^&^#]*)(#|&|$)")))?c[2]:"":""},delParam:function(d,a){return!d instanceof Array&&(d=[d]),f.fn.each(d,function(d){a=a.replace(new RegExp("(?:&"+d+"=[^&]*)","g"),"");
    a=a.replace(new RegExp("(?:\\?"+d+"=[^&]*&?)","g"),"?")}),a},addParam:function(d,a){var c=[];f.fn.each(d,function(d,a){c.push(a)});a=f.fn.delParam(c,a);var e=f.req.serializeParam(d);return a+=/\?/.test(a)?"&"+e:"?"+e},getParams:function(d){d=d||location.href;d=d.replace(/.+?\?/g,"").replace(/#.*/,"").split("&");var a={},c;for(c in d){var e=d[c].split("=");2===e.length&&(a[e[0]]=e[1])}return a},each:function(d,a){var c,e=0,h=d.length;if(void 0===h&&f.lang.isObject(d))for(c in d){if(!1===a.call(d[c],
        d[c],c,d))break}else for(c=d[0];h>e&&!1!==a.call(c,c,e,d);c=d[++e]);return d},log:function(d){window.console&&console.log(d)},logError:function(d){this.log(d.name+" : "+d.message+" \n stack :"+d.stack)},stringify:function(d){var a="";try{a=JSON.stringify(d)}catch(c){this.logError(c)}return a},extend:function(a,b){for(var c in b)a[c]=b[c];return a},parseJSON:function(a){var b=null;try{b=JSON.parse(a)}catch(c){this.logError(c)}return b},domReady:function(a){"complete"==document.readyState||"interactive"==
document.readyState?a.call():document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1);a.call()},!1)},formatFloat:function(a,b,c,e){return e=~~e?~~e:b+1,intNumber=Math.round(a*Math.pow(10,e)),Math[c](intNumber/Math.pow(10,e-b))/Math.pow(10,b)},animate:function(a,b,c,e){function h(a){return""===vendor?a:(a=a.charAt(0).toUpperCase()+a.substr(1),vendor+a)}dummyStyle=document.createElement("div").style;cssVendor=(vendor=function(){for(var a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          d=["t","webkitT","MozT","msT","OT"],b=0,c=d.length;c>b;b++)if(a=d[b]+"ransform",a in dummyStyle)return d[b].substr(0,d[b].length-1);return!1}())?"-"+vendor.toLowerCase()+"-":"";transform=h("transform");transitionProperty=h("transitionProperty");transitionDuration=h("transitionDuration");transitionTimingFunction=h("transitionTimingFunction");transitionDelay=h("transitionDelay");hasTransitionEnd=h("transition")in dummyStyle;TRNEND_EV=!1===vendor?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",
    O:"oTransitionEnd",ms:"MSTransitionEnd"}[vendor];hasTransitionEnd&&e&&(a.style[transitionProperty]=b||transform,a.style[transitionDuration]=e+"ms",a.style[transitionTimingFunction]="cubic-bezier(0.33,0.66,0.66,1)");a.style[transform]=b||c},emptyFun:function(){}};f.$=f.fn.$;f.getParam=f.fn.getParam;f.lang={is:function(a,b){var c=Object.prototype.toString.call(b).slice(8,-1);return void 0!==b&&null!==b&&c===a},isNumber:function(a){return this.is("Number",a)},isString:function(a){return this.is("String",
    a)},isFunction:function(a){return this.is("Function",a)},isObject:function(a){return this.is("Object",a)},isArray:function(a){return this.is("Array",a)}};f.string={escHTML:function(a,b){var c="&,&amp;,<,&lt;,>,&gt;, ,&nbsp;,\",&quot;,',&#39;,\\r,<br>,\\n,<br>".split(",");b&&c.reverse();for(var e=0,h=a;e<c.length;e+=2)h=h.replace(new RegExp(c[e],"g"),c[1+e]);return h},tmpl:function(a,b){return"string"==typeof a?a.replace(/\$([a-zA-Z0-9_]*)\$/g,function(a,d){return"undefined"!=typeof b[d]?b[d]:""}):
    a}};f.tmpl=f.string.tmpl;f.req={log:function(){var a=[];return function(b){var c=new Image;a.push(c);c.onload=c.onerror=c.onabort=function(){c=c.onload=c.onerror=c.onabort=null;for(var b=0,h=a.length;h>b;++b)a[b]===c&&a.splice(b,1)};c.src=b}}(),serializeParam:function(a){if(!a)return"";var b=[],c;for(c in a)b.push(c+"="+a[c]);return b.join("&")},ajax:function(a){var b=a.method.toLocaleUpperCase(),c="POST"==b,e=window.XMLHttpRequest?new XMLHttpRequest:!1;if(!e)return a.error&&a.error.call(null,{ret:999,
    msg:"Create XHR Error!"}),!1;var h=this.serializeParam(a.param);return h&&!c&&(a.url+=(-1<a.url.indexOf("?")?"&":"?")+h),e.open(b,a.url,!0),c&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState){var b=e.status;if(200<=b&&300>b){var b=e.responseText.replace(/(\r|\n|\t)/gi,""),b=/(?:callback\()?(.+)(?:\))?/gi.exec(b),c={ret:998,msg:"\u89e3\u6790\u6570\u636e\u51fa\u9519\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"};try{c=eval("("+b[1]+")")}catch(h){}a.success&&
a.success.call(e,c)}else a.error&&a.error.call(e,{ret:997,msg:"\u8fde\u63a5\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",status:b})}},e.send(c?h:void 0),e},css:function(a,b){var c,e,h,f,g;"string"==typeof b&&(c=b);b="object"==typeof b?b:{};c=b.linkID||c;e=b.doc||document;g=e.getElementsByTagName("head")[0];(f=(h=e.getElementById(c))&&"LINK"==h.nodeName?h:null)||(f=e.createElement("link"),c&&(f.id=c),f.rel=f.rev="stylesheet",f.type="text/css",f.media=b.media||"screen",g.appendChild(f));try{a&&
(f.href=a)}catch(l){}return f},loadScript:function(a,b,c){var e=document.getElementsByTagName("head")[0],h=document.createElement("script"),g=function(){if(h){try{h.src=""}catch(a){}f.dom.unon(h,"load",g);e.removeChild(h);h=null;"function"==typeof b&&b(c,!0)}},k=function(){if(h){try{h.src=""}catch(a){}f.dom.unon(h,"error",k);e.removeChild(h);h=null;"function"==typeof b&&b(c,!1)}};f.dom.on(h,"load",g);f.dom.on(h,"error",k);h.charset="utf-8";h.src=a;e.insertBefore(h,e.firstChild)},report:function(a){var b=
    [];a[6]=10;a[7]=0;f.fn.each(a,function(a,d){b.push(d+"="+encodeURIComponent(a))});(new Image).src="http://api.unipay.qq.com/v1/900/15499/log_data?num=1&record0="+b.join("|")+"&junhan="+Math.random()},isdR:function(a,b,c,e){(new Image).src="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1="+a+"&flag2="+b+"&flag3="+c+"&"+this.serializeParam(e)+"&r="+Math.random()},isdV:function(a,b,c,e,h,g){var k=["http://isdspeed.qq.com/cgi-bin/v.cgi?flag1=",b,"&flag2=1&flag3=",c+"&flag4="];k.push("&1="+(h||"1"));k.push("&2="+
    (g||"1"));k.push("&junhan="+Math.random());a?setTimeout(function(){f.req.log(k.join(""))},a):f.req.log(k.join(""))}};var g=f.ua={},a=navigator.userAgent;g.iPod=-1<a.indexOf("iPod");g.iPad=-1<a.indexOf("iPad");g.iPhone=-1<a.indexOf("iPhone");-1<a.indexOf("Android")&&(g.android=parseFloat(a.slice(a.indexOf("Android")+8)));g.iOS=g.iPad||g.iPhone||g.iPod;(a=/MicroMessenger\/([0-9\.]+)/i.exec(a))&&(g.weixin=parseFloat(a[1],10));(function(a,b,c){for(var e,f=b.documentElement,g=["webkitM","mozM","msM","oM",
    "m"],k=g.length;k--;)if(g[k]+"atchesSelector"in f){e=g[k]+"atchesSelector";break}a.matchesSelector=e?function(a,d){return a[e](d)}:c?function(a,d){return-1!==c.call((a.parentNode||b).querySelectorAll(d)||[],a)}:function(a,d){for(var c=(a.parentNode||b).querySelectorAll(d)||[],e=c.length;e--;)if(c[e]==a)return!0;return!1}})(window,document,Array.prototype.indexOf);f.dom={setStyle:function(a,b,c){a=f.$(a);f.lang.isObject(b)?f.each(b,function(b,c){a.style[c]=b}):a.style[b]=c},hide:function(a){return this.setStyle(a,
    "display","none")},show:function(a){return this.setStyle(a,"display","")},visible:function(a){return this.setStyle(a,"visibility","visible")},hidden:function(a){return this.setStyle(a,"visibility","hidden")},removeClass:function(a,b){return a=f.$(a),a.className=a.className.replace(new RegExp("\\b"+b+"\\b"),"")},addClass:function(a,b){return a=f.$(a),!f.dom.hasClass(a,b)&&(a.className+=" "+b)},hasClass:function(a,b){return(new RegExp("\\b"+b+"\\b")).test(f.$(a).className)},getScrollLeft:function(a){return(a||
document).body.scrollLeft},getScrollTop:function(a){return(a||document).body.scrollTop},getClientHeight:function(a){a=a||document;return"CSS1Compat"==a.compatMode?a.documentElement.clientHeight:a.body.clientHeight},getClientWidth:function(a){a=a||document;return"CSS1Compat"==a.compatMode?a.documentElement.clientWidth:a.body.clientWidth},getScrollHeight:function(a){return a=a||document.documentElement,a.scrollHeight},getScrollWidth:function(a){return a=a||document.documentElement,a.scrollWidth},on:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               b,c,e,h,g){g=!!g;a=f.$(a);var k=function(b){if(!h)return c.apply(b.target,[b].concat(f.lang.isArray(e)&&[e]));for(var g=null,k=b.target;k&&k!=a;){if(matchesSelector(k,h)){g=k;break}k=k.parentNode}g&&c.apply(g,[b].concat(f.lang.isArray(e)&&[e]))};return a.addEventListener(b,k,g),k},unon:function(a,b,c,e){a.removeEventListener(b,c,e)}};f.cookie={get:function(a){return(a=document.cookie.match(new RegExp("(?:^|;\\s)"+a+"=(.*?)(?:;\\s|$)")))?a[1]:""},set:function(a,b,c){c=c||{};var e=new Date,f=c.domain||
    "pay.qq.com",g=c.path||"/";c=c.time||31536E7;e.setTime(e.getTime()+c);document.cookie=a+"="+b+"; path="+g+"; domain="+f+"; expires="+e.toUTCString()},del:function(a,b){b=b||{};b.time=-new Date;f.cookie.set(a,"",b)}}}();
(function(f){var g={};f._gettoken=function(a){if(0==a.ret){a={appid:g.appid,token:a.token,mid:a.mid,u:g.openid,sid:g.openkey,tc:"qdqb",pf:g.pf};var d=[];g.redirectUrl?a.ru=encodeURIComponent(g.redirectUrl):0;g.mpid?a.mpid=g.mpid:0;for(var b in a)("u"!=b&&"sid"!=b||"skey"!=g.session_type)&&d.push(b+"="+a[b]);location.href=INFO.CONFIGS.goodsInfoUrl+d.join("&")}else g.onError&&"function"==typeof g.onError&&g.onError({ret:a.ret,msg:a.msg})};f.mcash={buy:function(a){a=a||{};if("sid"==a.session_type){if(!a.openid)return a.onError&&
"function"==typeof a.onError&&a.onError({ret:"-10001",msg:"openid\u672a\u6307\u5b9a\uff01"}),void 0;if(!a.openkey)return a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10002",msg:"openkey\u672a\u6307\u5b9a\uff01"}),void 0}if(!a.productid&&!a.params)return a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10003",msg:"\u8d2d\u4e70\u5546\u54c1\u53d6token\u5931\u8d25\uff01"}),void 0;if(a.params){var d={params:encodeURIComponent(a.params),pf:a.pf||""},b=[];U.fn.extend(d,this._login_type(a));
    for(var c in d)b.push(c+"="+(d[c]||""));return a.redirecturl&&b.push("ru="+encodeURIComponent(a.redirecturl)),a.prevurl&&b.push("pu="+encodeURIComponent(a.prevurl)),a.homeurl&&b.push("hu="+encodeURIComponent(a.homeurl)),a.wxAppid&&b.push("wxAppid="+encodeURIComponent(a.wxAppid)),a.sandbox&&b.push("sandbox=1"),location.href="http://pay.qq.com/h5/?m=buy&c=goods&"+b.join("&"),void 0}if(!a.productid)return a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10003",msg:"\u8d2d\u4e70\u5546\u54c1id\u672a\u6307\u5b9a\uff01"}),
    void 0;if(!a.pf)return a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10004",msg:"\u5e73\u53f0pf\u672a\u6307\u5b9a\uff01"}),void 0;g.appid=a.appid||INFO.CONFIGS.appid;g.openid=a.openid;g.openkey=a.openkey;g.pf=a.pf;g.session_type=a.sessiontype||"sid";g.redirectUrl=a.redirecturl;g.onError=a.onError;g.mpid=a.mpid;a.goodsmeta=encodeURIComponent(INFO.GOODS[a.productid].goodsmeta);a.discountid=a.mpid||INFO.GOODS[a.productid].discountid;a.zoneid=1;a.provide_uin=a.openid;a.openkey=encodeURIComponent(a.openkey);
    a.pfkey="pfkey";a.pay_method="qdqb";a.from_h5=1;a.itemnum=1;a.appmode=1;a.format="jsonp__gettoken";a.session_id="uin";a.session_type=g.session_type;c=this._aes({openid:a.openid,openkey:a.openkey});d=[];a.encrypt_msg=c.encrypt_msg;a.msg_len=c.msg_len;for(b in a)"onError"!=b&&"redirecturl"!=b&&d.push(b+"="+(a[b]||""));U.req.loadScript("https://api.unipay.qq.com/v1/r/"+g.appid+INFO.CONFIGS.buyGoodsUrl+d.join("&")+"&r="+Math.random())},pay:function(a){a=a||{};var d={},b=[];a.openid||a.onError&&"function"==
typeof a.onError&&a.onError({ret:"-10001",msg:"openid\u672a\u6307\u5b9a\uff01"});a.openkey||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10002",msg:"openkey\u672a\u6307\u5b9a\uff01"});a.appid||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10005",msg:"appid\u672a\u6307\u5b9a\uff01"});a.pf=a.pf||"";d.appid=a.appid;d.pf=a.pf;d.al=a.al;U.fn.extend(d,this._login_type(a));for(var c in d)b.push(c+"="+d[c]);a.redirecturl&&b.push("ru="+encodeURIComponent(a.redirecturl));a.prevurl&&
b.push("pu="+encodeURIComponent(a.prevurl));a.homeurl&&b.push("hu="+encodeURIComponent(a.homeurl));a.sandbox&&b.push("sandbox=1");location.href="http://pay.qq.com/h5/index.shtml?m=buy&c=game&"+b.join("&")},openVipGift:function(a){a=a||{};var d={},b=[];a.openid||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10001",msg:"openid\u672a\u6307\u5b9a\uff01"});a.openkey||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10002",msg:"openkey\u672a\u6307\u5b9a\uff01"});a.appid||a.onError&&
"function"==typeof a.onError&&a.onError({ret:"-10005",msg:"appid\u672a\u6307\u5b9a\uff01"});a.service_code||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10006",msg:"\u5f00\u901a\u4e1a\u52a1\u4ee3\u7801\u672a\u6307\u5b9a\uff01"});a.uni_zoneid||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10008",msg:"uni_zoneid\u672a\u6307\u5b9a\uff01"});a.mpid||a.onError&&"function"==typeof a.onError&&a.onError({ret:"-10009",msg:"mpid\u672a\u6307\u5b9a\uff01"});a.pf=a.pf||"";a.uni_appid=a.uni_appid||
    a.appid;a.uni_openid=a.uni_openid||a.openid;a.uni_version=a.uni_version||"";a.tabService=a.tabService||a.service_code;a.aid=a.aid||"";U.fn.extend(d,this._login_type(a));d.appid=a.appid;d.c=a.service_code;d.uni_apptoken=a.uni_apptoken;d.uni_zoneid=a.uni_zoneid;d.mpid=a.mpid;d.pf=a.pf;d.uni_appid=a.uni_appid;d.uni_openid=a.uni_openid;d.uni_version=a.uni_version;d.tabService=a.tabService;d.aid=a.aid;for(var c in d)b.push(c+"="+d[c]);a.redirecturl&&b.push("ru="+encodeURIComponent(a.redirecturl));a.prevurl&&
b.push("pu="+encodeURIComponent(a.prevurl));a.homeurl&&b.push("hu="+encodeURIComponent(a.homeurl));a.sandbox&&b.push("sandbox=1");location.href="http://pay.qq.com/h5/index.shtml?m=buy&"+b.join("&")},_aes:function(a){var d=[],b;for(b in a)d.push(b+"="+(a[b]||""));d=d.join("&");return{encrypt_msg:CryptoJS.AES.encrypt(CryptoJS.enc.Latin1.parse(d),CryptoJS.enc.Latin1.parse(INFO.CONFIGS.aeskey),{padding:CryptoJS.pad.ZeroPadding,iv:CryptoJS.enc.Latin1.parse(INFO.CONFIGS.aeskey),mode:CryptoJS.mode.ECB}).ciphertext.toString(CryptoJS.enc.Hex),
    msg_len:d.length}},_login_type:function(a){return"sid"==a.session_type?{u:a.openid,sid:a.openkey}:a.openid?{openid:a.openid,openkey:a.openkey}:{}}}})(window);;
/**
 * Created by Grayson Rex on 2015/7/8.
 */
(function(){function tcss(e){this.url=[],this.init(e)}function loadScript(e){var t=document.createElement("script"),n=document.getElementsByTagName("script")[0];t.src=e,t.type="text/javascript",t.async=!0,n.parentNode.insertBefore(t,n)}var _d,_l,_b,_n="-",_params,_curDomain,_curUrl,_domainToSet,_refDomain,_refUrl,_image,_ext,_hurlcn,_tt,_ch=0,_crossDomain=0;_ver="tcss.3.1.5",_speedTestUrl="http://jsqmt.qq.com/cdn_djl.js",window.Tcss={};var _pgvVersion=typeof tracert=="function"&&typeof pgvGetColumn=="function"&&typeof pgvGetTopic=="function"&&typeof pgvGetDomainInfo=="function"&&typeof pgvGetRefInfo=="function";if(typeof _rep=="undefined")var _rep=1;tcss.prototype={init:function(e){e?_params=e:_params={},_d=document;if(!_params.statIframe&&window!=top)try{_d=top.document}catch(t){}typeof _d=="undefined"&&(_d=document),_l=_d.location,_b=_d.body,_pgvVersion&&(Tcss.d=_d,Tcss.l=_l),_ext=[],_hurlcn=[],_tt=[]},run:function(){var e,t,n;e=(new Date).getTime(),_cookie.init(),this.url.push(this.getDomainInfo()),this.coverCookie(),_cookie.setCookie("ssid"),_cookie.save(),this.url.unshift("http://pingfore."+this.getCookieSetDomain(_curDomain)+"/pingd?"),this.url.push(this.getRefInfo(_params));try{navigator.cookieEnabled?this.url.push("&pvid="+_cookie.setCookie("pgv_pvid",!0)):this.url.push("&pvid=NoCookie")}catch(r){this.url.push("&pvid=NoCookie")}this.url.push(this.getMainEnvInfo()),this.url.push(this.getExtendEnvInfo()),Tcss.pgUserType="";if(_params.pgUserType||_params.reserved2){var i=_params.pgUserType||_params.reserved2;i=escape(i.substring(0,256)),Tcss.pgUserType=i,_tt.push("pu="+Tcss.pgUserType)}_pgvVersion&&(pgvGetColumn(),pgvGetTopic(),this.url.push("&column="+Tcss.column+"&subject="+Tcss.subject),tracert()),this.url.push("&vs="+_ver),_cookie.setCookie("ts_uid",!0),t=(new Date).getTime(),_ext.push("tm="+(t-e)),_ch&&_ext.push("ch="+_ch),_params.extParam?n=_params.extParam+"|":n="",this.url.push("&ext="+escape(n+_ext.join(";"))),this.url.push("&hurlcn="+escape(_hurlcn.join(";"))),this.url.push("&rand="+Math.round(Math.random()*1e5)),typeof _speedMark=="undefined"?this.url.push("&reserved1=-1"):this.url.push("&reserved1="+(new Date-_speedMark));var s=this.getSud();s&&_tt.push("su="+escape(s.substring(0,256))),this.url.push("&tt="+escape(_tt.join(";"))),this.sendInfo(this.url.join(""));if(_crossDomain==1){var o=this.getParameter("tcss_rp_dm",_d.URL);if(o!=Tcss.dm){var u=this.url.join("").replace(/\?dm=(.*?)\&/,"?dm="+o+"&");this.sendInfo(u)}}_params.hot&&(document.attachEvent?document.attachEvent("onclick",function(e){pgvWatchClick(e)}):document.addEventListener("click",function(e){pgvWatchClick(e)},!1)),_params.repeatApplay&&_params.repeatApplay=="true"&&typeof _rep!="undefined"&&(_rep=1)},getSud:function(){if(_params.sessionUserType)return _params.sessionUserType;var e=_params.sudParamName||"sessionUserType",t=this.getParameter(e,_d.URL);return t},coverCookie:function(){if(_params.crossDomain&&_params.crossDomain=="on"){var e=this.getParameter("tcss_uid",_d.URL),t=this.getParameter("tcss_sid",_d.URL),n=this.getParameter("tcss_refer",_d.URL),r=this.getParameter("tcss_last",_d.URL);t&&e&&(_crossDomain=1,_cookie.setCookie("ssid",!1,t),_cookie.save(),_cookie.setCookie("ts_refer",!0,n),_cookie.setCookie("ts_last",!0,r),_cookie.setCookie("pgv_pvid",!0,e))}},getDomainInfo:function(e){var t,n;return t=_l.hostname.toLowerCase(),_params.virtualDomain&&(_hurlcn.push("ad="+t),t=_params.virtualDomain),n=this.getCurrentUrl(),Tcss.dm=t,_pgvVersion&&pgvGetDomainInfo(),_curDomain=Tcss.dm,_domainToSet||(_domainToSet=this.getCookieSetDomain(_l.hostname.toLowerCase()),_pgvVersion&&(Tcss.domainToSet=_domainToSet)),e&&(Tcss.dm+=".hot"),"dm="+Tcss.dm+"&url="+Tcss.url},getCurrentUrl:function(){var e="",t=_n;e=_curUrl=escape(_l.pathname),_l.search!=""&&(t=escape(_l.search.substr(1)));if(_params.senseParam){var n=this.getParameter(_params.senseParam,_d.URL);n&&(e+="_"+n)}_params.virtualURL&&(_hurlcn.push("au="+e),e=_params.virtualURL),Tcss.url=e,Tcss.arg=t},getRefInfo:function(e){var t=_n,n=_n,r=_n,i=_d.referrer,s,o,u;s=e.tagParamName||"ADTAG",o=this.getParameter(s,_d.URL),u=i.indexOf("://");if(u>-1){var a=/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)([^#|\?|\n]+)?(#.*)?(\?.*)?/i,f=i.match(a);f&&(t=f[2],n=f[4]+(f[5]?f[5]:""))}if(i.indexOf("?")!=-1){var u=i.indexOf("?")+1;r=i.substr(u)}var l=t;_params.virtualRefDomain&&(t!=_n&&_hurlcn.push("ard="+t),t=_params.virtualRefDomain),_params.virtualRefURL&&(n!=_n&&_hurlcn.push("aru="+escape(n)),n=_params.virtualRefURL);var c;o&&(c=t+n,t="ADTAG",n=o),_refDomain=t,_refUrl=escape(n);if(_refDomain==_n||_refDomain=="ADTAG"&&l==_n){var h=_cookie.get("ts_last=",!0);h!=_n&&_ext.push("ls="+h)}_cookie.setCookie("ts_last",!0,escape((_l.hostname+_l.pathname).substring(0,128)));var p=_cookie.get("ts_refer=",!0);p!=_n&&_ext.push("rf="+p);var d=_l.hostname;_params.inner&&(d=","+d+","+_params.inner+",");if(!(_refDomain==_n||(","+d+",").indexOf(_refDomain)>-1||_crossDomain==1)){var v=escape((_refDomain+n).substring(0,128));v!=p&&(_ch=2),_cookie.setCookie("ts_refer",!0,v)}return Tcss.rdm=_refDomain,Tcss.rurl=_refUrl,Tcss.rarg=escape(r),_pgvVersion&&pgvGetRefInfo(),c?"&rdm="+Tcss.rdm+"&rurl="+Tcss.rurl+"&rarg="+Tcss.rarg+"&or="+c:"&rdm="+Tcss.rdm+"&rurl="+Tcss.rurl+"&rarg="+Tcss.rarg},getMainEnvInfo:function(){var e="";try{var t=_n,n=_n,r=_n,i=_n,s=_n,o=0,u=navigator;self.screen&&(t=screen.width+"x"+screen.height,n=screen.colorDepth+"-bit"),u.language?r=u.language.toLowerCase():u.browserLanguage&&(r=u.browserLanguage.toLowerCase()),o=u.javaEnabled()?1:0,i=u.platform,s=(new Date).getTimezoneOffset()/60,e="&scr="+t+"&scl="+n+"&lang="+r+"&java="+o+"&pf="+i+"&tz="+s}catch(a){}finally{return e}},getExtendEnvInfo:function(){var e="";try{var t,n=_l.href,r=_n;e+="&flash="+this.getFlashInfo(),_b.addBehavior&&(_b.addBehavior("#default#homePage"),_b.isHomePage(n)&&(e+="&hp=Y")),_b.addBehavior&&(_b.addBehavior("#default#clientCaps"),r=_b.connectionType),e+="&ct="+r}catch(i){}finally{return e}},getFlashInfo:function(){var f=_n,n=navigator;try{if(n.plugins&&n.plugins.length){for(var i=0;i<n.plugins.length;i++)if(n.plugins[i].name.indexOf("Shockwave Flash")>-1){f=n.plugins[i].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var i=12;i>=5;i--)try{var fl=eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+i+"');");if(fl){f=i+".0";break}}catch(e){}}catch(e){}return f},getParameter:function(e,t){if(e&&t){var n=new RegExp("(\\?|#|&)"+e+"=([^&^#]*)(#|&|$)"),r=t.match(n);return r?r[2]:""}return""},getCookieSetDomain:function(e){var t,n,r,i=[],s=0;for(var o=0;o<e.length;o++)e.charAt(o)=="."&&(i[s]=o,s++);return t=i.length,n=e.indexOf(".cn"),n>-1&&t--,r="qq.com",t==1?r=e:t>1&&(r=e.substring(i[t-2]+1)),r},watchClick:function(e){try{var t=!0,n="",r;r=window.event?window.event.srcElement:e.target;switch(r.tagName){case"A":n="<A href="+r.href+">"+r.innerHTML+"</a>";break;case"IMG":n="<IMG src="+r.src+">";break;case"INPUT":n="<INPUT type="+r.type+" value="+r.value+">";break;case"BUTTON":n="<BUTTON>"+r.innerText+"</BUTTON>";break;case"SELECT":n="SELECT";break;default:t=!1}if(t){var i=new tcss(_params),s=i.getElementPos(r);if(_params.coordinateId){var o=i.getElementPos(document.getElementById(_params.coordinateId));s.x-=o.x}i.url.push(i.getDomainInfo(!0)),i.url.push("&hottag="+escape(n)),i.url.push("&hotx="+s.x),i.url.push("&hoty="+s.y),i.url.push("&rand="+Math.round(Math.random()*1e5)),i.url.unshift("http://pinghot."+this.getCookieSetDomain(_curDomain)+"/pingd?"),i.sendInfo(i.url.join(""))}}catch(u){}},getElementPos:function(e){if(e.parentNode===null||e.style.display=="none")return!1;var t=navigator.userAgent.toLowerCase(),n=null,r=[],i;if(e.getBoundingClientRect){var s,o,u,a;return i=e.getBoundingClientRect(),s=Math.max(document.documentElement.scrollTop,document.body.scrollTop),o=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),u=document.body.clientTop,a=document.body.clientLeft,{x:i.left+o-a,y:i.top+s-u}}if(document.getBoxObjectFor){i=document.getBoxObjectFor(e);var f=e.style.borderLeftWidth?Math.floor(e.style.borderLeftWidth):0,l=e.style.borderTopWidth?Math.floor(e.style.borderTopWidth):0;r=[i.x-f,i.y-l]}else{r=[e.offsetLeft,e.offsetTop],n=e.offsetParent;if(n!=e)while(n)r[0]+=n.offsetLeft,r[1]+=n.offsetTop,n=n.offsetParent;if(t.indexOf("opera")>-1||t.indexOf("safari")>-1&&e.style.position=="absolute")r[0]-=document.body.offsetLeft,r[1]-=document.body.offsetTop}e.parentNode?n=e.parentNode:n=null;while(n&&n.tagName!="BODY"&&n.tagName!="HTML")r[0]-=n.scrollLeft,r[1]-=n.scrollTop,n.parentNode?n=n.parentNode:n=null;return{x:r[0],y:r[1]}},sendClick:function(){_params.hottag&&(this.url.push(this.getDomainInfo(!0)),this.url.push("&hottag="+escape(_params.hottag)),this.url.push("&hotx=9999&hoty=9999"),this.url.push("&rand="+Math.round(Math.random()*1e5)),this.url.unshift("http://pinghot."+this.getCookieSetDomain(_curDomain)+"/pingd?"),this.sendInfo(this.url.join("")))},pgvGetArgs:function(){this.getDomainInfo();var e=[];return e.push("tcss_rp_dm="+Tcss.dm),e.push("tcss_uid="+_cookie.get("pgv_pvid=",!0)),e.push("tcss_sid="+_cookie.get("ssid=",!0)),e.push("tcss_refer="+_cookie.get("ts_refer=",!0)),e.push("tcss_last="+_cookie.get("ts_last=",!0)),e.join("&")},sendInfo:function(e){_image=new Image(1,1),Tcss.img=_image,_image.onload=_image.onerror=_image.onabort=function(){_image.onload=_image.onerror=_image.onabort=null,Tcss.img=null},_image.src=e}};var _cookie={sck:[],sco:{},init:function(){var e=this.get("pgv_info=",!0);if(e!=_n){var t=e.split("&");for(var n=0;n<t.length;n++){var r=t[n].split("=");this.set(r[0],unescape(r[1]))}}},get:function(e,t){var n=t?_d.cookie:this.get("pgv_info=",!0),r=_n,i,s;i=n.indexOf(e);if(i>-1){i+=e.length,s=n.indexOf(";",i),s==-1&&(s=n.length);if(!t){var o=n.indexOf("&",i);o>-1&&(s=Math.min(s,o))}r=n.substring(i,s)}return r},set:function(e,t){this.sco[e]=t;var n=!1,r=this.sck.length;for(var i=0;i<r;i++)if(e==this.sck[i]){n=!0;break}n||this.sck.push(e)},setCookie:function(e,t,n){var r=_l.hostname,i=_cookie.get(e+"=",t);if(i==_n&&!n){switch(e){case"ts_uid":_ext.push("nw=1");break;case"ssid":_ch=1}t?i="":i="s";var s=(new Date).getUTCMilliseconds();i+=Math.round(Math.abs(Math.random()-1)*2147483647)*s%1e10}else i=n?n:i;if(t)switch(e){case"ts_uid":this.saveCookie(e+"="+i,r,this.getExpires(1051200));break;case"ts_refer":this.saveCookie(e+"="+i,r,this.getExpires(259200));break;case"ts_last":this.saveCookie(e+"="+i,r,this.getExpires(30));break;default:this.saveCookie(e+"="+i,_domainToSet,"expires=Sun, 18 Jan 2038 00:00:00 GMT;")}else this.set(e,i);return i},getExpires:function(e){var t=new Date;return t.setTime(t.getTime()+e*60*1e3),"expires="+t.toGMTString()},save:function(){if(_params.sessionSpan){var e=new Date;e.setTime(e.getTime()+_params.sessionSpan*60*1e3)}var t="",n=this.sck.length;for(var r=0;r<n;r++)t+=this.sck[r]+"="+this.sco[this.sck[r]]+"&";t="pgv_info="+t.substr(0,t.length-1);var i="";e&&(i="expires="+e.toGMTString()),this.saveCookie(t,_domainToSet,i)},saveCookie:function(e,t,n){_d.cookie=e+";path=/;domain="+t+";"+n}};window.pgvMain=function(e,t){var n="";t?(n=t,_ver="tcsso.3.1.5"):(n=e,_ver="tcss.3.1.5");try{_pgvVersion&&(typeof pvRepeatCount!="undefined"&&pvRepeatCount==1?(_rep=1,pvRepeatCount=2):_rep=2);if(_rep!=1)return;_rep=2,(new tcss(n)).run()}catch(r){}},window.pgvSendClick=function(e){(new tcss(e)).sendClick()},window.pgvWatchClick=function(e){(new tcss(e)).watchClick(e)},window.pgvGetArgs=function(e){return(new tcss(e)).pgvGetArgs()},loadScript(_speedTestUrl)})()
;
var pt_logout={ret:0,appDomain:"",mainDomain:"",httpWhiteDomain:{"qq.com":1,"soso.com":1,"paipai.com":1,"tenpay.com":1,"taotao.com":1,"tencent.com":1,"oa.com":1,"webdev.com":1,"3366.com":1,"imqq.com":1,"pengyou.com":1,"qplus.com":1,"qzone.com":1,"server.com":1,"myapp.com":1,"kuyoo.cn":1,"weiyun.com":1,"wechatapp.com":1,"51buy.com":1,"yixun.com":1,"qcloud.com":1,"wechat.com":1,"weishi.com":1,"superfix.cn":1,"bkcloud.cc":1,"bkclouds.cc":1},getCookie:function(o){var t=document.cookie.match(new RegExp("(^| )"+o+"=([^;]*)(;|$)"));return t?decodeURIComponent(t[2]):""},delCookie:function(o,t,n){document.cookie=o+"=; expires=Mon, 26 Jul 1997 05:00:00 GMT; path="+(n?n:"/")+"; "+(t?"domain="+t+";":"")},jsonp:function(o){var t=document.createElement("script");t.setAttribute("src",o),document.getElementsByTagName("head")[0].appendChild(t),t.onerror=function(){t.onerror=null,pt_logout.set_ret(0,"")}},nlog:function(o,t,n){if(Math.random()<=(n||1)){var e="https:"==location.protocol?"https://ssl.qq.com/ptlogin/cgi-bin/ptlogin_report?":"http://log.wtlogin.qq.com/cgi-bin/ptlogin_report?",p=location.href,i=encodeURIComponent(o+"|_|"+p+"|_|"+window.navigator.userAgent),l=e+"mid="+t+"&msg="+i+"&v="+Math.random(),u=new Image;u.src=l}},init:function(){var o=location.hostname.match(/\w*\.(cc|com|cn|com\.cn)$/);pt_logout.mainDomain=o?o[0]:"",pt_logout.httpWhiteDomain[pt_logout.mainDomain]||pt_logout.nlog("公司外部域名引用logout","350448");var t=location.hostname.match(/\w+(\.\w+)\.(cc|com|cn|com\.cn)$/);pt_logout.appDomain=t?t[0]:"","qq.com"!=pt_logout.mainDomain&&(pt_logout.appDomain=pt_logout.mainDomain),pt_logout.nlog("logout pv","365716",.05)},getLogoutUrl:function(o){var t=pt_logout.getCookie("pt4_token"),n=pt_logout.getCookie("skey"),e=pt_logout.time33(n),p=pt_logout.getCookie("ptcz"),i=pt_logout.hash33(p),l="",u=o?"qq.com":pt_logout.mainDomain;return l=("https:"==location.protocol?"https://ssl.":"http://")+"ptlogin2."+u+"/logout?",l+="pt4_token="+t+"&pt4_hkey="+e+"&pt4_ptcz="+i+"&deep_logout=1"},time33:function(o){for(var t=0,n=0,e=o.length;e>n;n++)t=33*t+o.charCodeAt(n);return t%4294967296},hash33:function(o){for(var t=0,n=0,e=o.length;e>n;++n)t+=(t<<5)+o.charCodeAt(n);return 2147483647&t},clearCookie:function(o){o=o||pt_logout.appDomain,pt_logout.delCookie("p_uin",o),pt_logout.delCookie("p_skey",o),pt_logout.delCookie("p_luin",o),pt_logout.delCookie("p_lskey",o),pt_logout.delCookie("pt4_token",o),pt_logout.delCookie("pt_mbkey",pt_logout.mainDomain||"qq.com"),""!=pt_logout.appDomain&&""!=pt_logout.getCookie("skey_m")&&(pt_logout.delCookie("uin_m",pt_logout.appDomain),pt_logout.delCookie("skey_m",pt_logout.appDomain))},set_ret:function(o,t){try{var n=pt_logout.getCookie("pt4_token");pt_logout.clearCookie(t),o>0||(pt_logout.delCookie("uin",pt_logout.mainDomain),pt_logout.delCookie("skey",pt_logout.mainDomain),pt_logout.nlog("logout fail","285851",.1)),"function"==typeof pt_logout.callback&&pt_logout.callback(2),""!=t&&t!=pt_logout.appDomain&&pt_logout.nlog("domain unsame:n="+o+":pt4_token="+n+":cgi_domain="+t+":js_domain="+pt_logout.appDomain,"285852",.1)}catch(e){return}},logout:function(o,t){pt_logout.init();var n=pt_logout.getCookie("pt4_token"),e=pt_logout.getCookie("skey"),p=pt_logout.getCookie("ptcz");"function"==typeof o&&(pt_logout.callback=o);var i=pt_logout.getLogoutUrl(t);n||e||p?pt_logout.jsonp(i):("function"==typeof o&&o(2),pt_logout.nlog("logout without cookie",365715))},logoutQQCom:function(o){pt_logout.logout(o,!0),pt_logout.delCookie("uin",pt_logout.mainDomain),pt_logout.delCookie("skey",pt_logout.mainDomain)}};;

(function () {
    var _this = {},
        EasyKit = _this,
        EK = _this,
        ek = _this;

    if (!window.EasyKit) {
        window.EasyKit = EasyKit;
    }
    if (!window.EK) {
        window.EK = EK;
    }
    if (!window.ek) {
        window.ek = ek;
    }

    // 判断平台
    var UA = window.navigator.userAgent;

    // 客户端类型枚举
    var CLIENT = _this.CLIENT = {
        QQAC_ANDROID: 'QQAC_Android',
        QQAC_IOS: 'QQAC_iOS',
        WEIXIN: 'Weixin',
        QQ: 'MobileQQ',
        MYAPP: 'MyApp',
        WEIBO: 'Weibo',
        QZONE: 'QZone',
        QQNEWS: 'QQNews',
        QQBROWSER_HD: 'QQBrowser_HD',
        QQBROWSER: 'QQBrowser',
        UCBROWSER: 'UCBrowser',
        MANGOTV: 'MangoTV',
        OTHER: 'Other'
    };

    // 客户端类型对应的UA判断规则（靠前优先）
    var RULES = {
        QQAC_ANDROID: /(^| )QQAC_Client_Android( |\/|$)/i,
        QQAC_IOS: /(^| )QQAC_Client_iOS( |\/|$)/i,
        WEIXIN: /(^| )MicroMessenger( |\/|$)/i,
        QQ: /(^| )(QQ)( |\/|$)/i,
        MYAPP: /(^| |\/)(QQDownloader)( |\/|$)/i,
        WEIBO: /(^| )(Weibo)( |\/|$|\()/i,
        QZONE: /(^| )(Qzone)( |\/|$)/i,
        QQNEWS: /(^| )(QQNews)( |\/|$)/i,
        QQBROWSER_HD: /iPad.*?(^| )(MQQBrowser)( |\/|$)/i,
        QQBROWSER: /(^| )(MQQBrowser)( |\/|$)/i,
        UCBROWSER: /(^| )(UCBrowser)( |\/|$)/i,
        MANGOTV: /(^| )(ImgoTV-iphone|ImgoTV-aPhone)( |\/|$)/i
    };

    var clientType = CLIENT.OTHER;
    // 开始检测客户端类型
    for (var type in CLIENT) {
        if (!CLIENT.hasOwnProperty(type) || !RULES.hasOwnProperty(type)) {
            continue;
        }
        if (RULES[type].test(UA)) {
            clientType = CLIENT[type];
            break;
        }
    }
    _this.clientType = clientType;

    _this.isApp = clientType == CLIENT.QQAC_ANDROID || clientType == CLIENT.QQAC_IOS;
    _this.isSNS = clientType == CLIENT.WEIXIN || clientType == CLIENT.QQ || clientType == CLIENT.QZONE;

    _this.isAndroid = /(^| |\()(android)(;| |\/|$)/i.test(UA);
    _this.isIOS = /(^| |\()(iPhone|iPad)(;| |\/|$)/i.test(UA);

    if (_this.isApp) {
        var ms = /QQAC_Client_(Android|iOS)\/([0-9.]*)/i.exec(UA),
            verStr = ms && ms[2];
        _this.appVerStr = verStr || '未知';
        _this.appVer = verStr ? parseFloat(verStr) : 0;
        _this.appVers = verStr ? verStr.split('.') : [0];
    }

    _this.os = _this.isAndroid ? 'Android' :
        _this.isIOS ? 'iOS' :
            'Other';

    var _parent = _this;

/**
 * Created by krimeshu on 2015/12/29.
 */

(function (_parent) {

    var _this = _parent.FunctionHelper = _parent.func = {};

    // 主要供一些回调函数检测是否存在
    _this.apply = function (func, thisArg, argArr) {
        if (typeof(func) === 'function') {
            func.apply(thisArg, argArr);
        }
    };

    // 函数节流: 使func每隔timeSpan才会执行一次
    _this.throttle = function (func, timeSpan, thisArg) {
        var last = 0;
        return function () {
            var args = Array.prototype.splice.apply(arguments, [0]);
            var now = Date.now();
            if (now - last > timeSpan) {
                //console.log('Throttle exec.');
                last = now;
                typeof(func) === 'function' && func.apply(thisArg, args);
            }
            //else{
            //    console.log('Throttle miss.');
            //}
        };
    };

    // 函数节流：使func在timeSpan内被再次调用时，取消之前的调用，只执行一次
    _this.debounce = function (func, timeSpan, thisArg) {
        var timeout = null;
        return function () {
            var args = Array.prototype.splice.apply(arguments, [0]);
            if (timeout) {
                //console.log('Debounce canceled.');
                window.clearTimeout(timeout);
            }
            timeout = window.setTimeout(function () {
                typeof(func) === 'function' && func.apply(thisArg, args);
            }, timeSpan);
            //    console.log('Debounce setted.');
        };
    };

    // 对象深拷贝
    _this.deepCopy = function (origin, _copy) {
        var self = arguments.callee,
            type = Object.prototype.toString.call(origin),
            copy = origin;
        switch (type) {
            case '[object Object]':
                copy = _copy || {};
                for (var k in origin) {
                    if (origin.hasOwnProperty(k)) {
                        copy[k] = self(origin[k]);
                    }
                }
                break;
            case '[object Array]':
                copy = _copy || [];
                for (var i = 0, l = origin.length; i < l; i++) {
                    copy[i] = self(origin[i]);
                }
                break;
            case '[object Function]':
                copy = new Function(origin.toString());
                break;
        }
        return copy;
    };

})(_parent);
;

/**
 * Created by krimeshu on 2015/12/29.
 */

(function (_parent) {

    var _this = _parent.EncodingHelper = _parent.encoding = {};

    // 主要用来将字符处理成HTML编码
    _this.encodeHTML = function (text) {
        var temp = document.createElement("div");
        (temp.textContent != null) ? (temp.textContent = text) : (temp.innerText = text);
        var output = temp.innerHTML;
        temp = null;
        return output;
    };

    // 主要用来将HTML编码解码成字符
    _this.decodeHTML = function (html) {
        var temp = document.createElement("div");
        temp.innerHTML = html;
        var output = temp.innerText || temp.textContent;
        temp = null;
        return output;
    };

    // 将纯文本进行简单HTML过滤，防止XSS注入（富文本不适用）
    _this.preventHTML = function (text) {
        return text.replace(/</g, '&lt;');
    };

    var base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);

    /**
     * base64编码
     * @param {Object} str
     */
    _this.encodeBase64 = function (str) {
        var out, i, len;
        var c1, c2, c3;
        len = str.length;
        i = 0;
        out = "";
        while (i < len) {
            c1 = str.charCodeAt(i++) & 0xff;
            if (i == len) {
                out += base64EncodeChars.charAt(c1 >> 2);
                out += base64EncodeChars.charAt((c1 & 0x3) << 4);
                out += "==";
                break;
            }
            c2 = str.charCodeAt(i++);
            if (i == len) {
                out += base64EncodeChars.charAt(c1 >> 2);
                out += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                out += base64EncodeChars.charAt((c2 & 0xF) << 2);
                out += "=";
                break;
            }
            c3 = str.charCodeAt(i++);
            out += base64EncodeChars.charAt(c1 >> 2);
            out += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
            out += base64EncodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >> 6));
            out += base64EncodeChars.charAt(c3 & 0x3F);
        }
        return out;
    };

    /**
     * base64解码
     * @param {Object} str
     */
    _this.decodeBase64 = function (str) {
        var c1, c2, c3, c4;
        var i, len, out;
        len = str.length;
        i = 0;
        out = "";
        while (i < len) {
            /* c1 */
            do {
                c1 = base64DecodeChars[str.charCodeAt(i++) & 0xff];
            }
            while (i < len && c1 == -1);
            if (c1 == -1)
                break;
            /* c2 */
            do {
                c2 = base64DecodeChars[str.charCodeAt(i++) & 0xff];
            }
            while (i < len && c2 == -1);
            if (c2 == -1)
                break;
            out += String.fromCharCode((c1 << 2) | ((c2 & 0x30) >> 4));
            /* c3 */
            do {
                c3 = str.charCodeAt(i++) & 0xff;
                if (c3 == 61)
                    return out;
                c3 = base64DecodeChars[c3];
            }
            while (i < len && c3 == -1);
            if (c3 == -1)
                break;
            out += String.fromCharCode(((c2 & 0XF) << 4) | ((c3 & 0x3C) >> 2));
            /* c4 */
            do {
                c4 = str.charCodeAt(i++) & 0xff;
                if (c4 == 61)
                    return out;
                c4 = base64DecodeChars[c4];
            }
            while (i < len && c4 == -1);
            if (c4 == -1)
                break;
            out += String.fromCharCode(((c3 & 0x03) << 6) | c4);
        }
        return out;
    };

    /**
     * utf16转utf8
     * @param {Object} str
     */
    _this.utf16To8 = function (str) {
        var out, i, len, c;
        out = "";
        len = str.length;
        for (i = 0; i < len; i++) {
            c = str.charCodeAt(i);
            if ((c >= 0x0001) && (c <= 0x007F)) {
                out += str.charAt(i);
            }
            else if (c > 0x07FF) {
                out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));
                out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));
                out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
            }
            else {
                out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));
                out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
            }
        }
        return out;
    };

    /**
     * utf8转utf16
     * @param {Object} str
     */
    _this.utf8To16 = function (str) {
        var out, i, len, c;
        var char2, char3;
        out = "";
        len = str.length;
        i = 0;
        while (i < len) {
            c = str.charCodeAt(i++);
            switch (c >> 4) {
                case 0:
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                case 6:
                case 7:
                    // 0xxxxxxx
                    out += str.charAt(i - 1);
                    break;
                case 12:
                case 13:
                    // 110x xxxx 10xx xxxx
                    char2 = str.charCodeAt(i++);
                    out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));
                    break;
                case 14:
                    // 1110 xxxx10xx xxxx10xx xxxx
                    char2 = str.charCodeAt(i++);
                    char3 = str.charCodeAt(i++);
                    out += String.fromCharCode(((c & 0x0F) << 12) | ((char2 & 0x3F) << 6) | ((char3 & 0x3F) << 0));
                    break;
            }
        }
        return out;
    };

    /**
     * JSON解析（浏览器自带JSON解析出错时使用）
     * @param json
     * @returns {*}
     */
    _this.fromJSON = function (json) {
        try {
            return new Function('return ' + json)();
        } catch (e) {
            return null;
        }
    };

    /**
     * JSON编码
     * @param obj
     */
    _this.toJSON = function (obj, _last) {
        var buffer = [],
            type = Object.prototype.toString.call(obj),
            last = _last || [];
        if (last.indexOf(obj) >= 0) {
            throw new Error('Converting circular structure to JSON');
        }
        last.push(obj);
        switch (type) {
            case '[object Function]':
                // 函数不编码
                break;
            case '[object Array]':
                buffer.push('[');
                for (var i = 0, l = obj.length; i < l; i++) {
                    buffer.push(_this.toJSON(obj[i], last));
                    buffer.push(',');
                }
                if (buffer[buffer.length - 1] == ',') {
                    buffer.pop();
                }
                buffer.push(']');
                break;
            case '[object Object]':
                buffer.push('{');
                for (var k in obj) {
                    if (obj.hasOwnProperty(k)) {
                        buffer.push('"');
                        buffer.push(k);
                        buffer.push('":');
                        buffer.push(_this.toJSON(obj[k], last));
                        buffer.push(',');
                    }
                }
                if (buffer[buffer.length - 1] == ',') {
                    buffer.pop();
                }
                buffer.push('}');
                break;
            case '[object String]':
                buffer.push('"');
                buffer.push(obj.replace(/"/g, '\\"'));
                buffer.push('"');
                break;
            default:
                buffer.push(String(obj));
                break;
        }
        last.pop();
        return buffer.join('');
    };
})(_parent);
;

/**
 * Created by krimeshu on 2015/9/9.
 */
(function (_parent) {
    var _this = _parent.UrlHelper = _parent.url = {};

    // 获取当前域名
    _this.getDomain = function () {
        var domain = window.location.domain;
        if (!domain) {
            var a = document.createElement('A');
            a.href = '/';
            domain = String(a.href).replace(/(^http:\/\/|^https:\/\/|\/+$)/g, '');
        }
        return domain;
    };

    // 截取Path部分
    _this.getPathName = function () {
        var url = window.location.href.replace(/^(http|https):\/\//, '');
        var posL = url.indexOf('/') + 1;
        url = posL ? url.substr(posL - 1) : '';
        var posR = url.indexOf('?') + 1;
        url = posR ? url.substr(0, posR - 1) : url;
        return url;
    };

    // 截取所有queryString
    _this.getSearch = function () {
        var search = window.location.href.split('?')[1];
        return search ? '?' + search : '';
    };

    // 读取某个queryString
    _this.getQueryString = function (name) {
        var search = _this.getSearch(),
            result = search.match(new RegExp("[\\?\\&]" + name + "=([^\\&]+)", "i"));
        if (result == null || result.length < 1) {
            return '';
        }
        return decodeURIComponent(result[1]);
    };

    // 读取某个路径中的queryString
    _this.getPathQueryString = function (name) {
        var pathName = _this.getPathName(),
            tmp = pathName.split('/');
        for (var i = 1, l = tmp.length; i < l; i += 2) {
            var key = tmp[i],
                value = decodeURIComponent(tmp[i + 1]);
            if (key === name) {
                return value;
            }
        }
        return '';
    };
})(_parent);;

(function (_parent) {
    var _this = _parent.CookieHelper = _parent.cookie = {};

    // 写cookie
    _this.setCookie = function (key, value, expires, domain, path) {
        var values = [key + '=' + encodeURIComponent(value)];
        if (expires) {
            if (typeof (expires) == 'number') {
                var expiresTime = new Date();
                expiresTime.setMinutes(expiresTime.getMinutes() + expires);
            }
            values.push('expires=' + expiresTime.toGMTString());
        }
        if (domain) {
            values.push('domain=' + domain);
        }
        if (path) {
            values.push('path=' + path);
        }
        document.cookie = values.join(';');
    };

    // 移除cookie
    _this.removeCookie = function (key, domain, path) {
        _this.setCookie(key, '', -1440, domain, path);  // -1440min = 24hour = 1day
    };

    // 读取cookie
    _this.getCookie = function (key) {
        var allcookies = document.cookie;
        var cookiesReg = new RegExp('(^|;)\\s*' + key + '\\s*(=\\s*([^;$]*?))?(;|$)');
        var groups = cookiesReg.exec(allcookies);
        return decodeURIComponent(groups ? (groups[3] || '') : '');
    };
})(_parent);;

/**
 * Created by krimeshu on 2015/9/9.
 */
(function (_parent) {
    var _this = _parent.PingPlus = _parent.ping = {};

    _this._defaultAppUrls = {
        url_ios: "https://itunes.apple.com/cn/app/id569387346",
        url_android: "http://mobile.ac.qq.com/apkSet/qqcomic_android_h5.apk"
    };
    _this.init = function (opt) {
        _this.opt = opt || {};

        var url = {
            url_ios: opt.iOSAppUrl || _this._defaultAppUrls.url_ios,
            url_android: opt.androidAppUrl || _this._defaultAppUrls.url_android
        };
        _this.setAdUrls(url);

        this.downAppTagHead = opt.downAppTagHead || 'event_app_down';
        if (typeof(opt.downAppTag) != 'function') {
            var downAppTag = opt.downAppTag || '';
            opt.downAppTag = function () {
                return downAppTag;
            };
        }

        if (typeof(opt.virtualUrl) != 'function') {
            var virtualUrl = opt.virtualUrl || '';
            opt.virtualUrl = virtualUrl ? function () {
                return virtualUrl;
            } : _this.getVirtualURL;
        }

        if (typeof(opt.virtualDomain) != 'function') {
            var virtualDomain = opt.virtualDomain || '';
            opt.virtualDomain = virtualDomain ? function () {
                return virtualDomain;
            } : _this.getVirtualDomain;
        }

        opt.withSearch = !!opt.withSearch;

        if (opt.reportVisit) {
            _this.reportVisit(_this.opt.virtualUrl(), _this.opt.virtualDomain());
        }
    };
    _this.reportVisit = function (virtualUrl, virtualDomain) {
        var _this = this,
            para = {repeatApplay: "true"};

        if (virtualUrl) {
            para.virtualURL = virtualUrl;
        }

        virtualDomain = virtualDomain || _this.opt.virtualDomain();
        if (virtualDomain) {
            para.virtualDomain = virtualDomain;
        }

        window['pgvMain'] && window['pgvMain'](para);
    };
    _this.reportClick = function (hotTag, virtualDomain) {
        var _this = this,
            para = {};

        para.hottag = hotTag;

        virtualDomain = virtualDomain || _this.opt.virtualDomain();
        if (virtualDomain) {
            para.virtualDomain = virtualDomain;
        }

        window['pgvSendClick'] && window['pgvSendClick'](para);
    };
    _this.setAdUrls = function (urls) {
        _this.appAdUrls = urls;
        _this.appAdUrl = _parent.isIOS ? _this.appAdUrls.url_ios : _this.appAdUrls.url_android;
    };
    // 下载app并提交点击统计
    _this.downAppAndReport = function () {
        // 准备提交adTag
        _this.reportClick(_this.opt.downAppTag());
        window.setTimeout(function () {
            window.location.href = _this.appAdUrl;
        }, 100);
    };
    // 获取APP下载的hotTag
    _this.getDownAppTag = function (pageName) {
        return this.downAppTagHead + '.' + pageName + '.' + _parent.clientType + '.' + _parent.os;
    };
    // 获取虚拟路径，一般用于提交页面统计
    _this.getVirtualURL = function (_clientType) {
        var pathName = ek.url.getPathName();
        pathName = pathName.split('.')[0];
        var client = _clientType || _parent.clientType;
        var search = ek.url.getSearch();
        var url = pathName + '/' + client + (_this.opt.withSearch ? search : '');
        return url;
    };
    // 获取虚拟域名
    _this.getVirtualDomain = function () {
        return '';
    };
    _this.opt = _this._defaultOpt = {
        virtualUrl: _this.getVirtualURL,
        withSearch: true,
        downAppTag: function () {
            return _this.getDownAppTag('default');
        }
    };
    _this.setAdUrls(_this._defaultAppUrls);
})(_parent);;

/* AJAX函数 ST */
(function (_parent) {
    /**
     * 发送一个ajax请求
     * @param _param.url        请求的地址
     * @param _param.type       请求类型（GET/POST，默认为GET）
     * @param _param.data       发送的表单数据
     * @param _param.async      是否异步（默认为true）
     * @param _param.timeout    请求超时时间（默认为0，不判断超时）
     * @param _param.success    请求成功返回数据时的回调，接受一个res（回复的json数据）参数
     * @param _param.error      请求异常返回数据时的回调，接受一个状态码，可能会有一个res参数和ex异常参数
     *
     * 简单参数模式时，参数顺序请按以下顺序排列：
     *  utils.ajax(url[, type][, data][, async][, timeout], success[, error]);
     * - 普通错误状态码：HTTP状态码
     * - 特殊错误状态码：-999 请求发送失败，-1000 请求超时，-1001 返回结果解析失败
     */
    var ajax = function (_param) {
        var _this = {};
        var param = _this.param = convertArgs(arguments);

        var xhr = ajax.createXHR();
        xhr.async = param.async;
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                if (_this.abortted) {
                    // 已被废弃此请求
                    return;
                }
                if (xhr.status == 200) {
                    _this.completed = true;
                    // 请求成功
                    var res = xhr.responseText;
                    if (!param.rawResult) {
                        try {
                            res = JSON.parse(res);
                        } catch (ex) {
                            // 结果解析失败
                            param.error.call(_this, -1001, res, ex);
                        }
                    }
                    param.success.call(_this, res);
                } else {
                    // 请求不成功
                    try {
                        throw '请求失败！';
                    } catch (ex) {
                        param.error.call(_this, xhr.status, ex);
                    }
                }
            }
        };

        var url = param.url,
            data = null,
            stamp = 't=' + String(new Date().getTime()),
            sp = url.indexOf('?') + 1 ? '&' : '?';

        // 加上时间参数，可供服务器验证和排除缓存
        try {
            if (param.type.toLocaleLowerCase() == 'get') {
                // GET型请求时，参数编码后拼入URL中
                if (param.pathArgs) {
                    var urlArr = url.split('?'),
                        urlHead = urlArr[0],
                        urlTail = urlArr[1];
                    data = ajax.encodeArguments(param.data, 'path');
                    sp = urlHead[urlHead.length] != '/' ? '/' : '';

                    url = urlHead + sp + data + (urlTail || '');
                    sp = url.indexOf('?') + 1 ? '&' : '?';
                } else {
                    data = ajax.encodeArguments(param.data, 'get');

                    url = url + sp + data;
                    sp = url.indexOf('?') + 1 ? '&' : '?';
                }
                url += sp + stamp;

                _this.trueUrl = url;
                _this.trueData = data;

                xhr.open('GET', url, true);
                ajax.setTimeout.call(_this);
                xhr.send();
            } else if (param.type.toLocaleLowerCase() == 'post') {
                // POST型请求时，设置Content-Type后，将编码后参数在请求体内发送
                url += sp + stamp;

                data = ajax.encodeArguments(param.data, 'post');

                _this.trueUrl = url;
                _this.trueData = data;

                xhr.open('POST', url, true);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                ajax.setTimeout.call(_this);
                xhr.send(data);
            }
        } catch (ex) {
            // 请求发送失败
            param.error.call(_this, -999, '', ex);
        }
    };
    ajax.setTimeout = function () {
        var _this = this, param = this.param;
        if (param.timeout) {
            _this.timeout = window.setTimeout(function () {
                if (!_this.completed) {
                    // 超时废弃
                    _this.abortted = true;
                    try {
                        throw '请求超时！';
                    } catch (ex) {
                        param.error.call(_this, -1000, '', ex);
                    }
                }
                _this.timeout = null;
            }, param.timeout);
        }
    };
    ajax.createXHR = function () {
        var xhr = null;
        if (window.XMLHttpRequest) { // Mozilla, Safari,...
            xhr = new XMLHttpRequest();
            if (xhr.overrideMimeType) {
                xhr.overrideMimeType('text/xml');
            }
        } else if (window.ActiveXObject) { // IE
            try {
                xhr = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                try {
                    xhr = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {
                }
            }
        }
        if (!xhr) {
            throw '无法创建XMLHttpRequest对象';
        }
        return xhr;
    };
    ajax.encodeArguments = function (data, pathStyle) {
        var tmp = [],
            sp = pathStyle === 'path' ? '/' : '=';
        if (data) {
            for (var key in data) {
                var value = data[key];
                value = pathStyle === 'post' ? value : encodeURIComponent(value);
                if (typeof(value) != 'string') {
                    value = JSON.stringify(value);
                }
                tmp.push(key + sp + value);
            }
        }
        return tmp.join(pathStyle === 'path' ? '/' : '&');
    };

    var DEFAULT = {
        url: '/action/',
        type: 'get'
    };
    var convertArgs = function (args) {
        var param = {
            url: DEFAULT.url,
            type: DEFAULT.type,
            data: {},
            timeout: 0,
            async: true,
            rawResult: false,
            pathArgs: false,
            success: function () {
            },
            error: function () {
            }
        }, _param = null;
        args = Array.prototype.slice.call(args, 0);
        if (typeof(args[0]) == 'object') {
            _param = args[0];
            for (var i in  _param) {
                param[i] = _param[i];
            }
        } else {
            var _prop = ['url', 'type', 'data', 'timeout', 'async', 'rawResult', 'pathArgs', 'success', 'error'],
                _type = ['string', 'string', 'object', 'number', 'boolean', 'boolean', 'boolean', 'function', 'function'];
            for (var i = 0, p, t; (p = _prop[i]) && (t = _type[i]); i++) {
                if (typeof(args[0]) == t) {
                    param[p] = args.splice(0, 1)[0];
                }
            }
        }
        return param;
    };

    _parent.MyAjax = _parent.ajax = ajax;
})(_parent);
/* AJAX函数 ED */;

/**
 * 分享信息相关
 * Edit by: Krimeshu
 * At: 2015/09/09
 * */
(function (_parent) {
    window.H5 = window.H5 || {};

    H5.share = _parent.ShareHelper = _parent.share = {};
    var _this = H5.share;

    !window.onAppShare && ( window.onAppShare = function (ret) {
        console.log('onAppShare: ' + ret);
    });

    _this.shareConfig = window['shareConfig'] || {
            img_url: "http://ac.gtimg.com/h5_phone/logo-app_54661c9c1c4b5bfb.png",
            title: document.title || '精彩条漫 - 腾讯动漫',
            desc: '中国最大最权威的正版动漫网站',
            link: window.location.href,                             //分享链接地址，常用window.location.href
            callback: 'onAppShare'
        };

    var UA = window.navigator.userAgent;

    // 配置所有分享信息
    _this.setShare = function (_shareConfig) {
        if (typeof _shareConfig === 'object') {
            for (var k in _shareConfig) {
                if (_shareConfig.hasOwnProperty(k)) {
                    _this.shareConfig[k] = _shareConfig[k];
                }
            }
        } else if (typeof arguments[0] === 'string' && arguments[1]) {
            var key = arguments[0],
                value = arguments[1];
            _this.shareConfig && (_this.shareConfig[key] = value);
        }
        _this.setQQShare();
        _this.setWxShare();
        if ((_parent.clientType == _parent.CLIENT.QQAC_ANDROID && _parent.appVer >= 5.1) ||
            (_parent.clientType == _parent.CLIENT.QQAC_IOS)) {
            _this.setAppShare();
        }
    };

    // 读取META中配置的分享信息
    _this.readMeta = function (itemProp) {
        return document.querySelector('meta[itemprop="' + itemProp + '"]').getAttribute('content');
    };

    //腾讯动漫APP分享
    _this.appShare = function () {
        var shareConfig = _this.shareConfig;
        H5.appPlus.share({
            "imgurl": shareConfig.img_url,
            "title": shareConfig.title,
            "content": shareConfig.desc,
            "pageurl": shareConfig.link,
            "callback": shareConfig.callback
        });
    };

    //腾讯动漫APP分享信息设置
    _this.setAppShare = function () {
        var shareConfig = _this.shareConfig;
        H5.appPlus.setShareInfo({
            "imgurl": shareConfig.img_url,
            "title": shareConfig.title,
            "content": shareConfig.desc,
            "pageurl": shareConfig.link,
            "callback": shareConfig.callback
        });
    };

    // 设置微信分享信息
    _this.setWxShare = function () {
        var shareConfig = _this.shareConfig,
            callback = shareConfig.callback;
        callback = typeof(callback) === 'string' ? window[callback] : callback;
        callback = typeof(callback) === 'function' ? callback : null;
        // 转换分享信息
        _this.wxShareContent = {
            "img_url": shareConfig.img_url,
            "img_width": 120,
            "img_height": 120,
            "link": shareConfig.link,
            "desc": shareConfig.desc,
            "title": shareConfig.title,
            "title_raw": shareConfig.title,
            "callback": callback
        };
        if (!_this._wxShareSetOK) {
            // 注册相关监听器
            var _share = function () {
                //console.log('shareContent: %s\ntypeof(callback): %s', JSON.stringify(shareContent), typeof(callback));
                try {
                    // 分享到朋友圈
                    WeixinJSBridge.on('menu:share:timeline', function (argv) {
                        var shareContent = _this.wxShareContent,
                            callback = shareContent.callback;
                        shareContent.title = shareConfig.title_timeline || shareContent.title;
                        WeixinJSBridge.invoke('shareTimeline', shareContent, function (res) {
                            callback && callback(res);
                        });
                    });
                    // 发送给好友
                    WeixinJSBridge.on('menu:share:appmessage', function (argv) {
                        var shareContent = _this.wxShareContent,
                            callback = shareContent.callback;
                        shareContent.title = shareConfig.title_raw || shareContent.title;
                        WeixinJSBridge.invoke('sendAppMessage', shareContent, function (res) {
                            callback && callback(res);
                        });
                    });
                } catch (e) {
                    // do nothing
                }
            }
            if (typeof WeixinJSBridge == "object" && typeof WeixinJSBridge.invoke == "function") {
                _share();
            } else {
                if (document.addEventListener) {
                    document.addEventListener("WeixinJSBridgeReady", _share, false);
                } else if (document.attachEvent) {
                    document.attachEvent("WeixinJSBridgeReady", _share);
                    document.attachEvent("onWeixinJSBridgeReady", _share);
                }
            }
            _this._wxShareSetOK = true;
        }
    };

    var isQQ = /(^| )QQ( |\/|$)/i.test(UA);
    if (isQQ) {
        var QQscript = document.createElement('script');
        QQscript.setAttribute('type', 'text/javascript');
        QQscript.src = 'http://pub.idqqimg.com/qqmobile/qqapi.js';
        window.addEventListener('load', function () {
            document.body.appendChild(QQscript);
        });
        QQscript.onload = function () {
            var cache = _this._setQQShare.cache;
            window.mqq && window.mqq.data && window.mqq.data.setShareInfo &&
            (_this._setQQShare = window.mqq.data.setShareInfo);
            if (cache) {
                _this._setQQShare.apply(null, cache);
            }
        };
    }

    //手Q分享配置：（PS：这种方式在发给QQ好友时可能会失效，还是需要配置meta，且从微信发给QQ好友时meta也没救了……）
    /*
     手Q分享meta格式：
     <meta name="description" itemprop="description" content="分享标题"/>
     <meta itemprop="name" content="分享简介"/>
     <meta itemprop="image" content="分享预览图"/>
     */
    _this.setQQShare = function () {
        if (!isQQ) {
            return;
        }
        var shareConfig = _this.shareConfig,
            callback = shareConfig.callback;
        callback = typeof(callback) === 'string' ? window[callback] : callback;
        callback = typeof(callback) === 'function' ? callback : null;
        _this._setQQShare({
                "share_url": shareConfig.link,
                "title": shareConfig.title,
                "desc": shareConfig.desc,
                "image_url": shareConfig.img_url
            },
            callback
        );
    };
    _this._setQQShare = function () {
        _this._setQQShare.cache = arguments;
    };


    /*
     调用WEB版空间分享
     参数：title、summary、url、desc、imageUrl、site、successUrl
     */
    var _shareToQZone = function (params) {
        var uin = (params && params["uin"]) ? params["uin"] : '';
        var skey = (params && params["skey"]) ? params["skey"] : '';
        var lskey = (params && params["lskey"]) ? params["lskey"] : '';
        var sid = (params && params["sid"]) ? params["sid"] : '';
        var title = (params && params["title"]) ? params["title"] : '腾讯动漫';
        var summary = (params && params["summary"]) ? params["summary"] : '腾讯动漫';
        var url = (params && params["url"]) ? params["url"] : 'http://' + ek.url.getDomain() + '/';
        var desc = (params && params["desc"]) ? params["desc"] : '腾讯动漫';
        var imageUrl = (params && params["imageUrl"]) ? params["imageUrl"] : '';
        var site = (params && params["site"]) ? params["site"] : 'http://' + ek.url.getDomain() + '/';
        var successUrl = (params && params["successUrl"]) ? params["successUrl"] : 'http://' + ek.url.getDomain() + '/';

        var actionUrl = 'http://openmobile.qq.com/api/check2';

        var html = '<form id="qzone_form" action="' + actionUrl + '" method="GET">' +
            '<input type="hidden" name="page" value="qzshare.html">' +
            '<input type="hidden" name="loginpage" value="loginindex.html">' +
            '<input type="hidden" name="logintype" value="qzone">' +
            '<input type="hidden" name="uin" value="' + uin + '">' +
            '<input type="hidden" name="skey" value="' + skey + '">' +
            '<input type="hidden" name="lskey" value="' + lskey + '">' +
            '<input type="hidden" name="sid" value="' + sid + '">' +
            '<input type="hidden" name="title" value="' + title + '">' +
            '<input type="hidden" name="summary" value="' + summary + '">' +
            '<input type="hidden" name="url" value="' + url + '">' +
            '<input type="hidden" name="desc" value="' + desc + '">' +
            '<input type="hidden" name="imageUrl" value="' + imageUrl + '">' +
            '<input type="hidden" name="site" value="' + site + '">' +
            '<input type="hidden" name="successUrl" value="' + successUrl + '">' +
            '</form>';
        var box = document.createElement('div');
        box.className = 'dn';
        box.innerHTML = html;
        document.body.appendChild(box);
        var form = document.getElementById('qzone_form');
        form.submit();
        box.removeChild(form);
    };

    _this.shareToQZone = function (user) {
        var shareConfig = _this.shareConfig;

        user = user || {};
        var uin = user.uin || '';
        var skey = user.skey || '';
        var lskey = user.lskey || '';
        var sid = user.sid || '';
        var url = shareConfig.link;
        var title = shareConfig.title;
        var img = shareConfig.img_url;
        var desc = shareConfig.desc;
        var summary = shareConfig.title;
        var prefix = url.indexOf('?') + 1 ? '&' : '?';
        var successUrl = shareConfig.successUrl ||
            url + (typeof(shareConfig.callback) === 'string' ? prefix + 'shareCallback=' + shareConfig.callback : '');
        _shareToQZone({
            uin: uin,
            skey: skey,
            lskey: lskey,
            sid: sid,
            title: title,
            desc: desc,
            imageUrl: img,
            url: url,
            summary: summary,
            successUrl: successUrl
        });
    };


    function getQueryString(key) {
        if (!getQueryString.data) {
            var data = {};
            var wl = window.location;
            var qss = (wl.href.split('?')[1] || '').split('&');
            for (var i = 0, qs; qs = qss[i]; i++) {
                var kv = qs.split('=');
                data[kv[0]] = decodeURIComponent(kv[1]);
            }
            getQueryString.data = data;
        }
        return getQueryString.data[key];
    }

    var urlCallback = getQueryString('shareCallback');
    if (urlCallback) {
        // 浏览器跳转回来时执行回调函数
        if (typeof(window[urlCallback]) === 'function') {
            window[urlCallback]();
        }
    }

})(_parent);;

/**
 * Created by krimeshu on 2015/9/9.
 */
(function(){

    window.H5 = window.H5 || {};

    // 客户端调用Web
    H5.forApp = {};

    // 客户端点击返回键时的回调
    H5.forApp.onKeyBackClicked = function () {
        H5.appPlus.webFinish();
    };
})();;

(function (_parent) {

    var UA = window.navigator.userAgent;

    window.H5 = window.H5 || {};

    // WEB调用客户端
    H5.appPlus = _parent.AppPlus = _parent.app = {};

    H5.appPlus.isQQACAndroid = /(^| )QQAC_Client_Android( |\/|$)/i.test(UA);
    H5.appPlus.isQQACIOS = /(^| )QQAC_Client_iOS( |\/|$)/i.test(UA);
    H5.appPlus.isApp = H5.appPlus.isQQACAndroid || H5.appPlus.isQQACIOS;
    H5.appPlus.isQQ = /(^| )QQ( |\/|$)/i.test(UA);
    H5.appPlus.isWeixin = /(^| )MicroMessenger( |\/|$)/i.test(UA);
    H5.appPlus.isSNS = H5.appPlus.isQQ || H5.appPlus.isWeixin;

    // 回调函数封装
    var CB = {
        _callbacks: {},
        _genCallbackID: function () {
            var id = null;
            do {
                id = 'cb_' + Date.now() + '_' + String(Math.random()).substring(2);
            } while (CB._callbacks[id]);
            return ['window._client_callbacks.' + id, id];
        },
        _delCallbackID: function (id) {
            delete CB._callbacks[id];
        },
        callback2string: function (callback, keepAfterCall) {
            var callbackName = CB._genCallbackID();
            var name = callbackName[0];
            var id = callbackName[1];
            CB._callbacks[id] = function () {
                //console.log('_callbacks["%s"]: %s', id, JSON.stringify(arguments));
                if (!keepAfterCall) {
                    CB._delCallbackID(id);
                }
                callback.apply(this, arguments);
            };
            return name;
        },
        string2callback: function (name) {
            if (typeof(callback) != 'function') {
                var t = /^window(\.|\["|\[')(.*?)($|']|"])/i.exec(String(name));
                name = t[1] || name;
                return window[name];
            } else {
                return name;
            }
        },
        parseCallbackRes: function (callback) {
            return function (res) {
                if (res && typeof(res) == 'string') {
                    res = JSON.parse(res);
                }
                callback(res);
            };
        }
    };
    window._client_callbacks = CB._callbacks;

    // prompt根据不同端做对应的处理
    var _prompt = (function () {
        if (H5.appPlus.isQQACAndroid) {
            //console.log('Prompt for android: raw prompt.');
            return function (params, forceAsync) {
                // android的接口调用形式
                //if (_prompt.isBusy) {
                //    // 防止接口阻塞
                //    window.setTimeout(function () {
                //        _prompt(params, forceAsync);
                //    }, 50);
                //    return;
                //}
                //_prompt.isBusy = true;
                if (forceAsync) {
                    var callback = params.callback;
                    delete params.callback;
                    var res = window['prompt'](JSON.stringify(params));
                    callback(res);
                    //_prompt.isBusy = false;
                    return null;
                } else {
                    if (typeof(params.callback) == 'function') {
                        params.callback = CB.callback2string(params.callback);
                        //_prompt.isBusy = false;
                    }
                    return window['prompt'](JSON.stringify(params));
                }
            };
        } else if (H5.appPlus.isQQACIOS) {
            //console.log('Prompt for iOS: fake prompt.');
            return window['callClient'] = function (params, forceAsync) {
                // iOS的接口调用形式
                if (typeof(params.callback) == 'function') {
                    params.callback = CB.callback2string(params.callback);
                }
                var url = 'callClient://'.toLowerCase() + encodeURIComponent(JSON.stringify(params));
                var tmpFormBox = document.createElement('div');
                tmpFormBox.style.display = 'none';
                tmpFormBox.innerHTML = '<iframe src="' + (url) + '" data-force-async="' + (forceAsync) + '"></iframe>';
                document.body.appendChild(tmpFormBox);
            };
        } else {
            return function () {
                // 页面调试时，只输出日志
                console.log('_prompt: (%s)', JSON.stringify(Array.prototype.slice.call(arguments, 0)));
            };
        }
    })();
    window['_prompt'] = _prompt;

    /**
     *  接口说明：判断APP是否登录
     *  已登录返回一个包含uin,skey的对象
     *  未登录返回false
     */
    H5.appPlus.isAppLogin = function (callback) {
        var json = {
            "interface": "isLogin",
            "callback": function (response) {
                var obj = response && JSON.parse(response),
                    ret = false;
                if (typeof(callback) == 'string') {
                    callback = CB.string2callback(callback)
                }
                if (obj && obj.ret == 1) {
                    ret = {
                        ret: 1,
                        uin: obj['uin'],
                        nick: obj['nickname'],
                        head: obj['qqhead'],
                        sid: obj['sid'],
                        skey: obj['skey'],
                        ticket: obj['ticket']
                    };
                    callback(ret);
                } else {
                    callback(null);
                }
            }
        };
        // 此接口安卓端需强制同步转异步
        _prompt(json, true);
    };

    /**
     * 接口说明：判断APP是否登录，
     * 已登录返回一个包含uin,skey的对象
     * 未登录则呼起APP登录框，如果有回调函数则,APP登录成功后将执行回调函数
     */
    H5.appPlus.appLogin = function (callback) {
        var json = {
            "interface": "appLogin",
            "callback": callback
        };
        if (H5.appPlus.isQQACAndroid) {
            json.callback = function (response) {
                var obj = response && JSON.parse(response);
                if (typeof(callback) == 'string') {
                    callback = CB.string2callback(callback)
                }
                if (obj && obj.ret == 1) {
                    H5.appPlus.isAppLogin(callback);
                } else {
                    callback(null);
                }
            };
            // 此接口较特殊，安卓端存在同步和异步两种返回形式
            // 需再处理一次，并忽略未登录时的同步返回值
            var response = _prompt(json);
            var obj = response && JSON.parse(response);
            if (obj && obj.ret == 1) {
                H5.appPlus.isAppLogin(callback);
            }
        } else {
            _prompt(json);
        }
    };

    /**
     * 接口说明：呼起强制登陆框
     * */
    H5.appPlus.appRelogin = H5.appPlus.reLogin = function (callback) {
        var json = {
            "interface": "app_relogin",
            "callback": function (response) {
                var obj = JSON.parse(response);
                if (typeof(callback) == 'string') {
                    callback = CB.string2callback(callback)
                }
                if (obj && obj.ret == 1) {
                    H5.appPlus.isAppLogin(callback);
                } else {
                    callback(null);
                }
            }
        };
        // 此接口安卓端需强制同步转异步
        _prompt(json);
    };

    /**
     * 接口说明：呼起APP的详情页
     * @param comicId 漫画ID
     */
    H5.appPlus.goComicDetail = function (comicId) {
        if (!comicId) {
            return;
        }
        var json = {
            "interface": "goComicDetail",
            "data": {
                id: comicId
            }
        };
        _prompt(json);
    };

    /**
     * 接口说明：跳转到自己的个人中心
     */
    H5.appPlus.goUserCenter = function () {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.2)) {
            var json = {
                "interface": "goUserCenter",
                "data": {}
            };
            _prompt(json);
        } else {
            console.error('此版本暂不支持 goUserCenter 接口');
        }
    };

    /**
     * 接口说明：跳转到他人的个人中心
     */
    H5.appPlus.goVisitorCenter = function (uin) {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.3)) {
            var json = {
                "interface": "goVisitorCenter",
                "data": {
                    uin: uin
                }
            };
            _prompt(json, true);
        } else {
            console.error('此版本暂不支持 goVisitorCenter 接口');
        }
    };

    /**
     * 接口说明：跳转到操场界面
     */
    H5.appPlus.goGround = function () {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.4)) {
            var json = {
                "interface": "goGround",
                "data": {}
            };
            _prompt(json);
        } else {
            console.error('此版本暂不支持 goGround 接口');
        }
    };

    /**
     * 接口说明：跳转到书架历史界面
     */
    H5.appPlus.goHistory = function () {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.4)) {
            var json = {
                "interface": "goHistory",
                "data": {}
            };
            _prompt(json);
        } else {
            console.error('此版本暂不支持 goHistory 接口');
        }
    };

    /**
     * 接口说明：跳转到操话题详情界面
     */
    H5.appPlus.goTopicDetail = function (id, topicId) {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.4)) {
            var json = {
                "interface": "goTopicDetail",
                "data": {
                    id: id,
                    topic_id: topicId
                }
            };
            _prompt(json);
        } else {
            console.error('此版本暂不支持 goTopicDetail 接口');
        }
    };

    /**
     * 接口说明：收藏漫画
     * @param comicId 漫画ID
     * @param title 漫画标题
     * @param coverUrl 漫画封面
     * @param latedSeqno 最新章节序号
     * @param callback 处理结果的回调函数（ret值1为成功，其它为失败）
     */
    H5.appPlus.collectComic = function (comicId, title, coverUrl, latedSeqno, callback) {
        if (!comicId || !title || !coverUrl) {
            return;
        }
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.2)) {
            var json = {
                "interface": "collectComic",
                "callback": CB.parseCallbackRes(callback),
                "data": {
                    comic_id: comicId,
                    title: title,
                    cover_url: coverUrl,
                    lated_seqno: latedSeqno
                }
            };
            _prompt(json, true);
        }
    };

    /**
     * 接口说明：判断漫画是否已收藏
     * @param comicId 漫画ID
     * @param callback 处理结果的回调函数（ret值1为成功，其它为失败）
     */
    H5.appPlus.isComicCollected = function (comicId, callback) {
        if (!comicId) {
            return;
        }
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.2)) {
            var json = {
                "interface": "isComicCollected",
                "callback": CB.parseCallbackRes(callback),
                "data": {
                    comic_id: comicId
                }
            };
            _prompt(json, true);
        }
    };

    /**
     * 接口说明：移除漫画收藏
     * @param comicId 漫画ID
     * @param callback 处理结果的回调函数（ret值1为成功，其它为失败）
     */
    H5.appPlus.cancelComicCollected = function (comicId, callback) {
        if (!comicId) {
            return;
        }
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.2)) {
            var json = {
                "interface": "cancelComicCollected",
                "callback": CB.parseCallbackRes(callback),
                "data": {
                    comic_id: comicId
                }
            };
            _prompt(json, true);
        }
    };

    /**
     * 接口说明：获取漫画的阅读历史
     * @param comicId 漫画ID
     * @param callback 处理阅读记录的回调函数（ret值1为成功，其它为失败；last_seq_no值为上次阅读的章节序号；last_chapter_id为上次阅读的章节id）
     */
    H5.appPlus.getReadHistory = function (comicId, callback) {
        if (!comicId) {
            return;
        }
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.2)) {
            var json = {
                "interface": "getReadHistory",
                "callback": CB.parseCallbackRes(callback),
                "data": {
                    comic_id: comicId
                }
            };
            _prompt(json, true);
        }
    };

    /**
     * 接口说明：记录漫画的阅读历史
     * @param comicId 漫画ID
     * @param title 漫画名称
     * @param coverUrl 漫画封面
     * @param cid 漫画章节ID
     * @param seq 漫画章节序号
     * @param callback 判断收藏结果的回调函数（ret值1为成功，其它为失败）
     */
    H5.appPlus.setReadHistory = function (comicId, title, coverUrl, cid, seq, callback) {
        if (!comicId) {
            return;
        }
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.2)) {
            var json = {
                "interface": "setReadHistory",
                "callback": CB.parseCallbackRes(callback),
                "data": {
                    comic_id: comicId,
                    title: title,
                    cover_url: coverUrl,
                    chapter_id: cid,
                    seq_no: seq
                }
            };
            _prompt(json, true);
        }
    };

    /**
     * 接口说明：呼起APP的VIP充值
     * @param month 充值月数
     * @param aid 充值标记，可在 http://data.ac.oa.com/VipSource/VipSource?nav=pay 进行配置
     */
    H5.appPlus.vipPay = function (month, aid) {
        month = month === undefined ? '' : month;
        aid = aid === undefined ? "h5_app_pay" : aid;
        var json = {
            "interface": "payVip",
            "data": {
                month: month,
                aid: aid
            }
        };
        _prompt(json);
    };

    /**
     * 接口说明：呼起APP的分享页面
     * params是个参数对象,该对象可包含如下字段:
     * "imgurl": "http://ac.gtimg.com/h5_phone/ic_launcher_82b9adf0897c6846.png",
     * "title": "欢乐看漫画 轻松赢iPhone6！还有小米平板、超萌公仔海量Q币等你来拿！",
     * "content": "小米平板、超萌公仔还有海量Q币，送送送！",
     * "pageurl": "http://m.ac.qq.com/H5Event/ComicGift/index_share",
     * "callback": "onAppShare"（参数说明：0=失败 1=成功 2=取消）
     */
    H5.appPlus.share = function (params) {
        var json = {
            "interface": "appShare",
            "callback": params.callback || "",
            "data": {
                "imgurl": params.imgurl,
                "title": params.title,
                "content": params.content,
                "pageurl": params.pageurl
            }
        };
        _prompt(json);
    };


    /**
     * 接口说明：不呼起APP的分享页面，只设置分享信息
     * params是个参数对象,该对象可包含如下字段:
     * "imgurl": "http://ac.gtimg.com/h5_phone/ic_launcher_82b9adf0897c6846.png",
     * "title": "欢乐看漫画 轻松赢iPhone6！还有小米平板、超萌公仔海量Q币等你来拿！",
     * "content": "小米平板、超萌公仔还有海量Q币，送送送！",
     * "pageurl": "http://m.ac.qq.com/H5Event/ComicGift/index_share",
     * "callback": "onAppShare"（参数说明：0=失败 1=成功 2=取消）
     */
    H5.appPlus.setShareInfo = function (params) {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.1)) {
            // 不知道是不是调接口太早，iOS会响应不过来，只好加个延时……
            window.setTimeout(function () {
                var callback = params.callback;
                if (typeof(callback) == 'function') {
                    // 执行完一次不回收
                    callback = CB.callback2string(callback, true);
                }
                var json = {
                    "interface": "setShareInfo",
                    "callback": callback || "",
                    "data": {
                        "imgurl": params.imgurl,
                        "title": params.title,
                        "content": params.content,
                        "pageurl": params.pageurl
                    }
                };
                _prompt(json);
            }, 100);
        }
    };


    /**
     * 获取设备信息
     * @returns 返回对象包括三个字段：mac、deviceId和key，分别表示手机网卡MAC地址、IMEI和加密后的设备信息
     */
    H5.appPlus.deviceInfo = function (callback) {
        var json = {
            "interface": "device_info",
            "callback": CB.parseCallbackRes(callback)
        };
        // 此接口安卓端需强制同步转异步
        _prompt(json, true);
    };

    /**
     * 接口说明：获取客户端网络状态
     * @return 返回对象包括三个字段，ret，msg和networkstate；分别表示状态码，返回的信息，网络状态
     * @networkstate 值的含义：
     * 0：无网络；
     * 1：2G网；
     * 2：3G网
     * 3：4G网
     * 4：WIFI
     * */
    H5.appPlus.getAppNetWorkState = function (callback) {
        var json = {
            "interface": "getAppNetWorkState",
            "callback": function (getAppNetWorkState) {
                if (getAppNetWorkState && typeof(getAppNetWorkState) == 'string') {
                    getAppNetWorkState = JSON.parse(getAppNetWorkState);
                }
                callback(getAppNetWorkState);
            }
        };
        // 此接口安卓端需强制同步转异步
        _prompt(json, true);
    };

    /**
     * 退出WebView
     */
    H5.appPlus.webFinish = function () {
        var json = {
            "interface": "web_finish"
        };
        _prompt(json);
    };

    /**
     * 米大师点券充值接口
     * @param dq 点券数量
     * @param canChange 是否允许修改
     * @param callback 回调函数（参数说明：0=失败 1=成功 2=取消）
     */
    H5.appPlus.goMidasDq = function (dq, canChange, callback) {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.4)) {
            var json = {
                "interface": "goMidasDq",
                "callback": callback,
                "data": {
                    dq: dq,
                    canChange: canChange
                }
            };
            _prompt(json);
        }
    };

    /**
     * 米大师VIP开通接口
     * @param month 开通月数（1、3、6、12）
     * @param aid 充值标记，可在 http://data.ac.oa.com/VipSource/VipSource?nav=pay 进行配置
     * @param callback 回调函数（参数说明：0=失败 1=成功 2=取消 3=登录过期）
     */
    H5.appPlus.goMidasVIP = function (month, aid, callback) {
        if (_parent.isIOS ||
            (_parent.isAndroid && _parent.appVer >= 5.4)) {
            var productId = {
                1: 'MHVIPD1',
                3: 'MHVIPB3',
                6: 'MHVIPC6',
                12: 'MHVIPA12'
            }[month];
            if (!productId) {
                throw new Error('开通月份数有误，不能为 ' + month);
            }
            var json = {
                "interface": "goMidasVIP",
                "callback": callback,
                "data": {
                    productId: productId,
                    aid: aid
                }
            };
            _prompt(json);
        }
    };

})(_parent);
;

/**
 * Created by Grayson Rex on 2015/5/26.
 * - Modify: 2015/09/09
 */
(function (_parent) {
    window.LoginLite = _parent.LoginLite = _parent.loginLite = {};

    // 写cookie
    LoginLite.setCookie = ek.cookie.setCookie;

    // 移除cookie
    LoginLite.removeCookie = ek.cookie.removeCookie;

    // 读取cookie
    LoginLite.getCookie = ek.cookie.getCookie;

    LoginLite.login = function (backUrl, useSid) {
        var wlh = backUrl || window.location;
        window.location.href = 'http://ui.ptlogin2.qq.com/cgi-bin/login?style=9&low_login=1&appid=637009801&daid=43&pt_no_onekey=1&s_url=' +
            encodeURIComponent(wlh) + (useSid ? '&pt_ttype=1' : '');
    };

    LoginLite.isLogin = function () {
        //console.log('开始取登录凭据');
        var uin = LoginLite.getCookie('uin');
        uin = String(Number(uin.replace(/^[^0-9]/, '')));
        var skey = LoginLite.getCookie('skey');
        var lskey = LoginLite.getCookie('lskey');
        var sid = LoginLite.getCookie('sid_lite');
        if (!uin || uin == '0') {
            return null;
        } else {
            //console.log('取到登录凭据');
            return {
                uin: uin,
                skey: skey,
                lskey: lskey,
                sid: sid
            };
        }
    };

    LoginLite.isLogin_async = function (callback) {
        window.setTimeout(function () {
            var user = LoginLite.isLogin();
            callback(user);
        }, 0);
    };

    LoginLite.logout = function (backUrl) {
        var wlh = backUrl || 'http://' + window.location.host;
        pt_logout.logout(function () {
            LoginLite.removeCookie('luin', '.qq.com', '/');
            LoginLite.removeCookie('lskey', '.qq.com', '/');
        });
        pt_logout.clearCookie();
        if (backUrl !== false) {
            setTimeout(function () {
                window.location.href = wlh;
            }, 200);
        }
    };


    function getQueryString(key) {
        if (!getQueryString.data) {
            var data = {};
            var wl = window.location;
            var qss = (wl.href.split('?')[1] || '').split('&');
            for (var i = 0, qs; qs = qss[i]; i++) {
                var kv = qs.split('=');
                data[kv[0]] = decodeURIComponent(kv[1]);
            }
            getQueryString.data = data;
        }
        return getQueryString.data[key];
    }

    var sid = getQueryString('sid');
    if (sid) {
        LoginLite.setCookie('sid_lite', sid);

        var qss = [];
        for (var key in getQueryString.data) {
            if (key == 'sid') {
                continue;
            }
            qss.push(key + '=' + encodeURI(getQueryString.data[key]));
        }
        var newLocation = window.location.href.split('?')[0] + '?' + qss.join('&');
        if (window.history.replaceState) {
            window.history.replaceState(null, '', newLocation);
        } else {
            window.location.href = newLocation;
        }
    }
})(_parent);;

/* 从当前元素到祖先节点中找到第一个符合Selector的元素 ST */
(function (_parent) {

    var _this = _parent.DomHelper = _parent.dom = {};

    /**
     * 判断某个元素是否符合某个选择器
     * @param el 目标元素
     * @param selector 选择器
     * @returns {*} 是否符合
     */
    function isThis(el, selector) {
        var _matches = (el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector);

        if (_matches) {
            return _matches.call(el, selector);
        } else if (el.parentNode) {
            var nodes = el.parentNode.querySelectorAll(selector);
            for (var i = nodes.length; i--;)
                if (nodes[i] === el) {
                    return true;
                }
            return false;
        }
        return false;
    }

    _this.isThis = isThis;

    /**
     * 向上寻找符合selector的元素
     * @param el 目标元素
     * @param selector 选择器
     * @param excludeThis 是否包括自己
     * @returns 符合选择器的元素
     */
    function refluxToFind(el, selector, excludeThis) {
        if (!excludeThis && isThis(el, selector)) {
            return el;
        } else if (el.parentNode) {
            return refluxToFind(el.parentNode, selector);
        } else {
            return null;
        }
    }

    _this.refluxToFind = refluxToFind;
})(_parent);
/* 从当前元素到祖先节点中找到第一个包含className的元素 ED */;

/**
 * Created by krimeshu on 2016/1/18.
 */
(function (_parent) {

    var _this = _parent.PayHelper = _parent.pay = {};

    /**
     * 充值VIP
     * @param retUrl 充值返回的页面
     * @param aid 渠道标记，可在 http://data.ac.oa.com/VipSource/VipSource?nav=pay 进行配置
     */
    _this.buyVip = function (retUrl, aid) {
        retUrl = encodeURIComponent(retUrl);
        var url = "http://pay.qq.com/h5/index.shtml?m=buy&c=mhvip&pf=2208&ru=" + retUrl;
        if (aid) {
            url = url + "&aid=" + aid;
        }
        window.location.href = url;
    };

    /**
     * 充值点券
     * @param retUrl 充值返回的页面
     */
    _this.buyGoods = function (retUrl, als) {
        retUrl = retUrl || window.location.href;
        als = als || [];
        mcash.pay({
            appid: 1450000105,
            session_type: 'sid',
            redirecturl: retUrl,
            pf: 'huyu_m-20120321-android-h5',
            al: als.join(',')
        });
    };

})(_parent);;

})();
;
/**
 * BIU (Ver 1.1.4)
 *
 * Created by krimeshu on 2015/11/9.
 * Last modified on 2016/5/21.
 */
(function () {

    var __makeExtend = function (Parent) {
        return function (extProto) {
            var ChildClass = function () {
                var args = Array.prototype.splice.apply(arguments, [0]);
                Parent && Parent.apply(this, args);
                extProto.__construct && extProto.__construct.apply(this, args);
            };
            var childProto = Parent ? new Parent({
                name: '__for__proto__'
            }) : {};
            for (var prop in extProto) {
                if (!extProto.hasOwnProperty(prop)) {
                    continue;
                }
                if (!/^__/.test(extProto)) {
                    childProto[prop] = extProto[prop];
                }
            }
            ChildClass.prototype = childProto;
            ChildClass.extend = __makeExtend(ChildClass);
            return ChildClass;
        };
    }, baseExtend = __makeExtend();

    /**
     * BIU (Basic Inheritable Unit) 基本可继承单元
     * 提供基本的绑定事件监听器方法 on、触发事件监听器方法 trigger、继承扩展方法 extend
     * @constructor
     */
    var BIU = baseExtend({
        '__construct': function (opt) {
            opt = opt || {};

            this.__allListeners = [];
            this.__typeListenerMap = {};
            this.__unitListenerMap = {};
            this.__typeUniListenerMap = {};

            for (var prop in opt) {
                if (!opt.hasOwnProperty(prop)) {
                    continue;
                }
                this[prop] = opt[prop];
            }

            if (this.name === '__for__proto__') {
                return;
            }

            var initChain = this.__getPropChain('init');            // 获取继承链中所有的init
            for (var i = 0, init, len = initChain.length; i < len; i++) {
                init = initChain[i];
                init && init.apply(this);
            }
        },
        'on': function (typeArg, func) {
            var typeName,
                unitName;
            typeArg = typeArg.split(':');
            typeName = typeArg[0] || '*';
            unitName = typeArg[1] || '*';
            typeArg = typeName + ':' + unitName;

            var listener = {
                __this: this,
                __func: func
            }, listeners;
            listeners = this.__allListeners;
            listeners.push(listener);
            if (typeName !== '*') {
                listeners = this.__typeListenerMap[typeName] || (this.__typeListenerMap[typeName] = []);
                listeners.push(listener);
            }
            if (unitName !== '*') {
                listeners = this.__unitListenerMap[unitName] || (this.__unitListenerMap[unitName] = []);
                listeners.push(listener);
            }
            listeners = this.__typeUniListenerMap[typeArg] || (this.__typeUniListenerMap[typeArg] = []);
            listeners.push(listener);
            return true;
        },
        'trigger': function (typeArg, e) {
            var typeName,
                unitName;
            typeArg = typeArg.split(':');
            typeName = typeArg[0] || '*';
            unitName = typeArg[1] || '*';
            typeArg = typeName + ':' + unitName;

            e = e || {};
            e.path = e.path || [];
            if (typeof(e) !== 'object') {
                throw new Error('BIU.trigger 函数的第二个参数 e 为 Object 型的事件对象，请检查是否有误。');
            }
            e.typeName = typeName;
            e.unitName = unitName;
            var listeners = this.__typeUniListenerMap['*:*'] || [];
            if (typeArg === '*:*') {
                listeners = this.__allListeners;
            } else if (unitName === '*') {
                listeners = listeners.concat(this.__typeListenerMap[typeName] || []);
            } else if (typeName === '*') {
                listeners = listeners.concat(this.__unitListenerMap[unitName] || []);
            } else {
                listeners = listeners.concat(this.__typeUniListenerMap[typeArg] || []);
            }
            var args = [].slice.call(arguments, 1),
                i, len = listeners.length,
                listener;
            args[0] = e;
            for (i = 0; i < len; i++) {
                listener = listeners[i];
                listener.__unCalled = true;
            }
            for (i = 0; i < len; i++) {
                listener = listeners[i];
                var __this = listener.__this,
                    __func = listener.__func;
                if (!listener.__unCalled) {
                    continue;
                }
                delete listener.__unCalled;
                e.path.push(__this);
                if (typeof(__func) === 'string') {
                    __func = this[__func] || window[__func];
                }
                if (__func.apply(__this, args) === false) {
                    return false;
                }
            }
            return true;
        },
        "__getPropChain": function (prop) {
            var __values = [],
                __context = this;
            while (__context) {
                if (__context.hasOwnProperty(prop) && __context[prop]) {
                    __values.push(__context[prop]);
                } else {
                    __values.push(undefined);
                }
                __context = __context.__proto__ || Object.getPrototypeOf(__context);
            }
            __values.reverse();
            return __values;
        }
    });

    // ------------------------------------------------------

    BIU.Page = BIU.extend({
        '__construct': function (opt) {
            opt = opt || {};

            this.__isReady = false;
            this.__views = [];
            this.__models = [];
            this.__children = [];

            this.name = opt['name'] || null;
            if (!this.name) {
                throw new Error('创建 BIU.Page 对象时缺少 name 参数。');
            }

            if (this.name === '__for__proto__') {
                return;
            }

            this.addView(opt['views'] || []);
            this.addModel(opt['models'] || []);
            this.addChild(opt['children'] || []);
            this.on('*', function (e) {
                e = e || {};
                var typeArg = e.typeName + ':' + e.unitName;
                var args = [].slice.call(arguments, 0),
                    list = this.__models.concat(this.__views, this.__children),
                    i, len = list.length, item;
                args.splice(0, 0, typeArg);
                for (i = 0; i < len; i++) {
                    item = list[i];
                    item.trigger.apply(item, args);
                }
            });
        },
        'addModel': function (models) {
            this.__addList(this.__models, models);
        },
        'addView': function (views) {
            this.__addList(this.__views, views);
        },
        'addChild': function (children) {
            this.__addList(this.__children, children);
        },
        'add': function (list) {
            var models = [],
                views = [],
                children = [],
                item, _set;
            if (!Array.isArray(list)) {
                list = [list];
            }
            for (var i = 0, len = list.length; i < len; i++) {
                item = list[i];
                _set = null;
                if (BIU.Model.__instances[item.name] || BIU.Model.__instances[item]) {
                    _set = models;
                } else if (BIU.View.__instances[item.name] || BIU.View.__instances[item]) {
                    _set = views;
                } else {
                    _set = children;
                }
                _set && _set.push(item);
            }
            this.__addList(this.__models, models);
            this.__addList(this.__views, views);
            this.__addList(this.__children, children);
        },
        '__addList': function (__set, list) {
            var item;
            if (!Array.isArray(list)) {
                list = [list];
            }
            for (var i = 0, len = list.length; i < len; i++) {
                item = list[i];
                if (typeof (item) === 'string') {
                    item = BIU.Model.__instances[item] || BIU.View.__instances[item];
                    if (!item) {
                        throw new Error('没有找到名为 ' + item + ' 的 BIU 对象。');
                    }
                }
                __set.push(item);
                item.page = this;
            }
        },
        'findModel': function (name) {
            return this.find(name, 'model');
        },
        'findView': function (name) {
            return this.find(name, 'view');
        },
        'findChild': function (name) {
            return this.find(name, 'child');
        },
        'find': function (name, type) {
            var list = this.__models.concat(this.__views, this.__children),
                item;
            switch (type) {
                case 'model':
                    list = this.__models;
                    break;
                case 'view':
                    list = this.__views;
                    break;
                case 'child':
                    list = this.__children;
                    break;
            }
            for (var i = 0, len = list.length; i < len; i++) {
                item = list[i];
                if (item.name === name) {
                    return item;
                }
            }
            return null;
        },
        'load': function (name) {
            var data = this.find(name, 'model'),
                args = Array.prototype.splice.apply(arguments, [1]);
            if (data && typeof(data.load) === 'function') {
                return data.load.apply(data, args);
            }
            return null;
        },
        'set': function (name) {
            var child = this.find(name, 'model'),
                args = Array.prototype.splice.apply(arguments, [1]);
            if (child && typeof(child.set) === 'function') {
                return child.set.apply(child, args);
            }
            return null;
        },
        'get': function (name) {
            var child = this.find(name, 'model');
            if (child && child.get !== undefined) {
                return typeof (child.get) === 'function' ?
                    child.get() : child.get;
            }
            return null;
        },
        'pageReady': function (e) {
            if (this.__isReady) {
                throw new Error('不要多次触发 BIU.Page(' + this.name + ') 的 pageReady 事件。');
            }
            e = e || {};
            var type = 'pageReady';
            this.trigger(type, e);
            this.__isReady = true;
        }
    });

    // ------------------------------------------------------

    BIU.Model = BIU.extend({
        '__construct': function (opt) {
            opt = opt || {};

            this.__listen = {};

            this.name = opt['name'] || null;
            if (!this.name) {
                throw new Error('创建 BIU.Model 对象时缺少 name 参数。');
            }
            this.load = opt['load'] || this.load || this.__load;
            this.set = opt['set'] || this.set || this.__set;
            this.get = opt['get'] || this.get || this.__get;

            if (this.name === '__for__proto__') {
                return;
            }

            if (BIU.Model.__instances[this.name]) {
                throw new Error('名为 ' + this.name + ' 的 BIU.Model 对象已存在。');
            }
            BIU.Model.__instances[this.name] = this;

            var listenChain = this.__getPropChain('listen');            // 获取继承链中所有的listen
            for (var i = 0, listen, len = listenChain.length; i < len; i++) {
                listen = listenChain[i];
                listen && this.bindListeners(listen);
            }

            var pageReadyChain = this.__getPropChain('pageReady');      // 获取继承链中所有的pageReady
            for (var i = 0, pageReady, len = pageReadyChain.length; i < len; i++) {
                pageReady = pageReadyChain[i];
                pageReady && this.on('pageReady', pageReady);
            }
        },
        'bindListeners': function (listen) {
            for (var name in listen) {
                if (!listen.hasOwnProperty(name)) {
                    continue;
                }
                var func = listen[name];
                this.__bindListener(name, func);
            }
        },
        '__bindListener': function (name, func) {
            var _this = this;
            if (typeof(func) === 'string') {
                func = _this[func] || window[func];
            }
            this.on('change:' + name, function (e) {
                func.apply(_this, [e && e.value]);
            });
            this.__listen[name] = func;
        },
        // 自身数据处理函数
        '__data': null,
        '__load': function () {
            this.__data = null;
        },
        '__get': function () {
            return this.__data;
        },
        '__set': function (value) {
            var args = Array.prototype.splice.apply(arguments, [0]),
                argLen = args.length;
            if (argLen > 1) {
                var data = this.__data,
                    key;
                while (args.length > 2) {
                    key = args.splice(0, 1);
                    data = data[key] || (data[key] = {});
                }
                key = args[0];
                value = args[1];
                data[key] = value;
            } else {
                this.__data = value;
            }
            this.change();
        },
        'change': function () {
            var page = this.page;
            page && page.trigger('change:' + this.name, {value: this.get()});
        }
    });
    BIU.Model.__instances = {};

    // ------------------------------------------------------

    BIU.View = BIU.extend({
        '__construct': function (opt) {
            opt = opt || {};

            this.__listen = {};
            this.__events = {};

            this.name = opt['name'] || null;
            if (!this.name) {
                throw new Error('创建 BIU.View 对象时缺少 name 参数。');
            }

            if (this.name === '__for__proto__') {
                return;
            }

            if (BIU.View.__instances[this.name]) {
                throw new Error('名为 ' + this.name + ' 的 BIU.View 对象已存在。');
            }
            BIU.View.__instances[this.name] = this;

            var eventsChain = this.__getPropChain('events');            // 获取继承链中所有的events
            for (var i = 0, events, len = eventsChain.length; i < len; i++) {
                events = eventsChain[i];
                events && this.bindEvents(events);
            }

            var listenChain = this.__getPropChain('listen');            // 获取继承链中所有的listen
            for (var i = 0, listen, len = listenChain.length; i < len; i++) {
                listen = listenChain[i];
                listen && this.bindListeners(listen);
            }

            var pageReadyChain = this.__getPropChain('pageReady');      // 获取继承链中所有的pageReady
            for (var i = 0, pageReady, len = pageReadyChain.length; i < len; i++) {
                pageReady = pageReadyChain[i];
                pageReady && this.on('pageReady', pageReady);
            }
        },
        // DOM事件监听器
        'bindEvents': function (events) {
            for (var key in events) {
                if (!events.hasOwnProperty(key)) {
                    continue;
                }
                var listener = events[key] || null;
                this.bindEvent(key, listener);
            }
        },
        'bindEvent': function (key, listener) {
            var t = key.split(' '),
                type = t.splice(0, 1),
                sl = t.join(' ');
            var elem = this.__id(sl) || this.__sl(sl);
            if (!elem || elem.length === 0) {
                throw new Error('找不到 BIU.View(' + this.name + ') 中的元素：' + sl + '。');
            }
            this.__bindEvent(elem, type, listener);
            this.__events[key] = listener;
        },
        '__bindEvent': function (elem, type, listener) {
            if (!elem.length) {
                elem = [elem];
            }
            if (typeof(listener) === 'string') {
                listener = this[listener] || window[listener];
            }
            for (var i = 0, len = elem.length; i < len; i++) {
                var _elem = elem[i];
                _elem && _elem.addEventListener && _elem.addEventListener(type, listener.bind(this), false);
            }
        },
        // BIU事件监听器
        'bindListeners': function (listen) {
            for (var name in listen) {
                if (!listen.hasOwnProperty(name)) {
                    continue;
                }
                var func = listen[name];
                this.__bindListener(name, func);
            }
        },
        '__bindListener': function (name, func) {
            var _this = this;
            if (typeof(func) === 'string') {
                func = _this[func] || window[func];
            }
            this.on('change:' + name, function (e) {
                func.apply(_this, [e && e.value]);
            });
            this.__listen[name] = func;
        },
        '__id': function (id) {
            return document.getElementById(id);
        },
        '__sl': function (sl) {
            return document.querySelectorAll && document.querySelectorAll(sl);
        }
    });
    BIU.View.__instances = {};

    // ------------------------------------------------------

    window.BIU = BIU;
})();
;
/**
 * Pile Dialog
 *
 * Ver 0.5.6
 * Date 2016/4/21
 *
 * Created by krimeshu on 2016/1/13.
 */
(function () {
    var templateText = '<div class=\"dialog-cover\"></div>\r\n<div class=\"dialog-box\">\r\n    <p class=\"dialog-title\"></p>\r\n    <a class=\"dialog-close-btn\"></a>\r\n\r\n    <div class=\"dialog-content\"></div>\r\n</div>\r\n',
        styleText = '\n.pile-dialog-wrap.default .dialog-box {\n  border-radius: 4px;\n  background-color: #FFFFFF;\n  -webkit-box-shadow: 0 0 7.5px rgba(0, 0, 0, 0.3);\n          box-shadow: 0 0 7.5px rgba(0, 0, 0, 0.3);\n  margin: 0px 8px;\n  min-width: 40%; }\n  .pile-dialog-wrap.default .dialog-box .dialog-title {\n    height: 55px;\n    line-height: 55px;\n    margin: 0;\n    padding-left: 21px;\n    padding-right: 21px;\n    border-radius: 4px 4px 0px 0px;\n    position: relative;\n    background-color: #FFFFFF;\n    color: #333333;\n    font-size: 15px; }\n    .pile-dialog-wrap.default .dialog-box .dialog-title::after {\n      content: \"\";\n      display: block;\n      position: absolute;\n      -webkit-transform-origin: center bottom;\n      transform-origin: center bottom;\n      width: 100%;\n      bottom: 0;\n      width: 200%;\n      left: -50%;\n      -webkit-transform: scale(0.5);\n      transform: scale(0.5);\n      border-bottom: 1px solid #DADADA; }\n  .pile-dialog-wrap.default .dialog-box .dialog-close-btn {\n    width: 28px;\n    height: 28px;\n    padding: 12.5px 13.5px 14.5px 13.5px; }\n    .pile-dialog-wrap.default .dialog-box .dialog-close-btn::after {\n      content: \"\";\n      display: block;\n      width: 28px;\n      height: 28px;\n      background: transparent url(\"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAACohjseAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2lpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozQzVBN0I0MTBEQjVFNTExOTg4N0JDNjUxNDI5NkNDQiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpEMEExQUI0QkI5QkIxMUU1ODEyN0MyOUFFOEE2MkIzMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpEMEExQUI0QUI5QkIxMUU1ODEyN0MyOUFFOEE2MkIzMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDRiNGU5M2ItODQ0OS1kMTQ2LWFhN2EtNDhlZGI5ZDllOWZjIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjNDNUE3QjQxMERCNUU1MTE5ODg3QkM2NTE0Mjk2Q0NCIi8+IDwvcmRmOkRlc2Ny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\") no-repeat scroll 0 0;\n      background-size: 28px 28px; }\n  .pile-dialog-wrap.default .dialog-box .dialog-content {\n    padding-bottom: 25px;\n    border-radius: 4px 4px 0px 0px;\n    background-color: #FFFFFF;\n    color: #333333;\n    font-size: 14px; }\n    .pile-dialog-wrap.default .dialog-box .dialog-content .weak {\n      color: #868686; }\n    .pile-dialog-wrap.default .dialog-box .dialog-content .small {\n      font-size: 12px; }\n    .pile-dialog-wrap.default .dialog-box .dialog-content .del {\n      text-decoration: line-through; }\n    .pile-dialog-wrap.default .dialog-box .dialog-content .em {\n      font-style: normal;\n      text-shadow: 0 0 4px #FCF988; }\n    .pile-dialog-wrap.default .dialog-box .dialog-content .link {\n      display: inline-block;\n      padding: 2px 0px;\n      color: #E65D52;\n      border-bottom: 1px solid #E65D52; }\n  .pile-dialog-wrap.default .dialog-box .dialog-para {\n    margin: 25px 21px 0px 21px;\n    padding: 0; }\n  .pile-dialog-wrap.default .dialog-box .dialog-btn {\n    margin: 25px 21px 0px 21px;\n    padding: 0px 10px;\n    height: 40px;\n    line-height: 40px;\n    border-radius: 3px;\n    border: 2px solid #767676;\n    background-color: #FDF986;\n    color: #545253;\n    font-size: 15px;\n    text-align: center; }\n    .pile-dialog-wrap.default .dialog-box .dialog-btn:active {\n      background-color: #827e02; }\n    .pile-dialog-wrap.default .dialog-box .dialog-btn[disabled] {\n      background-color: #C5C5C5; }\n\n.pile-dialog-wrap.flat {\n  top: auto;\n  bottom: 0;\n  -webkit-box-align: end;\n  -webkit-align-items: flex-end;\n      -ms-flex-align: end;\n              -ms-grid-row-align: flex-end;\n          align-items: flex-end; }\n  .pile-dialog-wrap.flat .dialog-box {\n    background-color: #FFFFFF;\n    width: 100%; }\n    .pile-dialog-wrap.flat .dialog-box .dialog-title {\n      height: 50px;\n      line-height: 50px;\n      color: #333333;\n      text-align: center;\n      font-size: 16px; }\n    .pile-dialog-wrap.flat .dialog-box .dialog-close-btn {\n      display: none; }\n    .pile-dialog-wrap.flat .dialog-box .dialog-content {\n      color: #535252;\n      font-size: 14px; }\n      .pile-dialog-wrap.flat .dialog-box .dialog-content .weak {\n        color: #969696; }\n      .pile-dialog-wrap.flat .dialog-box .dialog-content .small {\n        font-size: 12px; }\n      .pile-dialog-wrap.flat .dialog-box .dialog-content .del {\n        text-decoration: line-through; }\n      .pile-dialog-wrap.flat .dialog-box .dialog-content .em {\n        font-style: normal;\n        text-shadow: 0 0 4px #E86A3E; }\n    .pile-dialog-wrap.flat .dialog-box .dialog-para {\n      margin: 25px 35px 0px 35px;\n      padding: 0; }\n    .pile-dialog-wrap.flat .dialog-box .dialog-btn {\n      margin: 25px 0px 0px 0px;\n      padding: 0;\n      height: 60px;\n      line-height: 60px;\n      position: relative;\n      background-color: #F5F5EE;\n      color: #535252;\n      font-size: 16px;\n      text-align: center; }\n      .pile-dialog-wrap.flat .dialog-box .dialog-btn::before {\n        content: \"\";\n        display: block;\n        position: absolute;\n        -webkit-transform-origin: center top;\n        transform-origin: center top;\n        width: 100%;\n        top: 0;\n        width: 200%;\n        left: -50%;\n        -webkit-transform: scale(0.5);\n        transform: scale(0.5);\n        border-top: 1px solid #C5C5C5; }\n\n.pile-dialog-wrap.toast {\n  top: auto;\n  bottom: 75px;\n  height: auto; }\n  .pile-dialog-wrap.toast .dialog-box {\n    display: inline-block;\n    background-color: rgba(40, 40, 40, 0.95);\n    border-radius: 50px;\n    margin: 0 auto; }\n    .pile-dialog-wrap.toast .dialog-box .dialog-title {\n      height: 50px;\n      line-height: 50px;\n      color: #333333;\n      text-align: center;\n      font-size: 16px; }\n    .pile-dialog-wrap.toast .dialog-box .dialog-close-btn {\n      display: none; }\n    .pile-dialog-wrap.toast .dialog-box .dialog-content {\n      color: #C5C5C5;\n      font-size: 13px; }\n      .pile-dialog-wrap.toast .dialog-box .dialog-content .weak {\n        color: #969696; }\n      .pile-dialog-wrap.toast .dialog-box .dialog-content .small {\n        font-size: 12px; }\n      .pile-dialog-wrap.toast .dialog-box .dialog-content .del {\n        text-decoration: line-through; }\n      .pile-dialog-wrap.toast .dialog-box .dialog-content .em {\n        font-style: normal;\n        text-shadow: 0 0 4px #E86A3E; }\n    .pile-dialog-wrap.toast .dialog-box .dialog-para {\n      height: 50px;\n      line-height: 50px;\n      padding: 0px 35px; }\n\n.pile-dialog-wrap {\n  display: none;\n  -webkit-box-align: center;\n  -webkit-align-items: center;\n      -ms-flex-align: center;\n              -ms-grid-row-align: center;\n          align-items: center;\n  -webkit-box-pack: center;\n  -webkit-justify-content: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 1000000;\n  width: 100%;\n  height: 100%;\n  text-align: center;\n  pointer-events: none; }\n  .pile-dialog-wrap.open {\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex; }\n  .pile-dialog-wrap .dialog-box, .pile-dialog-wrap .dialog-cover {\n    pointer-events: auto; }\n\n.dialog-cover {\n  position: fixed;\n  z-index: 1000001;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n  -webkit-transition: opacity 300ms ease;\n  transition: opacity 300ms ease;\n  opacity: 0; }\n  .dialog-cover.show {\n    opacity: .25; }\n\n.dialog-box {\n  position: relative;\n  z-index: 1000002;\n  overflow: hidden;\n  -webkit-transition: opacity 300ms ease, -webkit-transform 300ms ease;\n  transition: opacity 300ms ease, -webkit-transform 300ms ease;\n  transition: transform 300ms ease, opacity 300ms ease;\n  transition: transform 300ms ease, opacity 300ms ease, -webkit-transform 300ms ease;\n  -webkit-transform: translate3d(0, 100%, 0);\n          transform: translate3d(0, 100%, 0);\n  opacity: 0;\n  text-align: left; }\n  .dialog-box.show {\n    -webkit-transform: translate3d(0, 0, 0);\n            transform: translate3d(0, 0, 0);\n    opacity: 1; }\n  .dialog-box .dialog-title {\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n    overflow: hidden; }\n  .dialog-box .dialog-close-btn {\n    display: block;\n    position: absolute;\n    top: 0;\n    right: 0;\n    -webkit-transform: translate3d(0, 0, 0);\n            transform: translate3d(0, 0, 0);\n    cursor: pointer; }\n  .dialog-box .dialog-content {\n    position: relative;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dialog-box .dialog-para {\n    display: block;\n    line-height: 1.4; }\n  .dialog-box .dialog-btn {\n    display: block;\n    text-align: center;\n    cursor: pointer; }\n  .dialog-box .dialog-row {\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: -ms-flexbox;\n    display: flex; }\n\n';

    /****************************************/

    var TRANSITION_TIME = 300;

var style = document.createElement('STYLE');
style.innerHTML = styleText;
document.body.appendChild(style);

var utils = {
    NODE_TYPES: {
        ELEMENT_NODE: 1,
        ATTRIBUTE_NODE: 2,
        TEXT_NODE: 3,
        CDATA_SECTION_NODE: 4,
        ENTITY_REFERENCE_NODE: 5,
        ENTITY_NODE: 6,
        PROCESSING_INSTRUCTION_NODE: 7,
        COMMENT_NODE: 8,
        DOCUMENT_NODE: 9,
        DOCUMENT_TYPE_NODE: 10,
        DOCUMENT_FRAGMENT_NODE: 11,
        NOTATION_NODE: 12
    },
    extend: function (extPrototype, basePrototype) {
        var undefined = void(0),
            basePrototypes = Array.prototype.slice.call(arguments, 1);
        while (basePrototype = basePrototypes.shift()) {
            for (var p in basePrototype) {
                if (basePrototype.hasOwnProperty(p) && extPrototype[p] === undefined) {
                    extPrototype[p] = basePrototype[p];
                }
            }
        }
        return extPrototype;
    },
    isArray: function (tar) {
        return Object.prototype.toString.call(tar) === '[object Array]'
    },
    getChildElem: function (dom, index) {
        var childNodes = dom.childNodes,
            TYPES = this.NODE_TYPES,
            _pos = 0, _index = 0, node;
        while (node = childNodes[_pos++]) {
            if (node.nodeType === TYPES.ELEMENT_NODE) {
                if (index !== _index) {
                    _index++;
                    continue;
                }
                break;
            }
        }
        return node;
    },
    getPrevElem: function (dom) {
        do {
            dom = dom.previousSibling;
        }
        while (dom && dom.nodeType !== 1);
        return dom;
    },
    getNextElem: function (dom) {
        do {
            dom = dom.nextSibling;
        }
        while (dom && dom.nodeType !== 1);
        return dom;
    }
};
;

var PileDialog = function (opt) {
    var self = this;
    if (!self instanceof PileDialog) {
        return new PileDialog(opt);
    }

    var prop = opt.prop || {
                skin: 'default',
                cover: true,
                closeBtn: true,
                lock: false
            },
        title = opt.title || '',
        content = opt.content || '',
        onOpen = opt['onOpen'],
        onClose = opt['onClose'];

    self.children = [];

    self.prop = {};
    self.doms = {};
    self.callbacks = {};

    var wrap = self.doms.wrap = document.createElement('DIV');
    wrap.className = 'pile-dialog-wrap';
    wrap.innerHTML = templateText;

    self.doms.cover = wrap.getElementsByClassName('dialog-cover')[0];
    self.doms.box = wrap.getElementsByClassName('dialog-box')[0];
    self.doms.title = wrap.getElementsByClassName('dialog-title')[0];
    self.doms.closeBtn = wrap.getElementsByClassName('dialog-close-btn')[0];
    self.doms.content = wrap.getElementsByClassName('dialog-content')[0];

    self.doms.wrap.addEventListener('touchmove', function (e) {
        e.preventDefault();
    });
    self.doms.cover.addEventListener('click', function () {
        if (!self.isLocked) {
            self.close();
        }
    });
    self.doms.closeBtn.addEventListener('click', function () {
        self.close();
    });

    // 内容部分的DOM作为默认DOM
    self.dom = self.doms.content;

    document.body.appendChild(wrap);

    self.setProp('skin', String(prop.skin || 'default'));
    self.setProp('cover', !!prop.cover);
    self.setProp('closeBtn', !!prop.closeBtn);
    self.setProp('lock', !!prop.lock);

    self.setTitle(title);
    self.setContent(content);

    onOpen && self.on('open', onOpen);
    onClose && self.on('close', onClose);
};


/****************************************/

PileDialog.topZIndex = 1000000;
var TYPES = PileDialog.TYPES = {
    DIALOG: 'DIALOG',
    PARA: 'PARAGRAPH',
    BUTTON: 'BUTTON',
    CHILD: 'CHILD',
    ROW: 'ROW',
    OTHER: 'OTHER'
};
var PROTOTYPES = PileDialog.PROTOTYPES = {
    ENTITY: {
        'dialogType': TYPES.CHILD,
        'setAttr': function (attr, value) {
            var self = this;
            self.dom.setAttribute(attr, value);
        },
        'removeAttr': function (attr) {
            var self = this;
            self.dom.removeAttribute(attr);
        },
        'setText': function (text) {
            var self = this;
            self.dom.innerHTML = text;
        },
        'setStyle': function (style) {
            var self = this,
                dom = self.dom;
            for (var name in style) {
                if (!style.hasOwnProperty(name)) {
                    continue;
                }
                dom.style[name] = style[name];
            }
        },
        'show': function () {
            var self = this;
            self.dom.style.display = 'block';
        },
        'hide': function () {
            var self = this;
            self.dom.style.display = 'none';
        }
    },
    CONTAINER: {
        'prepend': function (thing, _index) {
            var self = this,
                child = self._recognize(thing);
            self._prepend(child, _index);
        },
        'append': function (thing) {
            var self = this,
                child = self._recognize(thing);
            self._append(child);
        },
        '_recognize': function (thing) {
            var type = Object.prototype.toString.apply(thing),
                child = null;
            if (thing.dialogType) {
                // 追加 Dialog.Child 对象
                child = thing;
            } else if (type === '[object String]') {
                // 追加 字符串（自动转为 Dialog.Para 对象）
                child = new PileDialog.Para({
                    text: thing
                });
            } else if (type === '[object Object]' &&
                typeof thing.text === 'string' &&
                typeof thing.click === 'function') {
                // 追加 按键（自动转为 Dialog.Button 对象）
                child = new PileDialog.Button(thing);
            } else if (/\[object HTML.*?Element]/i.test(type)) {
                // 追加 DOM（自动转为 Dialog.Child 对象）
                child = new PileDialog.Child({
                    dom: thing
                });
            }
            if (!child) {
                // 无法识别，放弃
                return null;
            }
            return child;
        },
        '_prepend': function (child, _index) {
            var self = this,
                index = _index | 0,
                children = self.children
            // 添加前，先从原有 parent 和 Dialog 中移除
            if (child._parent) {
                child._parent.remove(child);
            }
            child._parent = self;
            children.splice(index, 0, child);
            var nextNode = utils.getChildElem(self.dom, index);
            if (nextNode) {
                self.dom.insertBefore(child.dom, nextNode);
            } else {
                self.dom.appendChild(child.dom);
            }
        },
        '_append': function (child) {
            var self = this,
                children = self.children;
            // 添加前，先从原有 parent 和 Dialog 中移除
            if (child._parent) {
                child._parent.remove(child);
            }
            child._parent = self;
            children.push(child);
            self.dom.appendChild(child.dom);
        },
        'find': function (thing) {
            var self = this,
                children = self.children,
                type = Object.prototype.toString.apply(thing),
                child = null;
            if (thing.dialogType && children.indexOf(thing) >= 0) {
                // 寻找的是 Dialog.Child 对象
                child = thing;
            } else if (type === '[object Number]') {
                // 寻找的是 Dialog.Child 对象序号
                if (thing < 0) {
                    thing = children.length + thing;
                }
                child = children[thing];
            } else if (type === '[object String]') {
                // 寻找的是 字符串（尝试识别为 Dialog.Para 对象）
                children.forEach(function (_child) {
                    var match = (_child.text === thing);
                    if (_child.dialogType === TYPES.PARA && match) {
                        child = _child;
                    }
                });
            } else if (type === '[object Object]' &&
                typeof thing.text === 'string' &&
                typeof thing.click === 'function') {
                // 寻找的是 按键（尝试识别为 Dialog.Button 对象）
                children.forEach(function (_child) {
                    var match = (_child.opt === thing || (_child.text === thing.text && _child.click === thing.click));
                    if (_child.dialogType === TYPES.BUTTON && match) {
                        child = _child;
                    }
                });
            } else if (/\[object HTML.*?Element]/i.test(type)) {
                // 寻找的是 DOM（尝试识别为 Dialog.Child 对象）
                children.forEach(function (_child) {
                    var match = (_child.dom === thing);
                    if (_child.dialogType === TYPES.CHILD && match) {
                        child = _child;
                    }
                });
            }
            return child;
        },
        'remove': function (thing) {
            var self = this,
                child = self.find(thing);
            if (!child) {
                // 无法识别，放弃
                return;
            }
            this._remove(child);
        },
        '_remove': function (child) {
            var self = this,
                children = self.children;
            delete child._parent;
            children.splice(children.indexOf(child), 1);
            self.dom.removeChild(child.dom);
        },
        'clear': function () {
            var self = this,
                children = self.children,
                len = children.length;
            for (var i = 0, child; (i < len) && (child = children[i]); i++) {
                delete child._parent;
            }
            self.children = [];
            self.dom.innerHTML = '';
        },
        'setContent': function (content) {
            var self = this,
                arr = content.length === undefined ? [content] : content;

            self.clear();
            for (var i = 0, len = arr.length; i < len; i++) {
                self.append(content[i]);
            }
        }
    },
    IN_CONTAINER: {
        'prev': function () {
            var self = this,
                parent = self && self._parent,
                children = parent && parent.children,
                pos = children && children.indexOf(self);
            return pos >= 0 && parent && parent.find && parent.find(pos - 1);
        },
        'next': function () {
            var self = this,
                parent = self && self._parent,
                children = parent && parent.children,
                pos = children && children.indexOf(self);
            return pos >= 0 && parent && parent.find && parent.find(pos + 1);
        },
        'parent': function () {
            var self = this;
            return self._parent;
        },
        'dialog': function () {
            var self = this;
            while (self && !(self instanceof PileDialog)) {
                self = self._parent;
            }
            return self;
        }
    }
};
;

PileDialog.prototype = utils.extend({
    dialogType: TYPES.DIALOG,
    'setTitle': function (title) {
        this.title = title;
        this.doms.title.innerHTML = title;
    },
    'showTitle': function () {
        this.doms.title.style.display = 'block';
    },
    'hideTitle': function () {
        this.doms.title.style.display = 'none';
    },
    'setProp': function (name, value) {
        var self = this,
            prop = self.prop;
        prop[name] = value;
        switch (name) {
            case 'skin':
                self.doms.wrap.className = 'pile-dialog-wrap ' + value;
                break;
            case 'cover':
                self.doms.cover.style.display = value ? 'block' : 'none';
                break;
            case 'closeBtn':
                self.doms.closeBtn.style.display = value ? 'block' : 'none';
                break;
            case 'lock':
                self.isLocked = value;
                break;
        }
    },
    'open': function (e) {
        var self = this;

        if (self.trigger('open', e) === false) {
            return;
        }
        self._waitingTimeout && window.clearTimeout(self._waitingTimeout);
        self._waitingTimeout = window.setTimeout(function () {
            self._waitingTimeout = null;
        }, TRANSITION_TIME);

        var z = PileDialog.topZIndex += 10;
        self.doms.wrap.style.zIndex = z;
        self.doms.cover.style.zIndex = z + 1;
        self.doms.box.style.zIndex = z + 2;

        self.doms.wrap.classList.add('open');
        self.doms.wrap.offsetWidth = self.doms.wrap.offsetWidth | 0;

        self.doms.cover.classList.add('show');
        self.doms.box.classList.add('show');
    },
    'close': function (e) {
        var self = this;

        if (self.trigger('close', e) === false) {
            return;
        }
        self._waitingTimeout && window.clearTimeout(self._waitingTimeout);
        self._waitingTimeout = window.setTimeout(function () {
            self.doms.wrap.classList.remove('open');
            self.doms.wrap.offsetWidth = self.doms.wrap.offsetWidth | 0;

            self._waitingTimeout = null;
        }, TRANSITION_TIME);

        self.doms.cover.classList.remove('show');
        self.doms.box.classList.remove('show');
    },
    'on': function (type, callback) {
        var self = this,
            typeCallbacks = self.callbacks[type];
        if (!utils.isArray(typeCallbacks)) {
            this.callbacks[type] = typeCallbacks = [];
        }
        typeCallbacks.push(callback);
    },
    'trigger': function (type) {
        var self = this,
            typeCallbacks = self.callbacks[type] || [],
            args = Array.prototype.splice.apply(arguments, [1]);
        for (var i = 0, callback; callback = typeCallbacks[i]; i++) {
            var res = callback.apply(this, args);
            if (res === false) {
                return res;
            }
        }
    }
}, PROTOTYPES.ENTITY, PROTOTYPES.CONTAINER);

PileDialog.Para = function (opt) {
    var self = this;
    if (!self instanceof PileDialog.Child) {
        return new PileDialog.Child(opt);
    }

    var text = opt.text || '',
        style = opt.style || {},
        className = opt.className || 'dialog-para';

    self.text = opt.text;

    self.dom = document.createElement('P');
    self.dom.className = className;
    self.dom.innerHTML = text;

    self.setStyle(style);
};


PileDialog.Para.prototype = utils.extend({
    dialogType: TYPES.PARA
}, PROTOTYPES.ENTITY, PROTOTYPES.IN_CONTAINER);
;
PileDialog.Button = function (opt) {
    var self = this;
    if (!self instanceof PileDialog.Child) {
        return new PileDialog.Child(opt);
    }

    var text = opt.text || '',
        style = opt.style || {},
        className = opt.className || 'dialog-btn';

    self.opt = opt;
    self.text = opt.text;
    self.click = opt.click;

    self.dom = document.createElement('A');
    self.dom.className = className;
    self.dom.innerHTML = text;
    self.dom.addEventListener('click', function (e) {
        if (!self.dom.hasAttribute('disabled')) {
            self.click(e);
        }
    });

    self.setStyle(style);
};

PileDialog.Button.prototype = utils.extend({
    dialogType: TYPES.BUTTON
}, PROTOTYPES.ENTITY, PROTOTYPES.IN_CONTAINER);
;
PileDialog.Child = function (opt) {
    var self = this;
    if (!self instanceof PileDialog.Child) {
        return new PileDialog.Child(opt);
    }

    self.dom = opt.dom;
};

PileDialog.Child.prototype = utils.extend({
    dialogType: TYPES.CHILD
}, PROTOTYPES.ENTITY, PROTOTYPES.IN_CONTAINER);
;
PileDialog.Row = function (opt) {
    var self = this;
    if (!self instanceof PileDialog.Row) {
        return new PileDialog.Row(opt);
    }

    self.children = [];

    var content = opt.content || '',
        style = opt.style || {},
        className = opt.className || 'dialog-row';

    self.opt = opt;

    self.dom = document.createElement('DIV');
    self.dom.className = className;

    content && self.setContent(content);

    self.setStyle(style);
};

PileDialog.Row.prototype = utils.extend({
    dialogType: TYPES.ROW
}, PROTOTYPES.ENTITY, PROTOTYPES.CONTAINER, PROTOTYPES.IN_CONTAINER);
;


var Promise = PileDialog.Promise = function () {
    this.callbacks = [];
};

Promise.prototype = {
    'construct': Promise,
    'resolve': function (result) {
        this.complete("resolve", result);
    },
    'reject': function (result) {
        this.complete("reject", result);
    },
    'complete': function (type, result) {
        while (this.callbacks[0]) {
            var callback = this.callbacks.shift()[type];
            typeof(callback) === 'function' && callback(result);
        }
    },
    'then': function (successHandler, failedHandler) {
        this.callbacks.push({
            resolve: successHandler,
            reject: failedHandler
        });
        return this;
    }
};
;

PileDialog.createDefaultDialogs = function () {
    PileDialog.toastDialog = new PileDialog({
        prop: {
            skin: 'toast',
            cover: false,
            closeBtn: false,
            lock: false
        },
        content: [
            ''
        ]
    });
    PileDialog.toastDialog.hideTitle();
    PileDialog.toast = function (msg, time, callback) {
        var dialog = PileDialog.toastDialog;
        dialog.find(0).setText(msg);
        dialog.open();
        if (dialog._closeTimeout) {
            window.clearTimeout(dialog._closeTimeout);
        }
        if (arguments.length === 2 && typeof time === 'function') {
            callback = time;
            time = undefined;
        }
        time = time === undefined ? 2500 : time;
        if (time) {
            dialog._closeTimeout = window.setTimeout(function () {
                dialog.close();
                dialog._closeTimeout = null;
                callback && callback();
            }, time);
        }
    };
    // ----------
    PileDialog.alertDialog = new PileDialog({
        prop: {
            skin: 'default',
            cover: true,
            closeBtn: true,
            lock: false
        },
        content: [
            {
                text: '确定',
                click: function () {
                    var dialog = this.dialog();
                    dialog._resolved = true;
                    dialog.close();
                }
            }
        ]
    });
    PileDialog.alertDialog.on('close', function (e) {
        var dialog = this,
            promise = dialog._promise,
            resolved = dialog._resolved;
        promise && (resolved ? promise.resolve(e) : promise.reject(e));
    });
    PileDialog.alert = function (contents, title) {
        var dialog = PileDialog.alertDialog,
            btnOk = dialog.find(-1),
            promise = new Promise();

        if (!utils.isArray(contents)) {
            contents = [contents];
        }
        dialog.remove(btnOk);
        dialog.clear();
        contents.forEach(function (content) {
            dialog.append(content);
        });
        dialog.append(btnOk);
        dialog.setTitle(title || '提示');

        dialog._promise = promise;
        dialog._resolved = false;

        dialog.open();
        return promise;
    };
    // ----------
    PileDialog.confirmDialog = new PileDialog({
        prop: {
            skin: 'default',
            cover: true,
            closeBtn: true,
            lock: true
        },
        content: [
            new PileDialog.Row({
                content: [
                    {
                        text: '取消',
                        style: {
                            flex: 1
                        },
                        click: function () {
                            var dialog = this.dialog();
                            dialog._resolved = false;
                            dialog.close();
                        }
                    },
                    {
                        text: '确定',
                        style: {
                            flex: 1,
                            marginLeft: 0
                        },
                        click: function () {
                            var dialog = this.dialog();
                            dialog._resolved = true;
                            dialog.close();
                        }
                    }
                ]
            })
        ]
    });
    PileDialog.confirmDialog.on('close', function (e) {
        var dialog = this,
            promise = dialog._promise,
            resolved = dialog._resolved;
        promise && (resolved ? promise.resolve(e) : promise.reject(e));
    });
    PileDialog.confirm = function (contents, title, btnTextCancel, btnTextConfirm) {
        var dialog = PileDialog.confirmDialog,
            btnRow = dialog.find(-1),
            promise = new Promise(),
            btnText = {
                cancel: btnTextCancel || '取消',
                confirm: btnTextConfirm || '确定'
            };

        if (!utils.isArray(contents)) {
            contents = [contents];
        }
        dialog.remove(btnRow);
        dialog.clear();
        contents.forEach(function (content) {
            dialog.append(content);
        });
        dialog.append(btnRow);
        dialog.setTitle(title || '提示');

        // 设置取消键和确定键的文本
        btnRow.find(0).setText(btnText.cancel);
        btnRow.find(1).setText(btnText.confirm);

        dialog._promise = promise;
        dialog._resolved = false;

        dialog.open();
        return promise;
    };
};

PileDialog.waitDefaultDialog = function (dialogName, funcName) {
    if (PileDialog[dialogName]) {
        console.error('PileDialog.%s 已存在。\n(PileDialog.%s already exists.)', dialogName, dialogName);
        return;
    }
    if (PileDialog[funcName]) {
        console.error('PileDialog.%s 已存在。\n(PileDialog.%s already exists.)', funcName, funcName);
        return;
    }
    PileDialog[funcName] = function () {
        // console.log('Dialog.%s 还没有准备好……', funcName);
        var args = arguments;
        window.setTimeout(function () {
            PileDialog[funcName].apply(PileDialog[dialogName], args);
        }, 50);
    };
};

PileDialog.waitDefaultDialog('toastDialog', 'toast');
PileDialog.waitDefaultDialog('alertDialog', 'alert');
PileDialog.waitDefaultDialog('confirmDialog', 'confirm');

if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', PileDialog.createDefaultDialogs);
} else if (window.addEventListener) {
    window.addEventListener('load', PileDialog.createDefaultDialogs);
} else if (window.attachEvent) {
    window.attachEvent('onload', PileDialog.createDefaultDialogs);
};

window.PileDialog = PileDialog;;
})();;
/*! PhotoSwipe - v4.1.1 - 2015-12-24
* http://photoswipe.com
* Copyright (c) 2015 Dmitry Semenov; */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.PhotoSwipe=b()}(this,function(){"use strict";var a=function(a,b,c,d){var e={features:null,bind:function(a,b,c,d){var e=(d?"remove":"add")+"EventListener";b=b.split(" ");for(var f=0;f<b.length;f++)b[f]&&a[e](b[f],c,!1)},isArray:function(a){return a instanceof Array},createEl:function(a,b){var c=document.createElement(b||"div");return a&&(c.className=a),c},getScrollY:function(){var a=window.pageYOffset;return void 0!==a?a:document.documentElement.scrollTop},unbind:function(a,b,c){e.bind(a,b,c,!0)},removeClass:function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(a,b){e.hasClass(a,b)||(a.className+=(a.className?" ":"")+b)},hasClass:function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},getChildByClass:function(a,b){for(var c=a.firstChild;c;){if(e.hasClass(c,b))return c;c=c.nextSibling}},arraySearch:function(a,b,c){for(var d=a.length;d--;)if(a[d][c]===b)return d;return-1},extend:function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){if(c&&a.hasOwnProperty(d))continue;a[d]=b[d]}},easing:{sine:{out:function(a){return Math.sin(a*(Math.PI/2))},inOut:function(a){return-(Math.cos(Math.PI*a)-1)/2}},cubic:{out:function(a){return--a*a*a+1}}},detectFeatures:function(){if(e.features)return e.features;var a=e.createEl(),b=a.style,c="",d={};if(d.oldIE=document.all&&!document.addEventListener,d.touch="ontouchstart"in window,window.requestAnimationFrame&&(d.raf=window.requestAnimationFrame,d.caf=window.cancelAnimationFrame),d.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!d.pointerEvent){var f=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var g=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);g&&g.length>0&&(g=parseInt(g[1],10),g>=1&&8>g&&(d.isOldIOSPhone=!0))}var h=f.match(/Android\s([0-9\.]*)/),i=h?h[1]:0;i=parseFloat(i),i>=1&&(4.4>i&&(d.isOldAndroid=!0),d.androidVersion=i),d.isMobileOpera=/opera mini|opera mobi/i.test(f)}for(var j,k,l=["transform","perspective","animationName"],m=["","webkit","Moz","ms","O"],n=0;4>n;n++){c=m[n];for(var o=0;3>o;o++)j=l[o],k=c+(c?j.charAt(0).toUpperCase()+j.slice(1):j),!d[j]&&k in b&&(d[j]=k);c&&!d.raf&&(c=c.toLowerCase(),d.raf=window[c+"RequestAnimationFrame"],d.raf&&(d.caf=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]))}if(!d.raf){var p=0;d.raf=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-p)),d=window.setTimeout(function(){a(b+c)},c);return p=b+c,d},d.caf=function(a){clearTimeout(a)}}return d.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,e.features=d,d}};e.detectFeatures(),e.features.oldIE&&(e.bind=function(a,b,c,d){b=b.split(" ");for(var e,f=(d?"detach":"attach")+"Event",g=function(){c.handleEvent.call(c)},h=0;h<b.length;h++)if(e=b[h])if("object"==typeof c&&c.handleEvent){if(d){if(!c["oldIE"+e])return!1}else c["oldIE"+e]=g;a[f]("on"+e,c["oldIE"+e])}else a[f]("on"+e,c)});var f=this,g=25,h=3,i={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(a){return"A"===a.tagName},getDoubleTapZoom:function(a,b){return a?1:b.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};e.extend(i,d);var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la=function(){return{x:0,y:0}},ma=la(),na=la(),oa=la(),pa={},qa=0,ra={},sa=la(),ta=0,ua=!0,va=[],wa={},xa=!1,ya=function(a,b){e.extend(f,b.publicMethods),va.push(a)},za=function(a){var b=_b();return a>b-1?a-b:0>a?b+a:a},Aa={},Ba=function(a,b){return Aa[a]||(Aa[a]=[]),Aa[a].push(b)},Ca=function(a){var b=Aa[a];if(b){var c=Array.prototype.slice.call(arguments);c.shift();for(var d=0;d<b.length;d++)b[d].apply(f,c)}},Da=function(){return(new Date).getTime()},Ea=function(a){ia=a,f.bg.style.opacity=a*i.bgOpacity},Fa=function(a,b,c,d,e){(!xa||e&&e!==f.currItem)&&(d/=e?e.fitRatio:f.currItem.fitRatio),a[E]=u+b+"px, "+c+"px"+v+" scale("+d+")"},Ga=function(a){da&&(a&&(s>f.currItem.fitRatio?xa||(lc(f.currItem,!1,!0),xa=!0):xa&&(lc(f.currItem),xa=!1)),Fa(da,oa.x,oa.y,s))},Ha=function(a){a.container&&Fa(a.container.style,a.initialPosition.x,a.initialPosition.y,a.initialZoomLevel,a)},Ia=function(a,b){b[E]=u+a+"px, 0px"+v},Ja=function(a,b){if(!i.loop&&b){var c=m+(sa.x*qa-a)/sa.x,d=Math.round(a-sb.x);(0>c&&d>0||c>=_b()-1&&0>d)&&(a=sb.x+d*i.mainScrollEndFriction)}sb.x=a,Ia(a,n)},Ka=function(a,b){var c=tb[a]-ra[a];return na[a]+ma[a]+c-c*(b/t)},La=function(a,b){a.x=b.x,a.y=b.y,b.id&&(a.id=b.id)},Ma=function(a){a.x=Math.round(a.x),a.y=Math.round(a.y)},Na=null,Oa=function(){Na&&(e.unbind(document,"mousemove",Oa),e.addClass(a,"pswp--has_mouse"),i.mouseUsed=!0,Ca("mouseUsed")),Na=setTimeout(function(){Na=null},100)},Pa=function(){e.bind(document,"keydown",f),N.transform&&e.bind(f.scrollWrap,"click",f),i.mouseUsed||e.bind(document,"mousemove",Oa),e.bind(window,"resize scroll",f),Ca("bindEvents")},Qa=function(){e.unbind(window,"resize",f),e.unbind(window,"scroll",r.scroll),e.unbind(document,"keydown",f),e.unbind(document,"mousemove",Oa),N.transform&&e.unbind(f.scrollWrap,"click",f),U&&e.unbind(window,p,f),Ca("unbindEvents")},Ra=function(a,b){var c=hc(f.currItem,pa,a);return b&&(ca=c),c},Sa=function(a){return a||(a=f.currItem),a.initialZoomLevel},Ta=function(a){return a||(a=f.currItem),a.w>0?i.maxSpreadZoom:1},Ua=function(a,b,c,d){return d===f.currItem.initialZoomLevel?(c[a]=f.currItem.initialPosition[a],!0):(c[a]=Ka(a,d),c[a]>b.min[a]?(c[a]=b.min[a],!0):c[a]<b.max[a]?(c[a]=b.max[a],!0):!1)},Va=function(){if(E){var b=N.perspective&&!G;return u="translate"+(b?"3d(":"("),void(v=N.perspective?", 0px)":")")}E="left",e.addClass(a,"pswp--ie"),Ia=function(a,b){b.left=a+"px"},Ha=function(a){var b=a.fitRatio>1?1:a.fitRatio,c=a.container.style,d=b*a.w,e=b*a.h;c.width=d+"px",c.height=e+"px",c.left=a.initialPosition.x+"px",c.top=a.initialPosition.y+"px"},Ga=function(){if(da){var a=da,b=f.currItem,c=b.fitRatio>1?1:b.fitRatio,d=c*b.w,e=c*b.h;a.width=d+"px",a.height=e+"px",a.left=oa.x+"px",a.top=oa.y+"px"}}},Wa=function(a){var b="";i.escKey&&27===a.keyCode?b="close":i.arrowKeys&&(37===a.keyCode?b="prev":39===a.keyCode&&(b="next")),b&&(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||(a.preventDefault?a.preventDefault():a.returnValue=!1,f[b]()))},Xa=function(a){a&&(X||W||ea||S)&&(a.preventDefault(),a.stopPropagation())},Ya=function(){f.setScrollOffset(0,e.getScrollY())},Za={},$a=0,_a=function(a){Za[a]&&(Za[a].raf&&I(Za[a].raf),$a--,delete Za[a])},ab=function(a){Za[a]&&_a(a),Za[a]||($a++,Za[a]={})},bb=function(){for(var a in Za)Za.hasOwnProperty(a)&&_a(a)},cb=function(a,b,c,d,e,f,g){var h,i=Da();ab(a);var j=function(){if(Za[a]){if(h=Da()-i,h>=d)return _a(a),f(c),void(g&&g());f((c-b)*e(h/d)+b),Za[a].raf=H(j)}};j()},db={shout:Ca,listen:Ba,viewportSize:pa,options:i,isMainScrollAnimating:function(){return ea},getZoomLevel:function(){return s},getCurrentIndex:function(){return m},isDragging:function(){return U},isZooming:function(){return _},setScrollOffset:function(a,b){ra.x=a,M=ra.y=b,Ca("updateScrollOffset",ra)},applyZoomPan:function(a,b,c,d){oa.x=b,oa.y=c,s=a,Ga(d)},init:function(){if(!j&&!k){var c;f.framework=e,f.template=a,f.bg=e.getChildByClass(a,"pswp__bg"),J=a.className,j=!0,N=e.detectFeatures(),H=N.raf,I=N.caf,E=N.transform,L=N.oldIE,f.scrollWrap=e.getChildByClass(a,"pswp__scroll-wrap"),f.container=e.getChildByClass(f.scrollWrap,"pswp__container"),n=f.container.style,f.itemHolders=y=[{el:f.container.children[0],wrap:0,index:-1},{el:f.container.children[1],wrap:0,index:-1},{el:f.container.children[2],wrap:0,index:-1}],y[0].el.style.display=y[2].el.style.display="none",Va(),r={resize:f.updateSize,scroll:Ya,keydown:Wa,click:Xa};var d=N.isOldIOSPhone||N.isOldAndroid||N.isMobileOpera;for(N.animationName&&N.transform&&!d||(i.showAnimationDuration=i.hideAnimationDuration=0),c=0;c<va.length;c++)f["init"+va[c]]();if(b){var g=f.ui=new b(f,e);g.init()}Ca("firstUpdate"),m=m||i.index||0,(isNaN(m)||0>m||m>=_b())&&(m=0),f.currItem=$b(m),(N.isOldIOSPhone||N.isOldAndroid)&&(ua=!1),a.setAttribute("aria-hidden","false"),i.modal&&(ua?a.style.position="fixed":(a.style.position="absolute",a.style.top=e.getScrollY()+"px")),void 0===M&&(Ca("initialLayout"),M=K=e.getScrollY());var l="pswp--open ";for(i.mainClass&&(l+=i.mainClass+" "),i.showHideOpacity&&(l+="pswp--animate_opacity "),l+=G?"pswp--touch":"pswp--notouch",l+=N.animationName?" pswp--css_animation":"",l+=N.svg?" pswp--svg":"",e.addClass(a,l),f.updateSize(),o=-1,ta=null,c=0;h>c;c++)Ia((c+o)*sa.x,y[c].el.style);L||e.bind(f.scrollWrap,q,f),Ba("initialZoomInEnd",function(){f.setContent(y[0],m-1),f.setContent(y[2],m+1),y[0].el.style.display=y[2].el.style.display="block",i.focus&&a.focus(),Pa()}),f.setContent(y[1],m),f.updateCurrItem(),Ca("afterInit"),ua||(w=setInterval(function(){$a||U||_||s!==f.currItem.initialZoomLevel||f.updateSize()},1e3)),e.addClass(a,"pswp--visible")}},close:function(){j&&(j=!1,k=!0,Ca("close"),Qa(),bc(f.currItem,null,!0,f.destroy))},destroy:function(){Ca("destroy"),Wb&&clearTimeout(Wb),a.setAttribute("aria-hidden","true"),a.className=J,w&&clearInterval(w),e.unbind(f.scrollWrap,q,f),e.unbind(window,"scroll",f),yb(),bb(),Aa=null},panTo:function(a,b,c){c||(a>ca.min.x?a=ca.min.x:a<ca.max.x&&(a=ca.max.x),b>ca.min.y?b=ca.min.y:b<ca.max.y&&(b=ca.max.y)),oa.x=a,oa.y=b,Ga()},handleEvent:function(a){a=a||window.event,r[a.type]&&r[a.type](a)},goTo:function(a){a=za(a);var b=a-m;ta=b,m=a,f.currItem=$b(m),qa-=b,Ja(sa.x*qa),bb(),ea=!1,f.updateCurrItem()},next:function(){f.goTo(m+1)},prev:function(){f.goTo(m-1)},updateCurrZoomItem:function(a){if(a&&Ca("beforeChange",0),y[1].el.children.length){var b=y[1].el.children[0];da=e.hasClass(b,"pswp__zoom-wrap")?b.style:null}else da=null;ca=f.currItem.bounds,t=s=f.currItem.initialZoomLevel,oa.x=ca.center.x,oa.y=ca.center.y,a&&Ca("afterChange")},invalidateCurrItems:function(){x=!0;for(var a=0;h>a;a++)y[a].item&&(y[a].item.needsUpdate=!0)},updateCurrItem:function(a){if(0!==ta){var b,c=Math.abs(ta);if(!(a&&2>c)){f.currItem=$b(m),xa=!1,Ca("beforeChange",ta),c>=h&&(o+=ta+(ta>0?-h:h),c=h);for(var d=0;c>d;d++)ta>0?(b=y.shift(),y[h-1]=b,o++,Ia((o+2)*sa.x,b.el.style),f.setContent(b,m-c+d+1+1)):(b=y.pop(),y.unshift(b),o--,Ia(o*sa.x,b.el.style),f.setContent(b,m+c-d-1-1));if(da&&1===Math.abs(ta)){var e=$b(z);e.initialZoomLevel!==s&&(hc(e,pa),lc(e),Ha(e))}ta=0,f.updateCurrZoomItem(),z=m,Ca("afterChange")}}},updateSize:function(b){if(!ua&&i.modal){var c=e.getScrollY();if(M!==c&&(a.style.top=c+"px",M=c),!b&&wa.x===window.innerWidth&&wa.y===window.innerHeight)return;wa.x=window.innerWidth,wa.y=window.innerHeight,a.style.height=wa.y+"px"}if(pa.x=f.scrollWrap.clientWidth,pa.y=f.scrollWrap.clientHeight,Ya(),sa.x=pa.x+Math.round(pa.x*i.spacing),sa.y=pa.y,Ja(sa.x*qa),Ca("beforeResize"),void 0!==o){for(var d,g,j,k=0;h>k;k++)d=y[k],Ia((k+o)*sa.x,d.el.style),j=m+k-1,i.loop&&_b()>2&&(j=za(j)),g=$b(j),g&&(x||g.needsUpdate||!g.bounds)?(f.cleanSlide(g),f.setContent(d,j),1===k&&(f.currItem=g,f.updateCurrZoomItem(!0)),g.needsUpdate=!1):-1===d.index&&j>=0&&f.setContent(d,j),g&&g.container&&(hc(g,pa),lc(g),Ha(g));x=!1}t=s=f.currItem.initialZoomLevel,ca=f.currItem.bounds,ca&&(oa.x=ca.center.x,oa.y=ca.center.y,Ga(!0)),Ca("resize")},zoomTo:function(a,b,c,d,f){b&&(t=s,tb.x=Math.abs(b.x)-oa.x,tb.y=Math.abs(b.y)-oa.y,La(na,oa));var g=Ra(a,!1),h={};Ua("x",g,h,a),Ua("y",g,h,a);var i=s,j={x:oa.x,y:oa.y};Ma(h);var k=function(b){1===b?(s=a,oa.x=h.x,oa.y=h.y):(s=(a-i)*b+i,oa.x=(h.x-j.x)*b+j.x,oa.y=(h.y-j.y)*b+j.y),f&&f(b),Ga(1===b)};c?cb("customZoomTo",0,1,c,d||e.easing.sine.inOut,k):k(1)}},eb=30,fb=10,gb={},hb={},ib={},jb={},kb={},lb=[],mb={},nb=[],ob={},pb=0,qb=la(),rb=0,sb=la(),tb=la(),ub=la(),vb=function(a,b){return a.x===b.x&&a.y===b.y},wb=function(a,b){return Math.abs(a.x-b.x)<g&&Math.abs(a.y-b.y)<g},xb=function(a,b){return ob.x=Math.abs(a.x-b.x),ob.y=Math.abs(a.y-b.y),Math.sqrt(ob.x*ob.x+ob.y*ob.y)},yb=function(){Y&&(I(Y),Y=null)},zb=function(){U&&(Y=H(zb),Pb())},Ab=function(){return!("fit"===i.scaleMode&&s===f.currItem.initialZoomLevel)},Bb=function(a,b){return a&&a!==document?a.getAttribute("class")&&a.getAttribute("class").indexOf("pswp__scroll-wrap")>-1?!1:b(a)?a:Bb(a.parentNode,b):!1},Cb={},Db=function(a,b){return Cb.prevent=!Bb(a.target,i.isClickableElement),Ca("preventDragEvent",a,b,Cb),Cb.prevent},Eb=function(a,b){return b.x=a.pageX,b.y=a.pageY,b.id=a.identifier,b},Fb=function(a,b,c){c.x=.5*(a.x+b.x),c.y=.5*(a.y+b.y)},Gb=function(a,b,c){if(a-P>50){var d=nb.length>2?nb.shift():{};d.x=b,d.y=c,nb.push(d),P=a}},Hb=function(){var a=oa.y-f.currItem.initialPosition.y;return 1-Math.abs(a/(pa.y/2))},Ib={},Jb={},Kb=[],Lb=function(a){for(;Kb.length>0;)Kb.pop();return F?(ka=0,lb.forEach(function(a){0===ka?Kb[0]=a:1===ka&&(Kb[1]=a),ka++})):a.type.indexOf("touch")>-1?a.touches&&a.touches.length>0&&(Kb[0]=Eb(a.touches[0],Ib),a.touches.length>1&&(Kb[1]=Eb(a.touches[1],Jb))):(Ib.x=a.pageX,Ib.y=a.pageY,Ib.id="",Kb[0]=Ib),Kb},Mb=function(a,b){var c,d,e,g,h=0,j=oa[a]+b[a],k=b[a]>0,l=sb.x+b.x,m=sb.x-mb.x;return c=j>ca.min[a]||j<ca.max[a]?i.panEndFriction:1,j=oa[a]+b[a]*c,!i.allowPanToNext&&s!==f.currItem.initialZoomLevel||(da?"h"!==fa||"x"!==a||W||(k?(j>ca.min[a]&&(c=i.panEndFriction,h=ca.min[a]-j,d=ca.min[a]-na[a]),(0>=d||0>m)&&_b()>1?(g=l,0>m&&l>mb.x&&(g=mb.x)):ca.min.x!==ca.max.x&&(e=j)):(j<ca.max[a]&&(c=i.panEndFriction,h=j-ca.max[a],d=na[a]-ca.max[a]),(0>=d||m>0)&&_b()>1?(g=l,m>0&&l<mb.x&&(g=mb.x)):ca.min.x!==ca.max.x&&(e=j))):g=l,"x"!==a)?void(ea||Z||s>f.currItem.fitRatio&&(oa[a]+=b[a]*c)):(void 0!==g&&(Ja(g,!0),Z=g===mb.x?!1:!0),ca.min.x!==ca.max.x&&(void 0!==e?oa.x=e:Z||(oa.x+=b.x*c)),void 0!==g)},Nb=function(a){if(!("mousedown"===a.type&&a.button>0)){if(Zb)return void a.preventDefault();if(!T||"mousedown"!==a.type){if(Db(a,!0)&&a.preventDefault(),Ca("pointerDown"),F){var b=e.arraySearch(lb,a.pointerId,"id");0>b&&(b=lb.length),lb[b]={x:a.pageX,y:a.pageY,id:a.pointerId}}var c=Lb(a),d=c.length;$=null,bb(),U&&1!==d||(U=ga=!0,e.bind(window,p,f),R=ja=ha=S=Z=X=V=W=!1,fa=null,Ca("firstTouchStart",c),La(na,oa),ma.x=ma.y=0,La(jb,c[0]),La(kb,jb),mb.x=sa.x*qa,nb=[{x:jb.x,y:jb.y}],P=O=Da(),Ra(s,!0),yb(),zb()),!_&&d>1&&!ea&&!Z&&(t=s,W=!1,_=V=!0,ma.y=ma.x=0,La(na,oa),La(gb,c[0]),La(hb,c[1]),Fb(gb,hb,ub),tb.x=Math.abs(ub.x)-oa.x,tb.y=Math.abs(ub.y)-oa.y,aa=ba=xb(gb,hb))}}},Ob=function(a){if(a.preventDefault(),F){var b=e.arraySearch(lb,a.pointerId,"id");if(b>-1){var c=lb[b];c.x=a.pageX,c.y=a.pageY}}if(U){var d=Lb(a);if(fa||X||_)$=d;else if(sb.x!==sa.x*qa)fa="h";else{var f=Math.abs(d[0].x-jb.x)-Math.abs(d[0].y-jb.y);Math.abs(f)>=fb&&(fa=f>0?"h":"v",$=d)}}},Pb=function(){if($){var a=$.length;if(0!==a)if(La(gb,$[0]),ib.x=gb.x-jb.x,ib.y=gb.y-jb.y,_&&a>1){if(jb.x=gb.x,jb.y=gb.y,!ib.x&&!ib.y&&vb($[1],hb))return;La(hb,$[1]),W||(W=!0,Ca("zoomGestureStarted"));var b=xb(gb,hb),c=Ub(b);c>f.currItem.initialZoomLevel+f.currItem.initialZoomLevel/15&&(ja=!0);var d=1,e=Sa(),g=Ta();if(e>c)if(i.pinchToClose&&!ja&&t<=f.currItem.initialZoomLevel){var h=e-c,j=1-h/(e/1.2);Ea(j),Ca("onPinchClose",j),ha=!0}else d=(e-c)/e,d>1&&(d=1),c=e-d*(e/3);else c>g&&(d=(c-g)/(6*e),d>1&&(d=1),c=g+d*e);0>d&&(d=0),aa=b,Fb(gb,hb,qb),ma.x+=qb.x-ub.x,ma.y+=qb.y-ub.y,La(ub,qb),oa.x=Ka("x",c),oa.y=Ka("y",c),R=c>s,s=c,Ga()}else{if(!fa)return;if(ga&&(ga=!1,Math.abs(ib.x)>=fb&&(ib.x-=$[0].x-kb.x),Math.abs(ib.y)>=fb&&(ib.y-=$[0].y-kb.y)),jb.x=gb.x,jb.y=gb.y,0===ib.x&&0===ib.y)return;if("v"===fa&&i.closeOnVerticalDrag&&!Ab()){ma.y+=ib.y,oa.y+=ib.y;var k=Hb();return S=!0,Ca("onVerticalDrag",k),Ea(k),void Ga()}Gb(Da(),gb.x,gb.y),X=!0,ca=f.currItem.bounds;var l=Mb("x",ib);l||(Mb("y",ib),Ma(oa),Ga())}}},Qb=function(a){if(N.isOldAndroid){if(T&&"mouseup"===a.type)return;a.type.indexOf("touch")>-1&&(clearTimeout(T),T=setTimeout(function(){T=0},600))}Ca("pointerUp"),Db(a,!1)&&a.preventDefault();var b;if(F){var c=e.arraySearch(lb,a.pointerId,"id");if(c>-1)if(b=lb.splice(c,1)[0],navigator.pointerEnabled)b.type=a.pointerType||"mouse";else{var d={4:"mouse",2:"touch",3:"pen"};b.type=d[a.pointerType],b.type||(b.type=a.pointerType||"mouse")}}var g,h=Lb(a),j=h.length;if("mouseup"===a.type&&(j=0),2===j)return $=null,!0;1===j&&La(kb,h[0]),0!==j||fa||ea||(b||("mouseup"===a.type?b={x:a.pageX,y:a.pageY,type:"mouse"}:a.changedTouches&&a.changedTouches[0]&&(b={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,type:"touch"})),Ca("touchRelease",a,b));var k=-1;if(0===j&&(U=!1,e.unbind(window,p,f),yb(),_?k=0:-1!==rb&&(k=Da()-rb)),rb=1===j?Da():-1,g=-1!==k&&150>k?"zoom":"swipe",_&&2>j&&(_=!1,1===j&&(g="zoomPointerUp"),Ca("zoomGestureEnded")),$=null,X||W||ea||S)if(bb(),Q||(Q=Rb()),Q.calculateSwipeSpeed("x"),S){var l=Hb();if(l<i.verticalDragRange)f.close();else{var m=oa.y,n=ia;cb("verticalDrag",0,1,300,e.easing.cubic.out,function(a){oa.y=(f.currItem.initialPosition.y-m)*a+m,Ea((1-n)*a+n),Ga()}),Ca("onVerticalDrag",1)}}else{if((Z||ea)&&0===j){var o=Tb(g,Q);if(o)return;g="zoomPointerUp"}if(!ea)return"swipe"!==g?void Vb():void(!Z&&s>f.currItem.fitRatio&&Sb(Q))}},Rb=function(){var a,b,c={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(d){nb.length>1?(a=Da()-P+50,b=nb[nb.length-2][d]):(a=Da()-O,b=kb[d]),c.lastFlickOffset[d]=jb[d]-b,c.lastFlickDist[d]=Math.abs(c.lastFlickOffset[d]),c.lastFlickDist[d]>20?c.lastFlickSpeed[d]=c.lastFlickOffset[d]/a:c.lastFlickSpeed[d]=0,Math.abs(c.lastFlickSpeed[d])<.1&&(c.lastFlickSpeed[d]=0),c.slowDownRatio[d]=.95,c.slowDownRatioReverse[d]=1-c.slowDownRatio[d],c.speedDecelerationRatio[d]=1},calculateOverBoundsAnimOffset:function(a,b){c.backAnimStarted[a]||(oa[a]>ca.min[a]?c.backAnimDestination[a]=ca.min[a]:oa[a]<ca.max[a]&&(c.backAnimDestination[a]=ca.max[a]),void 0!==c.backAnimDestination[a]&&(c.slowDownRatio[a]=.7,c.slowDownRatioReverse[a]=1-c.slowDownRatio[a],c.speedDecelerationRatioAbs[a]<.05&&(c.lastFlickSpeed[a]=0,c.backAnimStarted[a]=!0,cb("bounceZoomPan"+a,oa[a],c.backAnimDestination[a],b||300,e.easing.sine.out,function(b){oa[a]=b,Ga()}))))},calculateAnimOffset:function(a){c.backAnimStarted[a]||(c.speedDecelerationRatio[a]=c.speedDecelerationRatio[a]*(c.slowDownRatio[a]+c.slowDownRatioReverse[a]-c.slowDownRatioReverse[a]*c.timeDiff/10),c.speedDecelerationRatioAbs[a]=Math.abs(c.lastFlickSpeed[a]*c.speedDecelerationRatio[a]),c.distanceOffset[a]=c.lastFlickSpeed[a]*c.speedDecelerationRatio[a]*c.timeDiff,oa[a]+=c.distanceOffset[a])},panAnimLoop:function(){return Za.zoomPan&&(Za.zoomPan.raf=H(c.panAnimLoop),c.now=Da(),c.timeDiff=c.now-c.lastNow,c.lastNow=c.now,c.calculateAnimOffset("x"),c.calculateAnimOffset("y"),Ga(),c.calculateOverBoundsAnimOffset("x"),c.calculateOverBoundsAnimOffset("y"),c.speedDecelerationRatioAbs.x<.05&&c.speedDecelerationRatioAbs.y<.05)?(oa.x=Math.round(oa.x),oa.y=Math.round(oa.y),Ga(),void _a("zoomPan")):void 0}};return c},Sb=function(a){return a.calculateSwipeSpeed("y"),ca=f.currItem.bounds,a.backAnimDestination={},a.backAnimStarted={},Math.abs(a.lastFlickSpeed.x)<=.05&&Math.abs(a.lastFlickSpeed.y)<=.05?(a.speedDecelerationRatioAbs.x=a.speedDecelerationRatioAbs.y=0,a.calculateOverBoundsAnimOffset("x"),a.calculateOverBoundsAnimOffset("y"),!0):(ab("zoomPan"),a.lastNow=Da(),void a.panAnimLoop())},Tb=function(a,b){var c;ea||(pb=m);var d;if("swipe"===a){var g=jb.x-kb.x,h=b.lastFlickDist.x<10;g>eb&&(h||b.lastFlickOffset.x>20)?d=-1:-eb>g&&(h||b.lastFlickOffset.x<-20)&&(d=1)}var j;d&&(m+=d,0>m?(m=i.loop?_b()-1:0,j=!0):m>=_b()&&(m=i.loop?0:_b()-1,j=!0),(!j||i.loop)&&(ta+=d,qa-=d,c=!0));var k,l=sa.x*qa,n=Math.abs(l-sb.x);return c||l>sb.x==b.lastFlickSpeed.x>0?(k=Math.abs(b.lastFlickSpeed.x)>0?n/Math.abs(b.lastFlickSpeed.x):333,k=Math.min(k,400),k=Math.max(k,250)):k=333,pb===m&&(c=!1),ea=!0,Ca("mainScrollAnimStart"),cb("mainScroll",sb.x,l,k,e.easing.cubic.out,Ja,function(){bb(),ea=!1,pb=-1,(c||pb!==m)&&f.updateCurrItem(),Ca("mainScrollAnimComplete")}),c&&f.updateCurrItem(!0),c},Ub=function(a){return 1/ba*a*t},Vb=function(){var a=s,b=Sa(),c=Ta();b>s?a=b:s>c&&(a=c);var d,g=1,h=ia;return ha&&!R&&!ja&&b>s?(f.close(),!0):(ha&&(d=function(a){Ea((g-h)*a+h)}),f.zoomTo(a,0,200,e.easing.cubic.out,d),!0)};ya("Gestures",{publicMethods:{initGestures:function(){var a=function(a,b,c,d,e){A=a+b,B=a+c,C=a+d,D=e?a+e:""};F=N.pointerEvent,F&&N.touch&&(N.touch=!1),F?navigator.pointerEnabled?a("pointer","down","move","up","cancel"):a("MSPointer","Down","Move","Up","Cancel"):N.touch?(a("touch","start","move","end","cancel"),G=!0):a("mouse","down","move","up"),p=B+" "+C+" "+D,q=A,F&&!G&&(G=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),f.likelyTouchDevice=G,r[A]=Nb,r[B]=Ob,r[C]=Qb,D&&(r[D]=r[C]),N.touch&&(q+=" mousedown",p+=" mousemove mouseup",r.mousedown=r[A],r.mousemove=r[B],r.mouseup=r[C]),G||(i.allowPanToNext=!1)}}});var Wb,Xb,Yb,Zb,$b,_b,ac,bc=function(b,c,d,g){Wb&&clearTimeout(Wb),Zb=!0,Yb=!0;var h;b.initialLayout?(h=b.initialLayout,b.initialLayout=null):h=i.getThumbBoundsFn&&i.getThumbBoundsFn(m);var j=d?i.hideAnimationDuration:i.showAnimationDuration,k=function(){_a("initialZoom"),d?(f.template.removeAttribute("style"),f.bg.removeAttribute("style")):(Ea(1),c&&(c.style.display="block"),e.addClass(a,"pswp--animated-in"),Ca("initialZoom"+(d?"OutEnd":"InEnd"))),g&&g(),Zb=!1};if(!j||!h||void 0===h.x)return Ca("initialZoom"+(d?"Out":"In")),s=b.initialZoomLevel,La(oa,b.initialPosition),Ga(),a.style.opacity=d?0:1,Ea(1),void(j?setTimeout(function(){k()},j):k());var n=function(){var c=l,g=!f.currItem.src||f.currItem.loadError||i.showHideOpacity;b.miniImg&&(b.miniImg.style.webkitBackfaceVisibility="hidden"),d||(s=h.w/b.w,oa.x=h.x,oa.y=h.y-K,f[g?"template":"bg"].style.opacity=.001,Ga()),ab("initialZoom"),d&&!c&&e.removeClass(a,"pswp--animated-in"),g&&(d?e[(c?"remove":"add")+"Class"](a,"pswp--animate_opacity"):setTimeout(function(){e.addClass(a,"pswp--animate_opacity")},30)),Wb=setTimeout(function(){if(Ca("initialZoom"+(d?"Out":"In")),d){var f=h.w/b.w,i={x:oa.x,y:oa.y},l=s,m=ia,n=function(b){1===b?(s=f,oa.x=h.x,oa.y=h.y-M):(s=(f-l)*b+l,oa.x=(h.x-i.x)*b+i.x,oa.y=(h.y-M-i.y)*b+i.y),Ga(),g?a.style.opacity=1-b:Ea(m-b*m)};c?cb("initialZoom",0,1,j,e.easing.cubic.out,n,k):(n(1),Wb=setTimeout(k,j+20))}else s=b.initialZoomLevel,La(oa,b.initialPosition),Ga(),Ea(1),g?a.style.opacity=1:Ea(1),Wb=setTimeout(k,j+20)},d?25:90)};n()},cc={},dc=[],ec={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Xb.length}},fc=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},gc=function(a,b,c){var d=a.bounds;d.center.x=Math.round((cc.x-b)/2),d.center.y=Math.round((cc.y-c)/2)+a.vGap.top,d.max.x=b>cc.x?Math.round(cc.x-b):d.center.x,d.max.y=c>cc.y?Math.round(cc.y-c)+a.vGap.top:d.center.y,d.min.x=b>cc.x?0:d.center.x,d.min.y=c>cc.y?a.vGap.top:d.center.y},hc=function(a,b,c){if(a.src&&!a.loadError){var d=!c;if(d&&(a.vGap||(a.vGap={top:0,bottom:0}),Ca("parseVerticalMargin",a)),cc.x=b.x,cc.y=b.y-a.vGap.top-a.vGap.bottom,d){var e=cc.x/a.w,f=cc.y/a.h;a.fitRatio=f>e?e:f;var g=i.scaleMode;"orig"===g?c=1:"fit"===g&&(c=a.fitRatio),c>1&&(c=1),a.initialZoomLevel=c,a.bounds||(a.bounds=fc())}if(!c)return;return gc(a,a.w*c,a.h*c),d&&c===a.initialZoomLevel&&(a.initialPosition=a.bounds.center),a.bounds}return a.w=a.h=0,a.initialZoomLevel=a.fitRatio=1,a.bounds=fc(),a.initialPosition=a.bounds.center,a.bounds},ic=function(a,b,c,d,e,g){b.loadError||d&&(b.imageAppended=!0,lc(b,d,b===f.currItem&&xa),c.appendChild(d),g&&setTimeout(function(){b&&b.loaded&&b.placeholder&&(b.placeholder.style.display="none",b.placeholder=null)},500))},jc=function(a){a.loading=!0,a.loaded=!1;var b=a.img=e.createEl("pswp__img","img"),c=function(){a.loading=!1,a.loaded=!0,a.loadComplete?a.loadComplete(a):a.img=null,b.onload=b.onerror=null,b=null};return b.onload=c,b.onerror=function(){a.loadError=!0,c()},b.src=a.src,b},kc=function(a,b){return a.src&&a.loadError&&a.container?(b&&(a.container.innerHTML=""),a.container.innerHTML=i.errorMsg.replace("%url%",a.src),!0):void 0},lc=function(a,b,c){if(a.src){b||(b=a.container.lastChild);var d=c?a.w:Math.round(a.w*a.fitRatio),e=c?a.h:Math.round(a.h*a.fitRatio);a.placeholder&&!a.loaded&&(a.placeholder.style.width=d+"px",a.placeholder.style.height=e+"px"),b.style.width=d+"px",b.style.height=e+"px"}},mc=function(){if(dc.length){for(var a,b=0;b<dc.length;b++)a=dc[b],a.holder.index===a.index&&ic(a.index,a.item,a.baseDiv,a.img,!1,a.clearPlaceholder);dc=[]}};ya("Controller",{publicMethods:{lazyLoadItem:function(a){a=za(a);var b=$b(a);b&&(!b.loaded&&!b.loading||x)&&(Ca("gettingData",a,b),b.src&&jc(b))},initController:function(){e.extend(i,ec,!0),f.items=Xb=c,$b=f.getItemAt,_b=i.getNumItemsFn,ac=i.loop,_b()<3&&(i.loop=!1),Ba("beforeChange",function(a){var b,c=i.preload,d=null===a?!0:a>=0,e=Math.min(c[0],_b()),g=Math.min(c[1],_b());for(b=1;(d?g:e)>=b;b++)f.lazyLoadItem(m+b);for(b=1;(d?e:g)>=b;b++)f.lazyLoadItem(m-b)}),Ba("initialLayout",function(){f.currItem.initialLayout=i.getThumbBoundsFn&&i.getThumbBoundsFn(m)}),Ba("mainScrollAnimComplete",mc),Ba("initialZoomInEnd",mc),Ba("destroy",function(){for(var a,b=0;b<Xb.length;b++)a=Xb[b],a.container&&(a.container=null),a.placeholder&&(a.placeholder=null),a.img&&(a.img=null),a.preloader&&(a.preloader=null),a.loadError&&(a.loaded=a.loadError=!1);dc=null})},getItemAt:function(a){return a>=0&&void 0!==Xb[a]?Xb[a]:!1},allowProgressiveImg:function(){return i.forceProgressiveLoading||!G||i.mouseUsed||screen.width>1200},setContent:function(a,b){i.loop&&(b=za(b));var c=f.getItemAt(a.index);c&&(c.container=null);var d,g=f.getItemAt(b);if(!g)return void(a.el.innerHTML="");Ca("gettingData",b,g),a.index=b,a.item=g;var h=g.container=e.createEl("pswp__zoom-wrap");if(!g.src&&g.html&&(g.html.tagName?h.appendChild(g.html):h.innerHTML=g.html),kc(g),hc(g,pa),!g.src||g.loadError||g.loaded)g.src&&!g.loadError&&(d=e.createEl("pswp__img","img"),d.style.opacity=1,d.src=g.src,lc(g,d),ic(b,g,h,d,!0));else{if(g.loadComplete=function(c){if(j){if(a&&a.index===b){if(kc(c,!0))return c.loadComplete=c.img=null,hc(c,pa),Ha(c),void(a.index===m&&f.updateCurrZoomItem());c.imageAppended?!Zb&&c.placeholder&&(c.placeholder.style.display="none",c.placeholder=null):N.transform&&(ea||Zb)?dc.push({item:c,baseDiv:h,img:c.img,index:b,holder:a,clearPlaceholder:!0}):ic(b,c,h,c.img,ea||Zb,!0)}c.loadComplete=null,c.img=null,Ca("imageLoadComplete",b,c)}},e.features.transform){var k="pswp__img pswp__img--placeholder";k+=g.msrc?"":" pswp__img--placeholder--blank";var l=e.createEl(k,g.msrc?"img":"");g.msrc&&(l.src=g.msrc),lc(g,l),h.appendChild(l),g.placeholder=l}g.loading||jc(g),f.allowProgressiveImg()&&(!Yb&&N.transform?dc.push({item:g,baseDiv:h,img:g.img,index:b,holder:a}):ic(b,g,h,g.img,!0,!0))}Yb||b!==m?Ha(g):(da=h.style,bc(g,d||g.img)),a.el.innerHTML="",a.el.appendChild(h)},cleanSlide:function(a){a.img&&(a.img.onload=a.img.onerror=null),a.loaded=a.loading=a.img=a.imageAppended=!1}}});var nc,oc={},pc=function(a,b,c){var d=document.createEvent("CustomEvent"),e={origEvent:a,target:a.target,releasePoint:b,pointerType:c||"touch"};d.initCustomEvent("pswpTap",!0,!0,e),a.target.dispatchEvent(d)};ya("Tap",{publicMethods:{initTap:function(){Ba("firstTouchStart",f.onTapStart),Ba("touchRelease",f.onTapRelease),Ba("destroy",function(){oc={},nc=null})},onTapStart:function(a){a.length>1&&(clearTimeout(nc),nc=null)},onTapRelease:function(a,b){if(b&&!X&&!V&&!$a){var c=b;if(nc&&(clearTimeout(nc),nc=null,wb(c,oc)))return void Ca("doubleTap",c);if("mouse"===b.type)return void pc(a,b,"mouse");var d=a.target.tagName.toUpperCase();if("BUTTON"===d||e.hasClass(a.target,"pswp__single-tap"))return void pc(a,b);La(oc,c),nc=setTimeout(function(){pc(a,b),nc=null},300)}}}});var qc;ya("DesktopZoom",{publicMethods:{initDesktopZoom:function(){L||(G?Ba("mouseUsed",function(){f.setupDesktopZoom()}):f.setupDesktopZoom(!0))},setupDesktopZoom:function(b){qc={};var c="wheel mousewheel DOMMouseScroll";Ba("bindEvents",function(){e.bind(a,c,f.handleMouseWheel)}),Ba("unbindEvents",function(){qc&&e.unbind(a,c,f.handleMouseWheel)}),f.mouseZoomedIn=!1;var d,g=function(){f.mouseZoomedIn&&(e.removeClass(a,"pswp--zoomed-in"),f.mouseZoomedIn=!1),1>s?e.addClass(a,"pswp--zoom-allowed"):e.removeClass(a,"pswp--zoom-allowed"),h()},h=function(){d&&(e.removeClass(a,"pswp--dragging"),d=!1)};Ba("resize",g),Ba("afterChange",g),Ba("pointerDown",function(){f.mouseZoomedIn&&(d=!0,e.addClass(a,"pswp--dragging"))}),Ba("pointerUp",h),b||g()},handleMouseWheel:function(a){if(s<=f.currItem.fitRatio)return i.modal&&(!i.closeOnScroll||$a||U?a.preventDefault():E&&Math.abs(a.deltaY)>2&&(l=!0,f.close())),!0;if(a.stopPropagation(),qc.x=0,"deltaX"in a)1===a.deltaMode?(qc.x=18*a.deltaX,qc.y=18*a.deltaY):(qc.x=a.deltaX,qc.y=a.deltaY);else if("wheelDelta"in a)a.wheelDeltaX&&(qc.x=-.16*a.wheelDeltaX),a.wheelDeltaY?qc.y=-.16*a.wheelDeltaY:qc.y=-.16*a.wheelDelta;else{if(!("detail"in a))return;qc.y=a.detail}Ra(s,!0);var b=oa.x-qc.x,c=oa.y-qc.y;(i.modal||b<=ca.min.x&&b>=ca.max.x&&c<=ca.min.y&&c>=ca.max.y)&&a.preventDefault(),f.panTo(b,c)},toggleDesktopZoom:function(b){b=b||{x:pa.x/2+ra.x,y:pa.y/2+ra.y};var c=i.getDoubleTapZoom(!0,f.currItem),d=s===c;f.mouseZoomedIn=!d,f.zoomTo(d?f.currItem.initialZoomLevel:c,b,333),e[(d?"remove":"add")+"Class"](a,"pswp--zoomed-in")}}});var rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc={history:!0,galleryUID:1},Ec=function(){return Bc.hash.substring(1)},Fc=function(){rc&&clearTimeout(rc),tc&&clearTimeout(tc)},Gc=function(){var a=Ec(),b={};if(a.length<5)return b;var c,d=a.split("&");for(c=0;c<d.length;c++)if(d[c]){var e=d[c].split("=");e.length<2||(b[e[0]]=e[1])}if(i.galleryPIDs){var f=b.pid;for(b.pid=0,c=0;c<Xb.length;c++)if(Xb[c].pid===f){b.pid=c;break}}else b.pid=parseInt(b.pid,10)-1;return b.pid<0&&(b.pid=0),b},Hc=function(){if(tc&&clearTimeout(tc),$a||U)return void(tc=setTimeout(Hc,500));uc?clearTimeout(sc):uc=!0;var a=m+1,b=$b(m);b.hasOwnProperty("pid")&&(a=b.pid);var c=xc+"&gid="+i.galleryUID+"&pid="+a;yc||-1===Bc.hash.indexOf(c)&&(Ac=!0);var d=Bc.href.split("#")[0]+"#"+c;Cc?"#"+c!==window.location.hash&&history[yc?"replaceState":"pushState"]("",document.title,d):yc?Bc.replace(d):Bc.hash=c,yc=!0,sc=setTimeout(function(){uc=!1},60)};ya("History",{publicMethods:{initHistory:function(){if(e.extend(i,Dc,!0),i.history){Bc=window.location,Ac=!1,zc=!1,yc=!1,xc=Ec(),Cc="pushState"in history,xc.indexOf("gid=")>-1&&(xc=xc.split("&gid=")[0],xc=xc.split("?gid=")[0]),Ba("afterChange",f.updateURL),Ba("unbindEvents",function(){e.unbind(window,"hashchange",f.onHashChange)});var a=function(){wc=!0,zc||(Ac?history.back():xc?Bc.hash=xc:Cc?history.pushState("",document.title,Bc.pathname+Bc.search):Bc.hash=""),Fc()};Ba("unbindEvents",function(){l&&a()}),Ba("destroy",function(){wc||a()}),Ba("firstUpdate",function(){m=Gc().pid});var b=xc.indexOf("pid=");b>-1&&(xc=xc.substring(0,b),"&"===xc.slice(-1)&&(xc=xc.slice(0,-1))),setTimeout(function(){j&&e.bind(window,"hashchange",f.onHashChange)},40)}},onHashChange:function(){return Ec()===xc?(zc=!0,void f.close()):void(uc||(vc=!0,f.goTo(Gc().pid),vc=!1))},updateURL:function(){Fc(),vc||(yc?rc=setTimeout(Hc,800):Hc())}}}),e.extend(f,db)};return a});;
/*! PhotoSwipe Default UI - 4.1.1 - 2015-12-24
* http://photoswipe.com
* Copyright (c) 2015 Dmitry Semenov; */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.PhotoSwipeUI_Default=b()}(this,function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=this,w=!1,x=!0,y=!0,z={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(a,b){return a.title?(b.children[0].innerHTML=a.title,!0):(b.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return a.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return a.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},A=function(a){if(r)return!0;a=a||window.event,q.timeToIdle&&q.mouseUsed&&!k&&K();for(var c,d,e=a.target||a.srcElement,f=e.getAttribute("class")||"",g=0;g<S.length;g++)c=S[g],c.onTap&&f.indexOf("pswp__"+c.name)>-1&&(c.onTap(),d=!0);if(d){a.stopPropagation&&a.stopPropagation(),r=!0;var h=b.features.isOldAndroid?600:30;s=setTimeout(function(){r=!1},h)}},B=function(){return!a.likelyTouchDevice||q.mouseUsed||screen.width>q.fitControlsWidth},C=function(a,c,d){b[(d?"add":"remove")+"Class"](a,"pswp__"+c)},D=function(){var a=1===q.getNumItemsFn();a!==p&&(C(d,"ui--one-slide",a),p=a)},E=function(){C(i,"share-modal--hidden",y)},F=function(){return y=!y,y?(b.removeClass(i,"pswp__share-modal--fade-in"),setTimeout(function(){y&&E()},300)):(E(),setTimeout(function(){y||b.addClass(i,"pswp__share-modal--fade-in")},30)),y||H(),!1},G=function(b){b=b||window.event;var c=b.target||b.srcElement;return a.shout("shareLinkClick",b,c),c.href?c.hasAttribute("download")?!0:(window.open(c.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),y||F(),!1):!1},H=function(){for(var a,b,c,d,e,f="",g=0;g<q.shareButtons.length;g++)a=q.shareButtons[g],c=q.getImageURLForShare(a),d=q.getPageURLForShare(a),e=q.getTextForShare(a),b=a.url.replace("{{url}}",encodeURIComponent(d)).replace("{{image_url}}",encodeURIComponent(c)).replace("{{raw_image_url}}",c).replace("{{text}}",encodeURIComponent(e)),f+='<a href="'+b+'" target="_blank" class="pswp__share--'+a.id+'"'+(a.download?"download":"")+">"+a.label+"</a>",q.parseShareButtonOut&&(f=q.parseShareButtonOut(a,f));i.children[0].innerHTML=f,i.children[0].onclick=G},I=function(a){for(var c=0;c<q.closeElClasses.length;c++)if(b.hasClass(a,"pswp__"+q.closeElClasses[c]))return!0},J=0,K=function(){clearTimeout(u),J=0,k&&v.setIdle(!1)},L=function(a){a=a?a:window.event;var b=a.relatedTarget||a.toElement;b&&"HTML"!==b.nodeName||(clearTimeout(u),u=setTimeout(function(){v.setIdle(!0)},q.timeToIdleOutside))},M=function(){q.fullscreenEl&&!b.features.isOldAndroid&&(c||(c=v.getFullscreenAPI()),c?(b.bind(document,c.eventK,v.updateFullscreen),v.updateFullscreen(),b.addClass(a.template,"pswp--supports-fs")):b.removeClass(a.template,"pswp--supports-fs"))},N=function(){q.preloaderEl&&(O(!0),l("beforeChange",function(){clearTimeout(o),o=setTimeout(function(){a.currItem&&a.currItem.loading?(!a.allowProgressiveImg()||a.currItem.img&&!a.currItem.img.naturalWidth)&&O(!1):O(!0)},q.loadingIndicatorDelay)}),l("imageLoadComplete",function(b,c){a.currItem===c&&O(!0)}))},O=function(a){n!==a&&(C(m,"preloader--active",!a),n=a)},P=function(a){var c=a.vGap;if(B()){var g=q.barsSize;if(q.captionEl&&"auto"===g.bottom)if(f||(f=b.createEl("pswp__caption pswp__caption--fake"),f.appendChild(b.createEl("pswp__caption__center")),d.insertBefore(f,e),b.addClass(d,"pswp__ui--fit")),q.addCaptionHTMLFn(a,f,!0)){var h=f.clientHeight;c.bottom=parseInt(h,10)||44}else c.bottom=g.top;else c.bottom="auto"===g.bottom?0:g.bottom;c.top=g.top}else c.top=c.bottom=0},Q=function(){q.timeToIdle&&l("mouseUsed",function(){b.bind(document,"mousemove",K),b.bind(document,"mouseout",L),t=setInterval(function(){J++,2===J&&v.setIdle(!0)},q.timeToIdle/2)})},R=function(){l("onVerticalDrag",function(a){x&&.95>a?v.hideControls():!x&&a>=.95&&v.showControls()});var a;l("onPinchClose",function(b){x&&.9>b?(v.hideControls(),a=!0):a&&!x&&b>.9&&v.showControls()}),l("zoomGestureEnded",function(){a=!1,a&&!x&&v.showControls()})},S=[{name:"caption",option:"captionEl",onInit:function(a){e=a}},{name:"share-modal",option:"shareEl",onInit:function(a){i=a},onTap:function(){F()}},{name:"button--share",option:"shareEl",onInit:function(a){h=a},onTap:function(){F()}},{name:"button--zoom",option:"zoomEl",onTap:a.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(a){g=a}},{name:"button--close",option:"closeEl",onTap:a.close},{name:"button--arrow--left",option:"arrowEl",onTap:a.prev},{name:"button--arrow--right",option:"arrowEl",onTap:a.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){c.isFullscreen()?c.exit():c.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(a){m=a}}],T=function(){var a,c,e,f=function(d){if(d)for(var f=d.length,g=0;f>g;g++){a=d[g],c=a.className;for(var h=0;h<S.length;h++)e=S[h],c.indexOf("pswp__"+e.name)>-1&&(q[e.option]?(b.removeClass(a,"pswp__element--disabled"),e.onInit&&e.onInit(a)):b.addClass(a,"pswp__element--disabled"))}};f(d.children);var g=b.getChildByClass(d,"pswp__top-bar");g&&f(g.children)};v.init=function(){b.extend(a.options,z,!0),q=a.options,d=b.getChildByClass(a.scrollWrap,"pswp__ui"),l=a.listen,R(),l("beforeChange",v.update),l("doubleTap",function(b){var c=a.currItem.initialZoomLevel;a.getZoomLevel()!==c?a.zoomTo(c,b,333):a.zoomTo(q.getDoubleTapZoom(!1,a.currItem),b,333)}),l("preventDragEvent",function(a,b,c){var d=a.target||a.srcElement;d&&d.getAttribute("class")&&a.type.indexOf("mouse")>-1&&(d.getAttribute("class").indexOf("__caption")>0||/(SMALL|STRONG|EM)/i.test(d.tagName))&&(c.prevent=!1)}),l("bindEvents",function(){b.bind(d,"pswpTap click",A),b.bind(a.scrollWrap,"pswpTap",v.onGlobalTap),a.likelyTouchDevice||b.bind(a.scrollWrap,"mouseover",v.onMouseOver)}),l("unbindEvents",function(){y||F(),t&&clearInterval(t),b.unbind(document,"mouseout",L),b.unbind(document,"mousemove",K),b.unbind(d,"pswpTap click",A),b.unbind(a.scrollWrap,"pswpTap",v.onGlobalTap),b.unbind(a.scrollWrap,"mouseover",v.onMouseOver),c&&(b.unbind(document,c.eventK,v.updateFullscreen),c.isFullscreen()&&(q.hideAnimationDuration=0,c.exit()),c=null)}),l("destroy",function(){q.captionEl&&(f&&d.removeChild(f),b.removeClass(e,"pswp__caption--empty")),i&&(i.children[0].onclick=null),b.removeClass(d,"pswp__ui--over-close"),b.addClass(d,"pswp__ui--hidden"),v.setIdle(!1)}),q.showAnimationDuration||b.removeClass(d,"pswp__ui--hidden"),l("initialZoomIn",function(){q.showAnimationDuration&&b.removeClass(d,"pswp__ui--hidden")}),l("initialZoomOut",function(){b.addClass(d,"pswp__ui--hidden")}),l("parseVerticalMargin",P),T(),q.shareEl&&h&&i&&(y=!0),D(),Q(),M(),N()},v.setIdle=function(a){k=a,C(d,"ui--idle",a)},v.update=function(){x&&a.currItem?(v.updateIndexIndicator(),q.captionEl&&(q.addCaptionHTMLFn(a.currItem,e),C(e,"caption--empty",!a.currItem.title)),w=!0):w=!1,y||F(),D()},v.updateFullscreen=function(d){d&&setTimeout(function(){a.setScrollOffset(0,b.getScrollY())},50),b[(c.isFullscreen()?"add":"remove")+"Class"](a.template,"pswp--fs")},v.updateIndexIndicator=function(){q.counterEl&&(g.innerHTML=a.getCurrentIndex()+1+q.indexIndicatorSep+q.getNumItemsFn())},v.onGlobalTap=function(c){c=c||window.event;var d=c.target||c.srcElement;if(!r)if(c.detail&&"mouse"===c.detail.pointerType){if(I(d))return void a.close();b.hasClass(d,"pswp__img")&&(1===a.getZoomLevel()&&a.getZoomLevel()<=a.currItem.fitRatio?q.clickToCloseNonZoomable&&a.close():a.toggleDesktopZoom(c.detail.releasePoint))}else if(q.tapToToggleControls&&(x?v.hideControls():v.showControls()),q.tapToClose&&(b.hasClass(d,"pswp__img")||I(d)))return void a.close()},v.onMouseOver=function(a){a=a||window.event;var b=a.target||a.srcElement;C(d,"ui--over-close",I(b))},v.hideControls=function(){b.addClass(d,"pswp__ui--hidden"),x=!1},v.showControls=function(){x=!0,w||v.update(),b.removeClass(d,"pswp__ui--hidden")},v.supportsFullscreen=function(){var a=document;return!!(a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen)},v.getFullscreenAPI=function(){var b,c=document.documentElement,d="fullscreenchange";return c.requestFullscreen?b={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:d}:c.mozRequestFullScreen?b={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+d}:c.webkitRequestFullscreen?b={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+d}:c.msRequestFullscreen&&(b={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),b&&(b.enter=function(){return j=q.closeOnScroll,q.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?a.template[this.enterK]():void a.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},b.exit=function(){return q.closeOnScroll=j,document[this.exitK]()},b.isFullscreen=function(){return document[this.elementK]}),b}};return a});;

// gallery 相关
(function () {
    $('body').append('<!-- Root element of PhotoSwipe. Must have class pswp. -->\r\n<div class=\"pswp\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\r\n\r\n    <!-- Background of PhotoSwipe.\r\n         It\'s a separate element as animating opacity is faster than rgba(). -->\r\n    <div class=\"pswp__bg\"></div>\r\n\r\n    <!-- Slides wrapper with overflow:hidden. -->\r\n    <div class=\"pswp__scroll-wrap\">\r\n\r\n        <!-- Container that holds slides.\r\n            PhotoSwipe keeps only 3 of them in the DOM to save memory.\r\n            Don\'t modify these 3 pswp__item elements, data is added later on. -->\r\n        <div class=\"pswp__container\">\r\n            <div class=\"pswp__item\"></div>\r\n            <div class=\"pswp__item\"></div>\r\n            <div class=\"pswp__item\"></div>\r\n        </div>\r\n\r\n        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->\r\n        <div class=\"pswp__ui pswp__ui--hidden\">\r\n\r\n            <div class=\"pswp__top-bar\">\r\n\r\n                <!--  Controls are self-explanatory. Order can be changed. -->\r\n\r\n                <div class=\"pswp__counter\"></div>\r\n\r\n                <button class=\"pswp__button pswp__button--close\" title=\"Close (Esc)\"></button>\r\n\r\n                <button class=\"pswp__button pswp__button--share\" title=\"Share\"></button>\r\n\r\n                <button class=\"pswp__button pswp__button--fs\" title=\"Toggle fullscreen\"></button>\r\n\r\n                <button class=\"pswp__button pswp__button--zoom\" title=\"Zoom in/out\"></button>\r\n\r\n                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->\r\n                <!-- element will get class pswp__preloader--active when preloader is running -->\r\n                <div class=\"pswp__preloader\">\r\n                    <div class=\"pswp__preloader__icn\">\r\n                        <div class=\"pswp__preloader__cut\">\r\n                            <div class=\"pswp__preloader__donut\"></div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"pswp__share-modal pswp__share-modal--hidden pswp__single-tap\">\r\n                <div class=\"pswp__share-tooltip\"></div>\r\n            </div>\r\n\r\n            <button class=\"pswp__button pswp__button--arrow--left\" title=\"Previous (arrow left)\">\r\n            </button>\r\n\r\n            <button class=\"pswp__button pswp__button--arrow--right\" title=\"Next (arrow right)\">\r\n            </button>\r\n\r\n            <div class=\"pswp__caption\">\r\n                <div class=\"pswp__caption__center\"></div>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>');

    var galleryItems = [],
        galleryItemsOK = false,
        gallery = null;

    window.galleryItemOK = function (img, sl) {
        var total = $(sl).length,
            link = ek.dom.refluxToFind(img, '[data-index]'),
            index = parseInt(link && link.getAttribute('data-index'));

        galleryItems[index] = {
            src: img.src,
            w: img.naturalWidth,
            h: img.naturalHeight
        };

        if (galleryItems.length === total) {
            galleryItemsOK = true;
        }
    };

    window.openGallery = function (index) {
        if (!galleryItemsOK) {
            return;
        }
        gallery = new PhotoSwipe($('.pswp').get(0), PhotoSwipeUI_Default, galleryItems, {
            index: index || 0,
            mainClass: 'pswp--minimal--dark',
            barSize: {top: 0, bottom: 0},
            captionEl: false,
            fullscreenEl: false,
            shareEl: false,
            bgOpacity: 0.85,
            tapToClose: true,
            tapToToggleControls: false
        });
        gallery.init();
    }
})();;

template.helper('dateFormat', function (data) {
    var date = new Date(data * 1000);
    var y = date.getFullYear();
    var m = date.getMonth() + 1;
    var d = date.getDate();

    return y + '年' + m + '月' + d + '日';
});

// template.helper('splitParas', function (content) {
//     console.log(content);
//     var paras = String(content).split(/(?:\n|\\n)/g);
//     console.log(paras);
//     return paras;
// });

/**
 * Created by krimeshu on 2016/3/3.
 */
(function (window) {
    window.TAG_HEAD = 'event.preview_topic_prpr.topic.';

    // 一些缝缝补补的补丁
    /**
 * Created by krimeshu on 2016/3/16.
 */
(function () {

    /**
     * iOS 浏览器的点击事件加速
     */
    FastClick.attach(document.body);

    /**
     * 修复一些浏览器中可能导致的奇怪 bug
     */
    document.body.addEventListener('touchstart', function () {
        // Bug fixed.
    });

    /**
     * 设置html高度，用于fix某些安卓机型不能正确获取100%高度值，用于高度100%的页面
     * */
    //document.querySelector('html').style.height = document.documentElement.offsetHeight + 'px';

    /**
     * 没有实现活动专用的 just-dialog 对话框时，则使用 pile-dialog 作为默认对话框
     * */
    window.Dialog = window.Dialog || PileDialog;
})();
    // 分享与统计
    /**
 * Created by krimeshu on 2016/3/3.
 */

(function (window) {

    var ek = window['ek'] || {};

    ek.share.setShare({
        link: window.location.href,
        img_url: $('meta[itemprop="image"]').attr('content'),
        title: $('meta[itemprop="name"]').attr('content'),
        desc: $('meta[itemprop="description"]').attr('content'),
        callback: function (res) {
            var pgIndex = window['pgIndex'];
            pgIndex && pgIndex.load && pgIndex.load('ShareForMoreChance');
            console.log('分享结果：', res);
        }
    });

    ek.ping.init({
        androidAppUrl: 'http://mobile.ac.qq.com/apkSet/qqcomic_android_dm4006.apk',
        iOSAppUrl: 'https://itunes.apple.com/app/apple-store/id569387346?pt=604140&ct=dm4006&mt=8',
        downAppTag: function () {
            // 根据活动名称生成下载的按键统计标记
            return ek.ping.getDownAppTag('newEvent');
        },
        // 初始化完毕后上报页面访问URL
        reportVisit: true
    });

})(window);
    // 逻辑代码
    /**
 * Created by krimeshu on 2016/5/16.
 */

var EventView = BIU.View.extend({
    checkIsApp: function (_noLeadToDown) {
        // 判断是否APP，APP外默认提示下载APP
        if (ek.isApp) {
            return true;
        } else {
            !_noLeadToDown && this.leadToDown();
            return false;
        }
    },
    leadToDown: function () {
        Dialog.alert(['您不是从客户端内打开页面的，', '快下载腾讯动漫，参与话题吧~'], '提示').then(function () {
            ek.ping.downAppAndReport();
        });
    }
});

    /**
 * 基本信息（基于登录信息、设备信息的汇总）
 * 事件触发器：'loginExpired'，重新登陆事件
 * listen数据：{
 *              uin:
 *              skey:
 *              imei:
 *              mac:
 *              key:
 *              imsi:经常获取不到，必须条件1：安卓机 2：插上sim卡 3：提供获取电话号码权限
 *            }
 * */
new BIU.Model({
    name: 'md_BaseInfo',
    init: function () {
        var self = this;
        self.loginInfo = null;
        self.deviceInfo = null;
        self.on('loginExpired', function () {
            // 登录过期事件
            self.loginInfo = null;
            self.set(self.genBaseInfo());
            self.tryReLogin();
        });
    },
    load: function (cb) {
        var self = this;
        (ek.isApp ? ek.app.isAppLogin : ek.loginLite.isLogin_async)(function (loginInfo) {
            self.loginInfo = loginInfo || null;
            if (!ek.isApp) {
                window.setTimeout(function () {
                    var info = self.genBaseInfo();
                    self.set(info);
                    cb && cb();
                }, 0);
            } else {
                ek.app.deviceInfo(function (deviceInfo) {
                    self.deviceInfo = deviceInfo || null;
                    window.setTimeout(function () {
                        var info = self.genBaseInfo();
                        self.set(info);
                        cb && cb();
                    }, 0);
                });
            }
        });
    },
    genBaseInfo: function () {
        var self = this,
            loginInfo = self.loginInfo || (self.loginInfo = {}),
            deviceInfo = self.deviceInfo || (self.deviceInfo = {});

        var baseInfo = {
            uin: loginInfo['uin'] || '',
            skey: loginInfo['skey'] || '',
            imei: deviceInfo['deviceId'] || '',
            mac: deviceInfo['mac'] || '',
            key: deviceInfo['key'] || '',
            imsi: deviceInfo['imsi'] || ''
        };

        return baseInfo;
    },
    tryReLogin: function () {
        var url = window.location.href;
        if (ek.isApp) {
            ek.app.appRelogin(function () {
                window.location.href = url;
            });
        } else {
            ek.loginLite.login(url);
        }
    }
});
    var vw_DownApp = new BIU.View({
    name: 'vw_DownApp',
    styleText: '.down-app-link {\n  display: block;\n  position: fixed;\n  z-index: 2;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 50px;\n  font-size: 0;\n  text-indent: -1000000em;\n  background: rgba(0, 0, 0, 0.7) url(\'data:image/png;base64, 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\') no-repeat center center;\n  background-size: auto 100%; }\n  .down-app-link.hide {\n    display: none; }\n',
    init: function () {
        if (!ek.isApp) {
            this.createDOM();
        }
    },
    createDOM: function () {
        var self = this,
            style = document.createElement('STYLE');
        style.innerHTML = this.styleText;
        document.body.appendChild(style);

        var link = document.createElement('A');
        link.className = 'down-app-link';
        link.href = "javascript: ek.ping.downAppAndReport();";
        link.innerHTML = '[下载APP参与活动]';
        link.addEventListener('click', function () {
            self.onClick();
        });
        document.body.appendChild(link);
    },
    onClick: function () {
        var self = this,
            page = self.page;
        page.trigger('onClickedDownAppLink');
    }
});

if (typeof module !== 'undefined') {
    module.exports = vw_DownApp;
}


    /**
 * Created by krimeshu on 2016/5/25.
 */
var models = [
    new BIU.Model({
        name: 'md_TopicDetail',
        pageReady: function () {
            this.load();
        },
        load: function () {
            var self = this,
                page = self.page,
                topicId = page.topicId;
            ek.ajax({
                url: 'action.php?action=getTopicDetail',
                data: {
                    topic_id: topicId
                },
                success: function (res) {
                    var status = res && res.status,
                        data = res && res.data,
                        msg = res && res.msg;
                    if (status == 2) {
                        self.set(data);
                    } else {
                        PileDialog.alert(msg || ['>_< 页面内容被神秘力量偷走了~', '去看看漫画怎么样？']).then(function () {
                            window.location.href = '/';
                        });
                    }
                }
            });
        }
    })
];
    /**
 * Created by krimeshu on 2016/5/25.
 */
var views = [
    new EventView({
        name: 'vw_MainArea',
        events: {
            'click #btn_topBarBtnBack': function () {
                if (ek.isApp) {
                    ek.app.webFinish();
                } else {
                    if (document.referrer && /^https?:\/\/([^.]*.){0,3}.qq.com/.test(document.referrer)) {
                        window.history.go(-1);
                    } else {
                        window.location.href = '/';
                    }
                }
            },
            'click .article-area': function (e) {
                var target = e && e.target,
                    link = target && ek.dom.refluxToFind(target, '.attach-link'),
                    index = link && parseInt(link.getAttribute('data-index'));
                link && window.openGallery && openGallery(index);
            }
        },
        listen: {
            'md_TopicDetail': function (data) {
                var avatar = data['qq_head'],
                    title = data['topic_title'] || data['title'] || '',
                    isArtist = data['is_artist'] === 2,
                    nick = data['nick_name'] || '',
                    from = data['from'] || '',
                    date = data['date'] || '',
                    content = data['content'] || '';
                avatar && $('#img_authorAvatar').attr('src', avatar);
                isArtist && $('#mod_authorInfo').addClass('is-artist');
                $('#txt_authorName').html(nick);
                $('#txt_fromEnd').html(from);
                $('#txt_pubTime').html(date);
                $('#txt_topBarTitle, #txt_articleTitle').html(title);
                document.title = title;

                data.paras = String(content).split(/(?:\n|\\n)/g);
                var contentHtml = template('tpl_articleContent', data);
                $('#tpl_articleContent').after(contentHtml);

                $('#txt_likeInfo').html(data['good_count'] + '人');
            }
        }
    }),
    new EventView({
        name: 'vw_VoteArea',
        events: {
            'click .article-area': function (e) {
                var $target = $(e && e.target).closest('.vote-list .vote-item, .vote-ctrl .btn-vote');
                if ($target.length) {
                    this.leadToDown();
                }
            }
        },
        listen: {
            'md_TopicDetail': function (data) {
                var extraInfo = (data['extra_info'] || {}),
                    voteInfo = extraInfo['vote_info'] || {},
                    voteTypes = [null, 'single', 'multi'],
                    voteType = voteTypes[parseInt(voteInfo['vote_type'])] || null;
                if (!voteType) {
                    return;
                }
                var remainTime = parseInt(voteInfo['remaining_time']),
                    uinCount = parseInt(voteInfo['vote_uin_cnt']),
                    optionInfo = extraInfo['option_info'] || [],
                    options = [];
                for (var i = 0, len = optionInfo.length; i < len; i++) {
                    var option = optionInfo[i];
                    options.push({
                        desc: option['option_desc'],
                        count: option['vote_cnt'],
                        percent: option['vote_rate']
                    });
                }
                // Todo: Debuger
                if (ek.url.getQueryString('_finished')) {
                    remainTime = 0;
                }
                var html = template('tpl_voteArea', {
                    type: voteType,
                    remainTime: remainTime,
                    isFinished: remainTime <= 0,
                    uinCount: uinCount,
                    options: options
                });
                $('#tpl_voteArea').before($(html));
            }
        }
    }),
    new EventView({
        name: 'vw_CommentArea',
        listen: {
            'md_TopicDetail': function (data) {
                var commentList = data && data['comment_list'],
                    commentListData = commentList && commentList['data'];
                for (var i = 0, comment; comment = commentListData[i]; i++) {
                    comment.paras = String(comment.content).split(/(?:\n|\\n)/g);
                }
                var contentHtml = template('tpl_commentList', data);
                $('#tpl_commentList').after(contentHtml);
            }
        }
    })
];


    window.pg_Topic = new BIU.Page({
        name: 'pg_Topic',
        topicId: parseInt(ek.url.getQueryString('topic_id')),   // 强制转换数字，不输出/执行，避免XSS
        views: ['vw_DownApp'].concat(views),
        models: ['md_BaseInfo'].concat(models)
    });

    pg_Topic.on('onClickedDownAppLink', function () {
        // iOS中可能被屏蔽下载的情况给予提示（如微博）
        if (ek.isIOS) {
            var $mask = window.MASK_INSTALL;
            if (!$mask) {
                $mask = window.MASK_INSTALL = $('<div class="mask-install"></div>');
                $mask.css({
                    'display': 'none',
                    'position': 'fixed',
                    'z-index': 1000,
                    'top': 0,
                    'left': 0,
                    'width': '100%',
                    'height': '100%',
                    'background': 'rgba(0,0,0,.5) url("http://ac.gtimg.com/h5_hd/previewTopicPRPR/images/mask-install-app.png?v=1d7637fbdf4078c1") no-repeat top right',
                    'background-size': '100% auto'
                }).on('click', function () {
                    $('.mask-install').hide();
                });
                $('body').append($mask);
            }
            $mask.show();
        }
    });

})(window);

$(function () {
    //dom节点加载完毕就执行pageReady初始化页面
    pg_Topic.pageReady();

    var callClient = function (msg) {
        var iframes = callClient.iframes,
            total = 10;
        if (!iframes) {
            iframes = callClient.iframes = {
                box: null,
                lastUsed: 0,
                list: []
            };
            var box = iframes.box = document.createElement('div');
            box.className = 'call-client-iframes';
            box.style.display = 'none';
            document.body.appendChild(box);
            for (var i = 0; i < total; i++) {
                var iframe = document.createElement('IFRAME');
                iframes.list.push(iframe);
                box.appendChild(iframe);
            }
        }
        var index = (iframes.lastUsed + 1) % total;
        iframes.list[index].src = msg;
        iframes.lastUsed = index;
    };

    if (ek.clientType !== ek.CLIENT.QQAC_IOS) {
        callClient('txcomic://topic/path?topic_id=' + pg_Topic.topicId);
    }

    //确认登录/设备信息获取完毕之后再执行pageReady，用于需要进入页面就登录的情况
    //pg_Index.load('md_BaseInfo', function () {
    //    pg_Index.pageReady();
    //});
});



/**
 * 公用顶栏
 * Created by krimeshu on 2015/11/24.
 */
// (function checkIfNoTopBar() {
//     var noTopBar = ek.url.getQueryString('no_top_bar') == 1; // 只做判断，不做输出、执行
//     if (noTopBar) {
//         $('body').addClass('no-top-bar');
//     }
// })();
$(function () {

    function getTagHead() {
        var pageName = $('meta[name="page-name"]').attr('content') || 'unknown';
        return HOT_TAG_ROOT + 'top_bar.' + pageName;
    }

    $('.top-bar .btn-top.back').on('click', function () {
        // 上报统计
        ek.ping.reportClick(getTagHead() + '.back');

        pageAction.goBack();
    });

    $('.top-bar .btn-top.menu, .nav-menu-bg').on('click', function () {
        var $box = $('.nav-menu-box');
        if ($box.attr('data-animating')) {
            return;
        }
        if ($box.is('.show')) {
            $box.removeClass('show').attr('data-animating', '1');
            window.setTimeout(function () {
                $box.hide().attr('data-animating', '');
                $box = null;
            }, 300);
            // 上报统计
            ek.ping.reportClick(getTagHead() + '.hide_nav');
        } else {
            $box.show().each(function () {
                this.clientWidth;
            });
            $box.addClass('show').attr('data-animating', '1');
            window.setTimeout(function () {
                $box.attr('data-animating', '');
                $box = null;
            }, 300);
            // 上报统计
            ek.ping.reportClick(getTagHead() + '.show_nav');
        }
    });

    $('.top-bar, .nav-menu-box, .nav-menu-bg').on('touchmove', function (e) {
        e.preventDefault();
    });

    $('.nav-menu-box .nav-list .item').on('click', function () {
        var btnName = $(this).attr('data-name') || '未知';
        // 上报统计
        ek.ping.reportClick(getTagHead() + '.nav_' + btnName);
    });

    $('.nav-menu-box .btn-top.search').on('click', function () {
        // 上报统计
        ek.ping.reportClick(getTagHead() + '.search');
    });

    $('.nav-menu-box .btn-home').on('click', function () {
        // 上报统计
        ek.ping.reportClick(getTagHead() + '.nav_home');
    });

});
;
/**
 * 回到顶部
 * Created by krimeshu on 2015/12/29.
 */
(function () {
    var template = '<a class="back-to-top" href="javascript: void(0);">[返回顶部]</a>';

    function BackToTop(para) {
        this.init(para);
        this.bindScroll();
    }

    BackToTop.prototype = {
        init: function (para) {
            var that = this;
            para = para || {};

            that.scrollElem = para.scrollElem || document.body;
            that.scrollLimit = para.scrollLimit || 200;
            that.cssStyle = para.cssStyle || '';
            that.dom = $(template).on('click', function () {
                that.click();
            });
            that.dom.css(that.cssStyle);
            $('body').append(that.dom);
        },
        click: function () {
            var that = this;
            var scrollElem = that.scrollElem,
                box = scrollElem == document.body ? document.documentElement : scrollElem;

            box.scrollTop = scrollElem.scrollTop = window.scrollY = window.pageYOffset = 0;
        },
        //绑定滚动事件
        'bindScroll': function () {
            var that = this;
            var scrollElem = that.scrollElem,
                box = scrollElem == document.body ? document.documentElement : scrollElem,
                tar = scrollElem == document.body ? window : scrollElem,
                limit = that.scrollLimit;
            tar.addEventListener('scroll', function () {
                var scrollTop = box.scrollTop || scrollElem.scrollTop || window.scrollY || window.pageYOffset;
                if (scrollTop >= limit && !that.disabled) {
                    that.dom.addClass('show');
                } else {
                    that.dom.removeClass('show');
                }
            });
        },
        'disable': function () {
            var that = this;
            that.disabled = true;
            that.dom.removeClass('show');
        },
        'enable': function () {
            var that = this;
            that.disabled = false;
        }
    };

    window.BackToTop = BackToTop;
})();;
/**
 * App引导下载
 * Created by krimeshu on 2016/1/26.
 */
$(function () {
    var checkClickAppAds = function (e) {
        var $target = $(e.target),
            $close = $target.is('.app-guiding-close') ? $target :
                $target.parents('.app-guiding-close'),
            $parent = $target.parents('.app-guiding');
        if ($close.length) {
            $parent.addClass('closed');
            window.setTimeout(function () {
                $parent.hide().removeClass('closed');
                $parent = null;
            }, 300);
        } else if ($parent.length) {
            //如果有配置下载地址，从配置项获取地址并下载
            var url_iOS = $parent.attr('data-url-iOS');
            var url_Android = $parent.attr('data-url-Android');
            var id = $parent.attr('data-id');
            var tag = 'h5_v3_app_down.' + 'theme_' + id + '.' + ek.clientType + '.' + ek.os;
            if (url_Android && url_iOS) {
                if (ek.isIOS) {
                    ek.ping.downAppAndReport(url_iOS, tag);
                } else if (ek.isAndroid) {
                    ek.ping.downAppAndReport(url_Android, tag);
                }
            } else {
                ek.ping.downAppAndReport();
            }
        }
    };

    $('body').on('click', checkClickAppAds);
});
;


// 默认使用 PileDialog 版对话框
(!window.Dialog) && (window.Dialog = PileDialog);
// 设置默认对话框的皮肤
(function () {
    if (!window.PileDialog) {
        return;
    }

    (function setDialogSkin() {
        if (!PileDialog.alertDialog || !PileDialog.confirmDialog) {
            window.setTimeout(setDialogSkin, 50);
            return;
        }

        PileDialog.alertDialog.setProp('skin', 'light-salmon');
        PileDialog.confirmDialog.setProp('skin', 'light-salmon');
    })();
})();

(function ($) {
    // 尝试扩充Zepto的函数，增加prevAll和nextAll
    $ && $.extend($.fn, {
        nextAll: function (s) {
            var $els = $(), $el = this.next();
            while ($el.length) {
                if (typeof s === 'undefined' || $el.is(s)) $els = $els.add($el);
                $el = $el.next();
            }
            return $els;
        },
        prevAll: function (s) {
            var $els = $(), $el = this.prev();
            while ($el.length) {
                if (typeof s === 'undefined' || $el.is(s)) $els = $els.add($el);
                $el = $el.prev();
            }
            return $els;
        }
    });
})(typeof Zepto === 'undefined' ? null : Zepto);


// 咱们自己的统计
(function () {
    var wl = window.location,
        href = wl.href,
        prefix = wl.protocol + '//' + wl.hostname,
        uri = href.replace(prefix, '');

    (new Image()).src = '/stats.php?t=' + +new Date + '&uri=' + uri;
})();

(function () {
    if ('addEventListener' in document) {
        document.addEventListener('DOMContentLoaded', function () {
            FastClick.attach(document.body);
            document.body.addEventListener('touchstart', function () {
                // Bug fixed.
            });
        }, false);
    }
})();

/*屏幕翻转检测 begin*/
(function () {
    var onVertical = undefined;

    function checkOrientation() {
        if (window.orientation == '-90' || window.orientation == '90') {
            var wl = window.location.href;
            if (wl.indexOf(ek.url.getDomain() + '/chapter/index/') == -1) {
                if (onVertical == undefined) {
                    onVertical = false;
                } else if (onVertical == true) {
                    onVertical = false;
                }
                Dialog.toast('竖屏看漫画更爽哦，转一下嘛╮(╯▽╰)╭');
            }
        } else {
            if (onVertical == undefined) {
                onVertical = true;
            } else if (onVertical == false) {
                onVertical = true;
                // history.go(0);
            }
        }
    }

    window.onorientationchange = function () {
        checkOrientation();
    };
    $(function () {
        checkOrientation();
    });
})();
/*屏幕翻转检测 end*/;
// fragBegin: pageAction占位
window.pageAction = window.pageAction || {};
window.presetPageAction = window.presetPageAction || {};
// fragEnd: pageAction占位

window.pageAction = (function () {

    // 一些页面操作相关的动作函数，可被覆盖改写
    function PageAction(presetPageAction) {

        // 保留原始版本函数（即原型）
        this.origin = PageAction.prototype;

        // 将预置函数复制给当前对象
        if (presetPageAction) {
            for (var key in presetPageAction) {
                if (presetPageAction.hasOwnProperty(key)) {
                    this[key] = presetPageAction[key];
                }
            }
        }
    }

    PageAction.prototype = {
        // 返回上一页的通用函数
        goBack: function () {
            if (document.referrer) {
                window.history.go(-1);
            } else {
                var backAddress = $('meta[name="backAddress"]').attr('content');
                if (backAddress) {
                    window.location.href = backAddress;
                } else {
                    window.location.href = '/';
                }
            }
        },
        // 获取用户登录状态，未登录返回null
        getLogin: function (cb) {
            ek.isApp ? ek.app.isAppLogin(cb) : ek.loginLite.isLogin_async(cb);
        },
        // 用户没有登录的时候，转去登陆
        goLogin: function (retUrl) {
            retUrl = retUrl || window.location.href;
            ek.isApp ? ek.app.appLogin(function () {
                if (window.location.href === retUrl) {
                    window.location.reload();
                } else {
                    window.location.href = retUrl;
                }
            }) : ek.loginLite.login(retUrl, !ek.isApp);
        }
    };

    var pageAction = new PageAction(window.pageAction || window.presetPageAction);

    return pageAction;
}());;

/**
 * Created by krimeshu on 2016/6/16.
 */
var TokenKey = {
    _data: undefined,
    _loading: false,
    clearCache: function () {
        this._data = null;
    },
    set: function (token) {
        if (!token) {
            return;
        }
        this._data = token;
    },
    get: function (cb) {
        var self = this,
            data = self._data;
        if (data !== undefined || ek.isApp) {
            // APP内不需要tokenKey
            cb && cb(data);
            return;
        }
        if (self._loading) {
            window.setTimeout(function () {
                self.getData(cb);
            }, 100);
            return;
        }
        self._loading = true;
        ek.ajax({
            url: '/Ajax/getToken',
            data: {},
            success: function (res) {
                console.log('请求成功：', this);
                console.log('返回数据：', res);
                self._loading = false;

                var data = res && res.data,
                    token = (data && data.token) || '';

                self._data = token;
                // Todo: tokenKey debug
                // res.data.token = '';
                cb && cb(token);
            }
        });
    }
};

if (typeof module != 'undefined' && module.exports) {
    module.exports = TokenKey;
}
;

!function(a){function b(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):null}function c(){var a="iframe_hijack_redirected";if(b(a))f(0);else if(self!=top){var c=location.href,d=c.split("#");d[0]+=location.search?"&"+a+"=1":"?"+a+"=1";try{top.location=d.join("#")}catch(e){}}}function d(){if(a.XMLSerializer){var b=(new XMLSerializer).serializeToString(document),c=b.match(/<!--headTrap.*?-->/),d=b.match(/<!--tailTrap.*?-->/);(c&&c[0]&&c[0].length>54||d&&d[0]&&d[0].length>54)&&f(3)}}function e(a){var b=a?a.srcElement:document.documentElement;if(b.outerHTML){for(var c=/(https?:)?\/\/[a-zA-Z0-9\._-]+\.[a-zA-Z]{2,6}(:[0-9]{1,6})?\/?[^'")\s]*/gi,d=/^(https?:)?\/\/([a-zA-Z0-9\._-]+\.[a-zA-Z]{2,6})/i,e=[],g=[b],h=b.getElementsByTagName("*"),i=0;i<h.length;i++)g.push(h[i]);for(var i=0;i<g.length;i++){var j=g[i],l=null;if("IMG"==j.nodeName.toUpperCase()&&j.src&&d.test(j.src))l=[j.src];else if("LINK"==j.nodeName.toUpperCase()){var m=j.getAttribute("href");m&&d.test(m)&&(l=[m])}else"STYLE"==j.nodeName.toUpperCase()?l=j.innerHTML.match(c):"IFRAME"==j.nodeName.toUpperCase()&&j.src&&d.test(j.src)?l=[j.src]:j.getAttribute("style")&&(l=j.getAttribute("style").match(c));if(l){for(var n=!1,o=0;o<l.length;o++){var p=d.exec(l[o]);p&&p[2]&&k.test(p[2])||(e.push(l[o]),n=!0)}n&&j.setAttribute("style","display:none;position:fixed;top:10000px;")}}e.length&&(a&&b.setAttribute("style","display:none;position:fixed;top:-10000px;"),f(a?2:1,e))}}function f(a,b){if(!l[a]){l[a]=!0;var c={project_id:j,department_id:i,hijack_type:a,page_url:location.href,blocked:1};if(b&&(c.ad_url=b.join("||")),1==a){for(var d=document.head.outerHTML,e=document.body.children,f=0;f<e.length;f++){var g=e[f];"IFRAME"==g.nodeName.toUpperCase()&&g.src&&0!=g.src.indexOf("http")||(d+=g.outerHTML)}d=d.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,""),d=d.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),c.html_dom=d}setTimeout(function(){h(c)},500)}}function g(){50*Math.random()<1&&h({project_id:j,department_id:i,pv:1})}function h(a){var b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]));var d=new XMLHttpRequest;d.open("POST","http://hijack.qq.com/cgi/r",!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(b.join("&"))}var i,j,k=/^.*\.(qq\.com|gtimg\.cn|qlogo\.cn|qpic\.cn|sogoucdn\.com)$/i,l={};a.HijackReport={init:function(a){i=a.departmentId,j=a.projectId,a.whiteReg&&(k=a.whiteReg)},watch:function(){a.addEventListener("DOMNodeInserted",e),c(),document.addEventListener("DOMContentLoaded",function(){e(),d(),g()},!1)}}}(window);

//避免运营商注入
HijackReport.init({
    departmentId: 3,
    projectId: 10,
    whiteReg: /^.*\.(qq\.com|gtimg\.com|gtimg\.cn|qpic\.cn|qlogo\.cn|idqqimg\.com)$/i
});
HijackReport.watch();

// 无历史切换页面
        window.goPage = window.history.replaceState ? function (url, delay) {
            window.setTimeout(function () {
                window.history.replaceState(null, '', url);
                window.location.reload();
            }, delay | 0);
        } : function (url, delay) {
            window.setTimeout(function () {
                window.location.replace(url);
            }, delay | 0);
        };

